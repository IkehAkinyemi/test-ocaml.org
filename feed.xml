<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><icon>http://ocaml.org/img/colour-icon-170x148.png</icon><generator uri="https://ocaml.org/" version="${version:syndic}">OCaml Syndic.Atom feed aggregator</generator><id>urn:md5:1fa6b9573867b1fbf78d903979f495a2</id><title type="text">OCaml Planet</title><updated>2021-03-29T10:00:00-00:00</updated><entry><source><updated>2021-03-29T10:00:00-00:00</updated><logo>https://www.ocamlpro.com/wp-content/uploads/2020/07/cropped-favicon-32x32.png</logo><link title="OCamlPro" type="text/html" href="https://www.ocamlpro.com" rel="related"/><link title="OCamlPro" type="application/rss+xml" href="https://www.ocamlpro.com/feed/" rel="self"/><generator>https://wordpress.org/?v=5.4.4</generator><id>https://www.ocamlpro.com</id><title type="text">OCamlPro</title><author><name>OCamlPro</name></author></source><link href="https://www.ocamlpro.com/2021/03/29/new-try-alt-ergo/" rel="alternate"/><link href="https://www.ocamlpro.com/2021/03/29/new-try-alt-ergo/#respond" rel="related"/><content xml:base="https://www.ocamlpro.com/feed/" type="html">
&lt;p&gt;Have you heard about our &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://alt-ergo.ocamlpro.com/try.html&quot; target=&quot;_blank&quot;&gt;Try-Alt-Ergo&lt;/a&gt; website? Created in 2014 (see &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://www.ocamlpro.com/2014/07/15/try-alt-ergo-in-your-browser/&quot; target=&quot;_blank&quot;&gt;our blogpost&lt;/a&gt;), the first objective was to facilitate access to our performant SMT Solver &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://alt-ergo.ocamlpro.com/&quot; target=&quot;_blank&quot;&gt;Alt-Ergo&lt;/a&gt;.&lt;em&gt; &lt;/em&gt;Try-Alt-Ergo allows you to write and run your problems in your browser without any server computation.&lt;/p&gt;



&lt;p&gt;This playground website has been maintained by OCamlPro for many years, and it&amp;#8217;s high time to bring it back to life with new updates. We are therefore pleased to announce the new version of the &lt;a href=&quot;https://try-alt-ergo.ocamlpro.com/&quot;&gt;Try-Alt-Ergo&lt;/a&gt; website! In this article, we will first explain what has changed in the back end, and what you can use if you are interested in running your own version of Alt-Ergo on a website, or in an application! And then we will focus on the new front-end of our website, from its interface to its features through its tutorial about the program.&lt;em&gt; &lt;/em&gt;&lt;/p&gt;



&lt;h2 id=&quot;2014&quot;&gt;&lt;a href=&quot;https://www.ocamlpro.com/2021/03/29/new-try-alt-ergo/#2014&quot;&gt;Try-Alt-Ergo 2014&lt;/a&gt;&lt;/h2&gt;



&lt;figure class=&quot;wp-block-image size-large&quot;&gt;&lt;img src=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/03/Screenshot-from-2021-03-29-12-22-14-1024x561.png&quot; alt=&quot;&quot; class=&quot;wp-image-4806&quot; srcset=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/03/Screenshot-from-2021-03-29-12-22-14-1024x561.png 1024w, https://www.ocamlpro.com/wp-content/uploads/2021/03/Screenshot-from-2021-03-29-12-22-14-300x164.png 300w, https://www.ocamlpro.com/wp-content/uploads/2021/03/Screenshot-from-2021-03-29-12-22-14.png 1187w&quot; sizes=&quot;(max-width: 1024px) 100vw, 1024px&quot; /&gt;&lt;figcaption&gt;Try-Alt-Ergo 2014&lt;/figcaption&gt;&lt;/figure&gt;



&lt;p&gt;&lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://alt-ergo.ocamlpro.com/try.html&quot; target=&quot;_blank&quot;&gt;Try-Alt-Ergo&lt;/a&gt; was designed to be a powerful and simple tool to use. Its interface was minimalist. It offered three panels, one panel (left) with a text area containing the problem to prove. The centered panel was composed of a button to run Alt-Ergo, load examples, set options. The right panel showed these options, examples and other information. This design lacked some features that have been added to our solver through the years. Features such as models (counter-examples), unsat-core, more options and debug information was missing in this version.&lt;/p&gt;



&lt;p&gt; Try-Alt-Ergo did not offer a proper editor (with syntax coloration), a way to save the file problem nor an option to limit the run of the solver with a time limit. Another issue was about the thread. When the solver was called the webpage froze, that behavior was problematic in case of the long run because there was no way to stop the solver.&lt;/p&gt;



&lt;h2 id=&quot;ae-1.30&quot;&gt;&lt;a href=&quot;https://www.ocamlpro.com/2021/03/29/new-try-alt-ergo/#ae-1.30&quot;&gt;Alt-Ergo 1.30&lt;/a&gt;&lt;/h2&gt;



&lt;p&gt;The 1.30 version of Alt-Ergo was the version used in the back-end to prove problems. Since this version, a lot of improvements have been done in Alt-Ergo. To learn more about these improvements, see our &lt;a href=&quot;https://ocamlpro.github.io/alt-ergo/About/changes.html&quot;&gt;changelog&lt;/a&gt; in the documentation.&lt;/p&gt;



&lt;p&gt;Over the years we encountered some difficulties to update the Alt-Ergo version used in Try-Alt-Ergo. We used &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://ocsigen.org/js_of_ocaml/latest/manual/overview&quot; target=&quot;_blank&quot;&gt;Js_of_ocaml&lt;/a&gt; to compile the OCaml code of our solver to be runnable as a JavaScript code. Some libraries were not available in JavaScript and we needed to manually disable them. The lack of automatism leads to a lack of time to update the JavaScript version of Alt-Ergo in Try-Alt-Ergo.&lt;/p&gt;



&lt;p&gt;In 2019 we switched our build system to &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://dune.readthedocs.io/en/latest/overview.html&quot; target=&quot;_blank&quot;&gt;dune&lt;/a&gt; which opens the possibility to ease the cross-compilation of Alt-Ergo in JavaScript. &lt;/p&gt;



&lt;h2 id=&quot;backend&quot;&gt;&lt;a href=&quot;https://www.ocamlpro.com/2021/03/29/new-try-alt-ergo/#backend&quot;&gt;New back-end&lt;/a&gt;&lt;/h2&gt;



&lt;p&gt;With some simple modification, we were able to compile Alt-Ergo in JavaScript. This modification is simple enough that this process is now automated in our continuous integration. This will enable us to easily provide a JavaScript version of our Solver for each future version.&lt;/p&gt;



&lt;p&gt;Two ways of using our solver in JavaScript are available:&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;&lt;code&gt;alt-ergo.js&lt;/code&gt;, a JavaScript version of the Alt-Ergo CLI. It can be runned with &lt;code&gt;node&lt;/code&gt;: &lt;code&gt;node alt-ergo.js &amp;lt;options&amp;gt; &amp;lt;file&amp;gt;&lt;/code&gt;. Note that this code is slower than the natively compiled CLI of Alt-Ergo.&lt;br&gt;In our effort to open the SMT world to more people, an npm package is the next steps of this work.&lt;/li&gt;&lt;li&gt;&lt;code&gt;alt-ergo-worker.js&lt;/code&gt;, a web worker of Alt-Ergo. This web worker needs JSON file to input file problem, options into Alt-Ergo and to returns its answers:&lt;ul&gt;&lt;li&gt;Options are sent as a list of couple &lt;em&gt;name:value&lt;/em&gt; like:&lt;br&gt;&lt;code&gt;{&quot;debug&quot;:true,&lt;br&gt;&quot;input_format&quot;:&quot;Native&quot;,&lt;br&gt;&quot;steps_bound&quot;:100,&lt;br&gt;&quot;sat_solver&quot;: &quot;Tableaux&quot;,&lt;br&gt;&quot;file&quot;:&quot;test-file&quot;}&lt;/code&gt;&lt;br&gt;You can specify all options used in Alt-Ergo. If some options are missing, the worker uses the default value for these options. For example, if debug is not specified the worker will use its defaults &lt;em&gt;value :false&lt;/em&gt;.&lt;/li&gt;&lt;li&gt;Input file is sent as a list of string, with the following format:&lt;br&gt;&lt;code&gt;{ &quot;content&quot;: [ &quot;goal g: true&quot;] }&lt;/code&gt;&lt;/li&gt;&lt;li&gt;Alt-Ergo answers can be composed with its results, debug information, errors, warnings &amp;#8230;&lt;br&gt;&lt;code&gt;{ &quot;results&quot;: [ &quot;File \&quot;test-file\&quot;, line 1, characters 9-13: Valid (0.2070) (0 steps) (goal g) ] ,&lt;/code&gt;&lt;br&gt;&lt;code&gt;&quot;debugs&quot;: [ &quot;[Debug][Sat_solver]&quot;, &quot;use Tableaux-like solver&quot;] }&lt;/code&gt;&lt;br&gt;like the options, a result value like &lt;code&gt;debugs&lt;/code&gt; does not contains anything, &lt;code&gt;&quot;debugs&quot;: [...]&lt;/code&gt; is not returned.&lt;/li&gt;&lt;/ul&gt;&lt;ul&gt;&lt;li&gt;See the Alt-Ergo &lt;a href=&quot;https://ocamlpro.github.io/alt-ergo/Usage/index.html#js-worker&quot;&gt;web-worker documentation&lt;/a&gt; to learn more on how to use it.&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;



&lt;h2 id=&quot;frontend&quot;&gt;&lt;a href=&quot;https://www.ocamlpro.com/2021/03/29/new-try-alt-ergo/#frontend&quot;&gt;New Front-end&lt;/a&gt;&lt;/h2&gt;



&lt;figure class=&quot;wp-block-image size-large&quot;&gt;&lt;img src=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/03/photo_2021-03-11_10-54-30-1024x565.jpg&quot; alt=&quot;&quot; class=&quot;wp-image-4699&quot; srcset=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/03/photo_2021-03-11_10-54-30-1024x565.jpg 1024w, https://www.ocamlpro.com/wp-content/uploads/2021/03/photo_2021-03-11_10-54-30-300x166.jpg 300w, https://www.ocamlpro.com/wp-content/uploads/2021/03/photo_2021-03-11_10-54-30.jpg 1206w&quot; sizes=&quot;(max-width: 1024px) 100vw, 1024px&quot; /&gt;&lt;figcaption&gt;New Try-Alt-Ergo interface&lt;/figcaption&gt;&lt;/figure&gt;



&lt;p&gt;The &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;http://try-alt-ergo.ocamlpro.com&quot; target=&quot;_blank&quot;&gt;Try-Alt-Ergo&lt;/a&gt; has been completely reworked and we added some features:&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;The left panel is still composed in an editor and answers area&lt;ul&gt;&lt;li&gt; &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://ace.c9.io/&quot; target=&quot;_blank&quot;&gt;Ace editor&lt;/a&gt; with custom syntax coloration (both native and smt-lib2) is now used to make it more pleasant to write your problems.&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;A top panel that contains the following buttons:&lt;ul&gt;&lt;li&gt;&lt;code&gt;Ask Alt-Ergo&lt;/code&gt; which retrieves content from the editor and options, launch the web worker and print answers in the defined areas.&lt;/li&gt;&lt;/ul&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;Load&lt;/code&gt; and &lt;code&gt;Save&lt;/code&gt; files.&lt;/li&gt;&lt;li&gt;&lt;code&gt;Documentation&lt;/code&gt;, that sends users to the newly added &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://ocamlpro.github.io/alt-ergo/Input_file_formats/Native/index.html&quot; target=&quot;_blank&quot;&gt;native syntax documentation&lt;/a&gt; of Alt-Ergo.&lt;/li&gt;&lt;li&gt;&lt;code&gt;Tutorial&lt;/code&gt;, that opens an interactive &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://try-alt-ergo.ocamlpro.com/tuto/tutorial.html&quot; target=&quot;_blank&quot;&gt;tutorial&lt;/a&gt; to introduce you to Alt-Ergo native syntax and program verification.&lt;br&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;



&lt;figure class=&quot;wp-block-image size-large&quot;&gt;&lt;img src=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/03/Screenshot_2021-03-12-Welcome-to-Alt-Ergo’s-tutorial-—-Alt-Ergos-tutorial-documentation-1024x657.png&quot; alt=&quot;&quot; class=&quot;wp-image-4727&quot; srcset=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/03/Screenshot_2021-03-12-Welcome-to-Alt-Ergo’s-tutorial-—-Alt-Ergos-tutorial-documentation-1024x657.png 1024w, https://www.ocamlpro.com/wp-content/uploads/2021/03/Screenshot_2021-03-12-Welcome-to-Alt-Ergo’s-tutorial-—-Alt-Ergos-tutorial-documentation-300x192.png 300w, https://www.ocamlpro.com/wp-content/uploads/2021/03/Screenshot_2021-03-12-Welcome-to-Alt-Ergo’s-tutorial-—-Alt-Ergos-tutorial-documentation.png 1264w&quot; sizes=&quot;(max-width: 1024px) 100vw, 1024px&quot; /&gt;&lt;figcaption&gt;Alt-Ergo&amp;#8217;s tutorial&lt;/figcaption&gt;&lt;/figure&gt;



&lt;ul&gt;&lt;li&gt;A right panel composed of tabs:&lt;ul&gt;&lt;li&gt;&lt;code&gt;Start&lt;/code&gt; and &lt;code&gt;About&lt;/code&gt; that contains general information about Alt-Ergo, Try-Alt-Ergo and how to use it.&lt;/li&gt;&lt;li&gt;&lt;code&gt;Outputs&lt;/code&gt; prints more information than the basic answer area under the editor. In these tabs you can find debugs (long) outputs, unsat-core or models (counter-example) generated by Alt-Ergo.&lt;/li&gt;&lt;li&gt;&lt;code&gt;Options&lt;/code&gt; contains every option you can use, such as the time limit / steps limit or to set the format of the input file to prove  .&lt;/li&gt;&lt;li&gt;&lt;code&gt;Statistics&lt;/code&gt; is still a basic tab that only output axioms used to prove the input problem.&lt;/li&gt;&lt;li&gt;&lt;code&gt;Examples&lt;/code&gt; contains some basic examples showing the capabilities of our solver.&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;



&lt;p&gt;We hope you will enjoy this new version of Try-Alt-Ergo, we can&amp;#8217;t wait to read your feedback! &lt;/p&gt;



&lt;p&gt;&lt;em&gt;This work was done at OCamlpro.&lt;/em&gt;&lt;/p&gt;
</content><category term="Formal Methods &amp; Alt-Ergo"/><id>https://www.ocamlpro.com/?p=4697</id><title type="text">New Try-Alt-Ergo</title><updated>2021-03-29T10:00:00-00:00</updated><author><name>OCamlPro</name></author></entry><entry><source><updated>2021-03-26T13:00:42-00:00</updated><link title="Seb's blog /b/" type="text/html" href="https://seb.mondet.org/b/" rel="related"/><link title="Seb's blog /b/" type="application/rss+xml" href="https://seb.mondet.org/b/OCaml.rss" rel="self"/><id>https://seb.mondet.org/b/</id><title type="text">Seb's blog /b/</title><author><name>Sebastien Mondet</name></author></source><link href="https://seb.mondet.org/b/0012-tzcomet-token-viewer.html" rel="alternate"/><content xml:base="https://seb.mondet.org/b/OCaml.rss" type="html">
    TZComet and CleanNFT Metadata: a generic token-viewer ☄
    Also new domain tzcomet.io 🌠
   </content><id>https://seb.mondet.org/b/0012-tzcomet-token-viewer.html</id><title type="text">TZComet's New Token Viewer</title><updated>2021-03-26T13:00:42-00:00</updated><author><name>Sebastien Mondet</name></author></entry><entry><source><updated>2021-03-08T00:00:00-00:00</updated><link title="Frama-C RSS News" type="text/html" href="https://frama-c.com" rel="related"/><link title="Frama-C RSS News" type="application/rss+xml" href="http://frama-c.com/rss.xml" rel="self"/><id>https://frama-c.com</id><title type="text">Frama-C RSS News</title><author><name>Frama-C</name></author></source><link href="https://frama-c.com/fc-plugins/frama-clang.html" rel="alternate"/><id>https://frama-c.com/fc-plugins/frama-clang.html#4b3adce2524a96c24468aa4d35ee593f</id><title type="text">Release of Frama-Clang 0.0.10</title><updated>2021-03-08T00:00:00-00:00</updated><author><name>Frama-C</name></author></entry><entry><source><updated>2021-03-08T17:59:58-00:00</updated><link href="https://roscidus.com/blog/" rel="alternate"/><link href="https://roscidus.com/blog/blog/categories/ocaml/atom.xml" rel="self"/><generator uri="http://octopress.org/">Octopress</generator><id>https://roscidus.com/blog/</id><title type="text">Category: ocaml | Thomas Leonard's blog</title><author><name>Thomas Leonard</name></author></source><link href="https://roscidus.com/blog/blog/2021/03/07/qubes-lite-with-kvm-and-wayland/" rel="alternate"/><content xml:base="http://roscidus.com/blog/blog/categories/ocaml/atom.xml" type="html">&lt;p&gt;I’ve been running QubesOS as my main desktop since 2015.
It provides good security, by running applications in different Xen VMs.
However, it is also quite slow and has some hardware problems.
I’ve recently been trying out NixOS, KVM, Wayland and SpectrumOS,
and attempting to create something similar with more modern/compatible/faster technology.&lt;/p&gt;

&lt;p&gt;This post gives my initial impressions of these tools and describes my current setup.&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;&lt;strong&gt;Table of Contents&lt;/strong&gt;&lt;/p&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#qubesos&quot;&gt;QubesOS&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#nixos&quot;&gt;NixOS&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#nix-store&quot;&gt;nix-store&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#nix-instantiate&quot;&gt;nix-instantiate&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#nix-pkgs&quot;&gt;nix-pkgs&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#nix-env&quot;&gt;nix-env&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#nixos-1&quot;&gt;NixOS&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#installing-nixos&quot;&gt;Installing NixOS&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#thoughts-on-nixos&quot;&gt;Thoughts on NixOS&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#why-use-virtual-machines&quot;&gt;Why use virtual machines?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#spectrumos&quot;&gt;SpectrumOS&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#wayland&quot;&gt;Wayland&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#protocol&quot;&gt;Protocol&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#copying-text&quot;&gt;Copying text&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#security&quot;&gt;Security&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#future-work&quot;&gt;Future work&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;( this post also appeared on &lt;a href=&quot;https://news.ycombinator.com/item?id=26378854&quot;&gt;Hacker News&lt;/a&gt; and
&lt;a href=&quot;https://lobste.rs/s/cisgn2/qubes_lite_with_kvm_wayland&quot;&gt;Lobsters&lt;/a&gt; )&lt;/p&gt;

&lt;h2 id=&quot;qubesos&quot;&gt;QubesOS&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://www.qubes-os.org/&quot;&gt;QubesOS&lt;/a&gt; aims to provide “a reasonably secure operating system”.
It does this by running multiple virtual machines under the Xen hypervisor.
Each VM’s windows have a different colour and tag, but they appear together as a single desktop.
The VMs I run include:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;com&lt;/code&gt; for email and similar (the only VM that sees my email password).&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;dev&lt;/code&gt; for software development.&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;shopping&lt;/code&gt; (the only VM that sees my card number).&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;personal&lt;/code&gt; (with no Internet access)&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;untrusted&lt;/code&gt; (general browsing)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The desktop environment itself is another Linux VM (&lt;code&gt;dom0&lt;/code&gt;), used for managing the other VMs.
Most of the VMs are running Fedora (the default for Qubes), although I run Debian in &lt;code&gt;dev&lt;/code&gt;.
There are also a couple of system VMs; one for dealing with the network hardware,
and one providing a firewall between the VMs.&lt;/p&gt;

&lt;p&gt;You can run &lt;code&gt;qvm-copy&lt;/code&gt; in a VM to copy a file to another VM.
&lt;code&gt;dom0&lt;/code&gt; pops up a dialog box asking which VM should receive the file, and it arrives there
as &lt;code&gt;~/QubesIncoming/$source_vm/$file&lt;/code&gt;.
You can also press Ctrl-Shift-C to copy a VM’s clipboard to the global clipboard, and then
press Ctrl-Shift-V in a window of the target VM to copy to that VM’s clipboard,
ready for pasting into an application.&lt;/p&gt;

&lt;p&gt;I think Qubes does a very good job at providing a secure environment.&lt;/p&gt;

&lt;p&gt;However, it has poor hardware compatibility and it feels sluggish, even on a powerful machine.
I bought a new machine a while ago and found that the motherboard only provided a single video output, limited to 30Hz.
This meant I had to buy a discrete graphics card. With the card enabled, the machine &lt;a href=&quot;https://github.com/QubesOS/qubes-issues/issues/5459&quot;&gt;fails to resume from suspend&lt;/a&gt;,
and locks up from time to time (it’s completely stable with the card removed or disabled).
I spent some time trying to understand the driver code, but I didn’t know enough about graphics, the Linux kernel, PCI suspend, or Xen to fix it.&lt;/p&gt;

&lt;p&gt;I was also having some other problems with QubesOS:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Graphics performance is terrible (especially on a 4k monitor).
Qubes disables graphics acceleration in VMs for security reasons, but it was slow even for software rendering.&lt;/li&gt;
  &lt;li&gt;It recently started freezing for a couple of seconds from time to time - annoying when you’re trying to type.&lt;/li&gt;
  &lt;li&gt;It uses LVM thin-pools for VM storage, which I don’t understand, and which sometimes need repairing (haven’t lost any data, though).&lt;/li&gt;
  &lt;li&gt;dom0 is out-of-date and generally not usable.
This is intentional (you should be using VMs),
but my security needs aren’t that high and it would be nice to be able to do video conferencing these days.
Also, being able to print over USB and use bluetooth would be handy.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Anyway, I decided it was time to try something new.
Linux now has its own built-in hypervisor (KVM), and I thought that would probably work better with my hardware.
I was also keen to try out Wayland, which is built around shared-memory and I thought it might therefore work better with VMs.
How easy would it be to recreate a Qubes-like environment directly on Linux?&lt;/p&gt;

&lt;h2 id=&quot;nixos&quot;&gt;NixOS&lt;/h2&gt;

&lt;p&gt;I’ve been meaning to try &lt;a href=&quot;https://nixos.org/&quot;&gt;NixOS&lt;/a&gt; properly for some time. Ever since I started using Linux, its package management has struck me as absurd. On Debian, Fedora, etc, installing a package means letting it put files wherever it likes; which effectively gives the package author root on your system. Not a good base for sandboxing!&lt;/p&gt;

&lt;p&gt;Also, they make it difficult to try out 3rd-party software, or to test newer versions of just some packages.&lt;/p&gt;

&lt;p&gt;In 2003 I created &lt;a href=&quot;https://0install.net/&quot;&gt;0install&lt;/a&gt; to address these problems, and Nix has very similar goals. I thought Nix was a few years younger, but looking at its Git history the first commit was on Mar 12, 2003. I announced the first preview of 0install just two days later, so both projects must have started writing code within a few days of each other!&lt;/p&gt;

&lt;p&gt;NixOS is made up of quite a few components. Here is what I’ve learned so far:&lt;/p&gt;

&lt;h3 id=&quot;nix-store&quot;&gt;nix-store&lt;/h3&gt;

&lt;p&gt;The store holds the files of all the programs, and is the central component of the system.
Each version of a package goes in its own directory (or file), at &lt;code&gt;/nix/store/$HASH&lt;/code&gt;.
You can add data to the store directly, like this:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;$ echo hello &amp;gt; file
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;$ nix-store --add-fixed sha256 file
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;/nix/store/1vap48aqggkk52ijn2prxzxv7cnzvs0w-file
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;$ cat /nix/store/1vap48aqggkk52ijn2prxzxv7cnzvs0w-file
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;hello&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;Here, the store location is calculated from the hash of the contents of the file we added (as with &lt;code&gt;0install store add&lt;/code&gt; or &lt;code&gt;git hash-object&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;However, you can also add things to the store by asking Nix to run a build script.
For example, to compile some source code:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;You add the source code and some build instructions (a “derivation” file) to the store.&lt;/li&gt;
  &lt;li&gt;You ask the store to build the derivation. It runs your build script in a container sandbox.&lt;/li&gt;
  &lt;li&gt;The results are added to the store, using the hash of the build instructions (not the hash of the result) as the directory name.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;If a package in the store depends on another one (at build time or run time), it just refers to it by its full path.
For example, a bash script in the store will start something like:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;#! /nix/store/vnyfysaya7sblgdyvqjkrjbrb0cy11jf-bash-4.4-p23/bin/bash
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;If two users want to use the same build instructions, the second one will see that the hash already exists and can just reuse that.
This allows users to compile software from source and share the resulting binaries, without having to trust each other.&lt;/p&gt;

&lt;p&gt;Ideally, builds should be reproducible.
To encourage this, builds which use the hash of the build instructions for the result path are built in a sandbox without network access.
So, you can’t submit a build job like “Download and compile whatever is the latest version of Vim”.
But you can discover the latest version yourself and then submit two separate jobs to the store:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;“Download Vim 8.2, with hash XXX” (a fixed-output job, which therefore has network access)&lt;/li&gt;
  &lt;li&gt;“Build Vim from hash XXX”&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;You can run &lt;code&gt;nix-collect-garbage&lt;/code&gt; to delete everything from the store that isn’t reachable via the symlinks under &lt;code&gt;/nix/var/nix/gcroots/&lt;/code&gt;.
Users can put symlinks to things they care about keeping in &lt;code&gt;/nix/var/nix/gcroots/per-user/$USER/&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;By default, the store is also configured with a trusted binary cache service,
and will try to download build results from there instead of compiling locally when possible.&lt;/p&gt;

&lt;h3 id=&quot;nix-instantiate&quot;&gt;nix-instantiate&lt;/h3&gt;

&lt;p&gt;Writing derivation files by hand is tedious, so Nix provides a templating language to create them easily.
The Nix language is dynamically typed and based around maps/dictionaries (which it confusingly refers to as “sets”).
&lt;code&gt;nix-instantiate file.nix&lt;/code&gt; will generate a derivation from &lt;code&gt;file.nix&lt;/code&gt; and add it to the store.&lt;/p&gt;

&lt;p&gt;An Nix file looks like this:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;derivation { system = &quot;x86_64-linux&quot;; builder = ./myfile; name = &quot;foo&quot;; }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;Running &lt;code&gt;nix-instantiate&lt;/code&gt; on this will:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Add &lt;code&gt;myfile&lt;/code&gt; to the store.&lt;/li&gt;
  &lt;li&gt;Add the generated &lt;code&gt;foo.drv&lt;/code&gt; to the store, including the full store path of &lt;code&gt;myfile&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;nix-pkgs&quot;&gt;nix-pkgs&lt;/h3&gt;

&lt;p&gt;Writing Nix expressions for every package you want would also be tedious.
The &lt;a href=&quot;https://github.com/NixOS/nixpkgs&quot;&gt;nixpkgs&lt;/a&gt; Git repository contains a Nix expression that evaluates to a set of derivations,
one for each package in the distribution.
It also contains a library of useful helper functions for packages
(e.g. it knows how to handle GNU autoconf packages automatically).&lt;/p&gt;

&lt;p&gt;Rather than evaluating the whole lot, you use &lt;code&gt;-A&lt;/code&gt; to ask for a single package.
For example, you can use &lt;code&gt;nix-instantiate ./nixpkgs/default.nix -A firefox&lt;/code&gt; to generate a derivation for Firefox.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;nix-build&lt;/code&gt; is a quick way to create a derivation with &lt;code&gt;nix-instantiate&lt;/code&gt; and build it with &lt;code&gt;nix-store&lt;/code&gt;.
It will also create a &lt;code&gt;./result&lt;/code&gt; symlink pointing to its path in the store,
as well as registering &lt;code&gt;./result&lt;/code&gt; with the garbage collector under &lt;code&gt;/nix/var/nix/gcroots/auto/&lt;/code&gt;.
For example, to build and run Firefox:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;nix-build ./nixpkgs/default.nix -A firefox
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;./result/bin/firefox&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;If you use nixpkgs without making any changes, it will be able to download a pre-built binary from the cache service.&lt;/p&gt;

&lt;h3 id=&quot;nix-env&quot;&gt;nix-env&lt;/h3&gt;

&lt;p&gt;Keeping track of all these symlinks would be tedious too,
but you can collect them all together by making a package that depends on every application you want.
Its build script will produce a &lt;code&gt;bin&lt;/code&gt; directory full of symlinks to the applications.
Then you could just point your &lt;code&gt;$PATH&lt;/code&gt; variable at that &lt;code&gt;bin&lt;/code&gt; directory in the store.&lt;/p&gt;

&lt;p&gt;To make updating easier, you will actually add &lt;code&gt;~/.nix-profile/bin/&lt;/code&gt; to &lt;code&gt;$PATH&lt;/code&gt; and
update &lt;code&gt;.nix-profile&lt;/code&gt; to point at the latest build of your environment package.&lt;/p&gt;

&lt;p&gt;This is essentially what &lt;code&gt;nix-env&lt;/code&gt; does, except with yet more symlinks to allow for
switching between multiple profiles, and to allow rolling back to previous environments
if something goes wrong.&lt;/p&gt;

&lt;p&gt;For example, to install Firefox so you can run it via &lt;code&gt;$PATH&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;nix-env -i firefox&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;h3 id=&quot;nixos-1&quot;&gt;NixOS&lt;/h3&gt;

&lt;p&gt;Finally, just as &lt;code&gt;nix-env&lt;/code&gt; can create a user environment with &lt;code&gt;bin&lt;/code&gt;, &lt;code&gt;man&lt;/code&gt;, etc,
a similar process can create a root filesystem for a Linux distribution.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;nixos-rebuild&lt;/code&gt; reads the &lt;code&gt;/etc/nixos/configuration.nix&lt;/code&gt; configuration file,
generates a system environment,
and then updates grub and the &lt;code&gt;/run/current-system&lt;/code&gt; symlink to point to it.&lt;/p&gt;

&lt;p&gt;In fact, it also lists previous versions of the system environment in the grub file, so
if you mess up the configuration you can just choose an earlier one from the boot
menu to return to that version.&lt;/p&gt;

&lt;h3 id=&quot;installing-nixos&quot;&gt;Installing NixOS&lt;/h3&gt;

&lt;p&gt;To install NixOS you boot one of the live images at &lt;a href=&quot;https://nixos.org&quot;&gt;https://nixos.org&lt;/a&gt;.
Which you use only affects the installation UI, not the system you end up with.&lt;/p&gt;

&lt;p&gt;The manual walks you through the installation process, showing how to partition
the disk, format and mount the partitions, and how to edit the configuration file.
I like this style of installation, where it teaches you things instead of just doing it for you.
Most of the effort in switching to a new system is learning about it, so I’d rather
spend 3 hours learning stuff following an installation guide than use a 15-minute
single-click installer that teaches me nothing.&lt;/p&gt;

&lt;p&gt;The configuration file (&lt;code&gt;/etc/nixos/configuration.nix&lt;/code&gt;) is just another Nix expression.
Most things are set to off by default (I approve), but can be changed easily.
For example, if you want sound support you change that setting to &lt;code&gt;sound.enable = true&lt;/code&gt;,
and if you also want to use PulseAudio then you set &lt;code&gt;hardware.pulseaudio.enable = true&lt;/code&gt; too.&lt;/p&gt;

&lt;p&gt;Every system service supported by NixOS is controlled from here,
with all kinds of options, from &lt;code&gt;programs.vim.defaultEditor = true&lt;/code&gt; (so you don’t get trapped in &lt;code&gt;nano&lt;/code&gt;)
to &lt;code&gt;services.factorio.autosave-interval&lt;/code&gt;.
Use &lt;code&gt;man configuration.nix&lt;/code&gt; to see the available settings.&lt;/p&gt;

&lt;p&gt;NixOS defaults to an X11 desktop, but I wanted to try Wayland (and &lt;a href=&quot;https://github.com/swaywm/sway&quot;&gt;Sway&lt;/a&gt;).
Based on the &lt;a href=&quot;https://nixos.wiki/wiki/Sway&quot;&gt;NixOS wiki&lt;/a&gt; instructions, I used this:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;9&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;10&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;11&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;12&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;13&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;14&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;  programs.sway = {
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    enable = true;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    wrapperFeatures.gtk = true; # so that gtk works properly
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    extraSessionCommands = &quot;export MOZ_ENABLE_WAYLAND=1&quot;;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    extraPackages = with pkgs; [
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      swaylock
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      swayidle
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      xwayland
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      wl-clipboard
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      mako
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      alacritty
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      dmenu
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    ];
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;  };&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code&gt;xwayland&lt;/code&gt; bit is important; without that you can’t run any X11 applications.&lt;/p&gt;

&lt;p&gt;My only complaint with the NixOS installation instructions is that following them will leave you with an unencrypted system,
which isn’t very useful.
When partitioning, you have to skip ahead to the LUKS section of the manual, which just gives some options but no firm advice.
I created two primary partitions: a 1G unencrypted &lt;code&gt;/boot&lt;/code&gt;, and a LUKS partition for the rest of the disk.
Then I created an LVM volume group from the &lt;code&gt;/dev/mapper/crypted&lt;/code&gt; device and added the other partitions in that.&lt;/p&gt;

&lt;p&gt;Once the partitions are mounted and the configuration file is complete,
&lt;code&gt;nixos-install&lt;/code&gt; downloads everything and configures grub.
Then you reboot into the new system.&lt;/p&gt;

&lt;p&gt;Once running the new system you can made further edits to the configuration file there in the same way,
and use &lt;code&gt;nixos-rebuild switch&lt;/code&gt; to generate a new system.
It seems to be pretty good at updating the running system to the new settings, so you don’t normally need to reboot
after making changes.&lt;/p&gt;

&lt;p&gt;The big mistake I made was forgetting to add &lt;code&gt;/boot&lt;/code&gt; to fstab.
When I ran &lt;code&gt;nixos-rebuild&lt;/code&gt; it put all the grub configuration on the encrypted partition, rendering the system unbootable.
I fixed that with &lt;code&gt;chattr +i /boot&lt;/code&gt; on the unmounted partition.
That way, trying to rebuild with &lt;code&gt;/boot&lt;/code&gt; unmounted will just give an error message.&lt;/p&gt;

&lt;h3 id=&quot;thoughts-on-nixos&quot;&gt;Thoughts on NixOS&lt;/h3&gt;

&lt;p&gt;I’ve been using the system for a few weeks now and I’ve had no problems with Nix so far.
Nix has been fast and reliable and there were fairly up-to-date packages for everything I wanted
(I’m using the stable release).
There is a lot to learn, but plenty of documentation.&lt;/p&gt;

&lt;p&gt;When I wanted a newer package (&lt;code&gt;socat&lt;/code&gt; with vsock support, only just released) I just told Nix to install it from the latest Git checkout of nixpkgs.
Unlike on Debian and similar systems, doing this doesn’t interfere with any other packages (such as forcing a system-wide upgrade of libc).&lt;/p&gt;

&lt;p&gt;I think Nix does download more data than most other systems, but networks are fast enough now that it doesn’t seem to matter.
For example, let’s say you’re running Python 3.9.0 and you want to update to 3.9.1:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;With &lt;strong&gt;Debian&lt;/strong&gt;: &lt;code&gt;apt-get upgrade&lt;/code&gt; downloads the new version, which gets unpacked over the old one.
As the files are unpacked, the system moves through an exciting series of intermediate states no-one has thought about.
Running programs may crash as they find their library versions changing under them (though it’s usually OK).
Only root can update software.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;With &lt;strong&gt;0install&lt;/strong&gt;: &lt;code&gt;0install update&lt;/code&gt; downloads the new version, unpacking it to a new directory.
Running programs continue to use the old version.
When a new program is started, 0install notices the update and runs the solver again.
If the program is compatible with the new Python then it uses that. If not, it continues with the old one.
You can run any previous version if there is a problem.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;With &lt;strong&gt;Nix&lt;/strong&gt;: &lt;code&gt;nix-env -u&lt;/code&gt; downloads the new version, unpacking it to a new directory.
It also downloads (or rebuilds) every package depending on Python, creating new directories for each of them.
It then creates a new environment with symlinks to the latest version of everything.
Running programs continue to use the old version.
Starting a new program will use the new version.
You can revert the whole environment back to the previous version if there is a problem.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;With &lt;strong&gt;Docker&lt;/strong&gt;: &lt;code&gt;docker pull&lt;/code&gt; downloads the new version of a single application,
downloading most or all of the application’s packages, whether Python related or not.
Existing containers continue running with the old version.
New containers will default to using the new version.
You can specify which version to use when starting a program.
Other applications continue using the old version of Python until their authors update them
(you must update each application individually, rather than just updating Python itself).&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The main problem with NixOS is that it’s quite different to other Linux systems, so there’s a lot to relearn.
Also, existing knowledge about how to edit &lt;code&gt;fstab&lt;/code&gt;, &lt;code&gt;sudoers&lt;/code&gt;, etc, isn’t so useful, as you have to provide all configuration in Nix syntax.
However, having a single (fairly sane) syntax for everything is a nice bonus, and being able to generate things using the templating language is useful.
For example, for my network setup I use a bunch of tap devices (one for each of my VMs).
It was easy to write a little Nix function (&lt;code&gt;mktap&lt;/code&gt;) to generate them all from a simple list.
Here’s that section of my &lt;code&gt;configuration.nix&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;9&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;10&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;11&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;12&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;13&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;14&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;15&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;16&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;17&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;18&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;19&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;20&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;21&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;22&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;23&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;24&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;25&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;26&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;  networking = {
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    useDHCP = false;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    interfaces =
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      let mktap = ip: {
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;          virtual = true;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;          virtualOwner = &quot;tal&quot;;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;          ipv4.addresses = [
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;            { address = ip; prefixLength = 31; }
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;          ];
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;        };
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      in
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      {
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;        eno2.useDHCP = true;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;        wlo1.useDHCP = true;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;        tapdev = mktap &quot;10.0.0.2&quot;;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;        tapcom = mktap &quot;10.0.0.4&quot;;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;        tapshopping = mktap &quot;10.0.0.6&quot;;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;        tapbanking = mktap &quot;10.0.0.8&quot;;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;        tapuntrusted = mktap &quot;10.0.0.10&quot;;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      };
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    nat = {
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      enable = true;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      externalInterface = &quot;eno2&quot;;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      internalIPs = [ &quot;10.0.0.0/8&quot; ];
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    };
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;  };&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;Overall, I’m very happy with NixOS so far.&lt;/p&gt;

&lt;h2 id=&quot;why-use-virtual-machines&quot;&gt;Why use virtual machines?&lt;/h2&gt;

&lt;p&gt;With NixOS I had a nice host environment, but after using Qubes I wanted to run my applications in VMs.&lt;/p&gt;

&lt;p&gt;The basic problem is that Linux is the only thing that knows how to drive all the hardware,
but Linux security is not ideal. There are several problems:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Linux is written in C.
This makes security bugs rather common and, more importantly, means that a bug in one part of the code
can impact any other part of the code. Nothing is secure unless everything is secure.&lt;/li&gt;
  &lt;li&gt;Linux has a rather large API (hundreds of syscalls).&lt;/li&gt;
  &lt;li&gt;The Linux (Unix) design predates the Internet, and security has been somewhat bolted on afterwards.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;For example, imagine that we want to run a program with access to the network, but not to the graphical display.
We can create a new Linux container for it using &lt;a href=&quot;https://github.com/containers/bubblewrap&quot;&gt;bubblewrap&lt;/a&gt;, like this:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;9&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;10&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;11&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;12&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;13&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;14&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;15&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;16&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;$ ls -l /run/user/1000/wayland-0 /tmp/.X11-unix/X0
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;srwxr-xr-x 1 tal users 0 Feb 18 16:41 /run/user/1000/wayland-0
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;srwxr-xr-x 1 tal users 0 Feb 18 16:41 /tmp/.X11-unix/X0
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;$ bwrap \
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    --ro-bind / / \
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    --dev /dev \
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    --tmpfs /home/tal \
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    --tmpfs /run/user \
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    --tmpfs /tmp \
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    --unshare-all --share-net \
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;    bash
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;$ ls -l /run/user/1000/wayland-0 /tmp/.X11-unix/X0
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;ls: cannot access '/run/user/1000/wayland-0': No such file or directory
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;ls: cannot access '/tmp/.X11-unix/X0': No such file or directory&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;The container has an empty home directory, empty &lt;code&gt;/tmp&lt;/code&gt;, and no access to the display sockets.
If we run Firefox in this environment then… it opens its window just fine!
How? &lt;code&gt;strace&lt;/code&gt; shows what happened:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;connect(4, {sa_family=AF_UNIX, sun_path=&quot;/run/user/1000/wayland-0&quot;}, 27) = -1 ENOENT (No such file or directory)
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;socket(AF_UNIX, SOCK_STREAM|SOCK_CLOEXEC, 0) = 4
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;connect(4, {sa_family=AF_UNIX, sun_path=@&quot;/tmp/.X11-unix/X0&quot;}, 20) = 0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;After failing to connect to Wayland, it then tried using X11 (via Xwayland) instead. Why did that work?
If the first byte of the socket pathname is &lt;code&gt;\0&lt;/code&gt; then Linux instead interprets it as an “abstract” socket address,
not subject to the usual filesystem permission rules.&lt;/p&gt;

&lt;p&gt;Trying to anticipate these kinds of special cases is just too much work.
Linux really wants everything on by default, and you have to find and disable every feature individually.
By contrast, virtual machines tend to have integrations with the host off by default.
The also tend to have much smaller APIs (e.g. just reading and writing disk blocks or network frames),
with the rich Unix API entirely inside the VM, provided by a separate instance of Linux.&lt;/p&gt;

&lt;h2 id=&quot;spectrumos&quot;&gt;SpectrumOS&lt;/h2&gt;

&lt;p&gt;I was able to set up a qemu guest and restore my &lt;code&gt;dev&lt;/code&gt; Qubes VM in that, but it didn’t integrate nicely with the rest of the desktop.
Installing ssh allowed me to connect in with &lt;code&gt;ssh -Y dev&lt;/code&gt;, allowing apps in the VM to open an X connection to Xwayland on the host.
That was somewhat usable, but still a bit slower than Qubes had been (which was already a bit too slow).&lt;/p&gt;

&lt;p&gt;Searching for a way to forward the Wayland connection directly, I came across the &lt;a href=&quot;https://spectrum-os.org/&quot;&gt;SpectrumOS&lt;/a&gt; project.
SpectrumOS aims to use one virtual machine per application, using shared directories so that VM files are stored on the host,
simplifying management.
It uses &lt;a href=&quot;https://chromium.googlesource.com/chromiumos/platform/crosvm/&quot;&gt;crosvm&lt;/a&gt; from the ChromiumOS project instead of qemu, because it has a driver that allows forwarding Wayland connections
(and also because it’s written in Rust rather than C).
The project’s single developer is currently taking a break from the project, and says “I’m currently working towards a proof of concept”.&lt;/p&gt;

&lt;p&gt;However, there is some useful stuff in the &lt;a href=&quot;https://spectrum-os.org/git/nixpkgs/&quot;&gt;SpectrumOS repository&lt;/a&gt; (which is a fork of nixpkgs).
In particular, it contains:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;A version of Linux with the &lt;code&gt;virtwl&lt;/code&gt; kernel module, which connects to crosvm’s Wayland driver.&lt;/li&gt;
  &lt;li&gt;A package for &lt;a href=&quot;https://chromium.googlesource.com/chromiumos/platform2/+/refs/heads/main/vm_tools/sommelier/&quot;&gt;sommelier&lt;/a&gt;, which connects applications to &lt;code&gt;virtwl&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;A Nix expression to build a root filesystem for the VM.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Building that, I was able to run the project’s demo, which runs the Wayfire compositor inside the VM, appearing in a window on the host.
Dragging the nested window around, the pixels flowed smoothly across my screen in exactly the way that pixels on QubesOS don’t.&lt;/p&gt;

&lt;p&gt;This was encouraging, but I didn’t want to run a nested window manager.
I tried running Firefox directly (without Wayfire),
but it complained that sommelier didn’t provide a new enough version of something, and
running weston-terminal immediately segfaulted sommelier.&lt;/p&gt;

&lt;p&gt;Why do we need the sommelier process anyway?
The problem is that, while &lt;code&gt;virtwl&lt;/code&gt; mostly proxies Wayland messages directly, it can’t send arbitrary FDs to the host.
For example, if you want to forward a writable stream from an application to &lt;code&gt;virtwl&lt;/code&gt;
you must first create a pipe from the host using a special &lt;code&gt;virtwl&lt;/code&gt; ioctl,
then read from that and copy the data to the application’s regular Linux pipe.&lt;/p&gt;

&lt;p&gt;With &lt;a href=&quot;https://spectrum-os.org/lists/hyperkitty/list/discuss@spectrum-os.org/thread/VP3KJV3JYWSLJTUKDT3MAKIABZGDCSPN/&quot;&gt;help from the mailing list&lt;/a&gt;, I managed to get it somewhat usable:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;I enabled &lt;code&gt;VIRTIO_FS&lt;/code&gt;, allowing me to mount a host directory into the VM (for sharing files).&lt;/li&gt;
  &lt;li&gt;I created some tap devices (as mentioned above) to get guest networking going.&lt;/li&gt;
  &lt;li&gt;Adding ext4 to the kernel image allowed me to mount the VM’s LVM partition.&lt;/li&gt;
  &lt;li&gt;Setting &lt;code&gt;FONTCONFIG_FILE&lt;/code&gt; got some usable fonts (otherwise, there was no monospace font for the terminal).&lt;/li&gt;
  &lt;li&gt;I hacked sommelier to claim it supported the latest protocols, which got Firefox running.&lt;/li&gt;
  &lt;li&gt;Configuring sommelier for Xwayland let X applications run.&lt;/li&gt;
  &lt;li&gt;I replaced the non-interactive &lt;code&gt;bash&lt;/code&gt; shell with &lt;code&gt;fish&lt;/code&gt; so I could edit commands.&lt;/li&gt;
  &lt;li&gt;I ran &lt;code&gt;(while true; do socat vsock-listen:5000 exec:dash; done)&lt;/code&gt; at the end of the VM’s boot script.
Then I could start e.g. the VM’s Firefox with &lt;code&gt;echo 'firefox&amp;amp;' | socat stdin vsock-connect:7:5000&lt;/code&gt;
on the host, allowing me to add launchers for guest applications.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Making changes to the root filesystem was fairly easy once I’d read the Nix manuals.
To add an application (e.g. &lt;code&gt;libreoffice&lt;/code&gt;), you import it at the start of &lt;a href=&quot;https://spectrum-os.org/git/nixpkgs/tree/pkgs/os-specific/linux/spectrum/rootfs/default.nix&quot;&gt;rootfs/default.nix&lt;/a&gt; and add it to the &lt;code&gt;path&lt;/code&gt; variable.
The Nix expression gets the transitive dependencies of &lt;code&gt;path&lt;/code&gt; from the Nix store and packs them into a squashfs image.&lt;/p&gt;

&lt;p&gt;True, my squashfs image is getting a bit big.
Maybe I should instead make a minimal squashfs boot image, plus a shared directory of hard links to the required files.
That would allow sharing the data with the host.
I could also just share the whole &lt;code&gt;/nix/store&lt;/code&gt; directory, if I wanted to make all host software available to guests.&lt;/p&gt;

&lt;p&gt;I made another Nix script to add various VM boot commands to my host environment.
For example, running &lt;code&gt;qvm-start-shopping&lt;/code&gt; boots my shopping VM using crosvm,
with the appropriate LVM data partition, network settings, and shared host directory.&lt;/p&gt;

&lt;p&gt;I think, ideally, this would be a systemd socket-activated user service rather than a shell script.
Then attempting to run Firefox by sending a command to the VM socket would cause systemd to boot the VM
(if not already running).
For now, I boot each VM manually in a terminal and then press Win-Shift-2 to banish it to workspace 2,
with all the other VM root consoles.&lt;/p&gt;

&lt;p&gt;The &lt;code&gt;virlwl&lt;/code&gt; Wayland forwarding feels pretty fast (much faster than Qubes’ X graphics).&lt;/p&gt;

&lt;h2 id=&quot;wayland&quot;&gt;Wayland&lt;/h2&gt;

&lt;p&gt;I now had a mostly functional Qubes-like environment, running most of my applications in VMs,
with their windows appearing on the host desktop like any other application.
However, I also had some problems:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;A stated goal of Wayland is “every frame is perfect”. However, applications generally seemed to open at the wrong size and then jump to their correct size, which was a bit jarring.&lt;/li&gt;
  &lt;li&gt;Vim opened its window with the scrollbar at the far left of the window, making the text invisible until you resized the window.&lt;/li&gt;
  &lt;li&gt;Wayland is supposed to have better support for high-DPI displays.
However, this doesn’t work with Xwayland, which turns everything blurry,
and the &lt;a href=&quot;https://news.ycombinator.com/item?id=19360176&quot;&gt;recommended work-around&lt;/a&gt; is to use a scale-factor of 1
and configure each application to use bigger fonts.
This is easy enough with X applications (e.g. set &lt;code&gt;ft.dpi: 150&lt;/code&gt; with &lt;code&gt;xrdb&lt;/code&gt;), but Wayland apps must be configured individually.&lt;/li&gt;
  &lt;li&gt;Wayland doesn’t have cursor themes and you have to configure every application individually to use a larger cursor too.&lt;/li&gt;
  &lt;li&gt;Copying text didn’t seem to work reliably. Sometimes there would be a long delay, after which the text might or might not appear. More often, it would just paste something completely different and unexpected. Even when it did paste the right text, it would often have ^M characters inserted into it.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I decided it was time to learn more about Wayland.
I discovered &lt;a href=&quot;https://wayland-book.com/&quot;&gt;wayland-book.com&lt;/a&gt;, which does a good job of introducing it
(though the book is only half finished at the moment).&lt;/p&gt;

&lt;h3 id=&quot;protocol&quot;&gt;Protocol&lt;/h3&gt;

&lt;p&gt;One very nice feature of Wayland is that you can run any Wayland application with &lt;code&gt;WAYLAND_DEBUG=1&lt;/code&gt;
and it will display a fairly readable trace of all the Wayland messages it sends and receives.
Let’s look at a simple application that just connects to the server (compositor) and opens a window:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;$ WAYLAND_DEBUG=1 test.exe
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; wl_display@1.get_registry registry:+2
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; wl_display@1.sync callback:+3&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;The client connects to the server’s socket at &lt;code&gt;/run/user/1000/wayland-0&lt;/code&gt; and sends two messages
to object 1 (of type &lt;code&gt;wl_display&lt;/code&gt;), which is the only object available in a new connection.
The &lt;code&gt;get_registry&lt;/code&gt; request asks the server to add the registry to the conversation and call it object 2.
The &lt;code&gt;sync&lt;/code&gt; request just asks the server to confirm it got it, using a new callback object (with ID 3).&lt;/p&gt;

&lt;p&gt;Both clients and servers can add objects to the conversation.
To avoid numbering conflicts, clients assign low numbers and servers pick high ones.&lt;/p&gt;

&lt;p&gt;On the wire, each message gives the object ID, the operation ID, the length in bytes, and then the arguments.
Objects are thought of as being at server, so the client sends request messages &lt;em&gt;to&lt;/em&gt; objects,
while the server emits event messages &lt;em&gt;from&lt;/em&gt; objects.
At the wire level there’s no difference though.&lt;/p&gt;

&lt;p&gt;When the server gets the &lt;code&gt;get_registry&lt;/code&gt; request it adds the registry,
which immediately emits one event for each available service, giving the maximum supported version.
The client receives these messages, followed by the callback notification from the &lt;code&gt;sync&lt;/code&gt; message:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;9&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;10&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_registry@2.global name:0 interface:&quot;wl_compositor&quot; version:4
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_registry@2.global name:1 interface:&quot;wl_subcompositor&quot; version:1
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_registry@2.global name:2 interface:&quot;wl_shm&quot; version:1
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_registry@2.global name:3 interface:&quot;xdg_wm_base&quot; version:1
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_registry@2.global name:4 interface:&quot;wl_output&quot; version:2
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_registry@2.global name:5 interface:&quot;wl_data_device_manager&quot; version:3
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_registry@2.global name:6 interface:&quot;zxdg_output_manager_v1&quot; version:3
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_registry@2.global name:7 interface:&quot;gtk_primary_selection_device_manager&quot; version:1
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_registry@2.global name:8 interface:&quot;wl_seat&quot; version:5
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_callback@3.done callback_data:1129040&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;The callback tells the client it has seen all the available services, and so it now picks the ones it wants.
It has to choose a version no higher than the one offered by the server.
Protocols starting with &lt;code&gt;wl_&lt;/code&gt; are from of the core Wayland protocol; the others are extensions.
The leading &lt;code&gt;z&lt;/code&gt; in &lt;code&gt;zxdg_output_manager_v1&lt;/code&gt; indicates that the protocol is “unstable” (under development).&lt;/p&gt;

&lt;p&gt;The protocols are defined in various XML files, which are scattered over the web.
The core protocol is defined in &lt;a href=&quot;https://github.com/wayland-project/wayland/blob/master/protocol/wayland.xml&quot;&gt;wayland.xml&lt;/a&gt;.
These XML files can be used to generate typed bindings for your programming language of choice.&lt;/p&gt;

&lt;p&gt;Here, the application picks &lt;code&gt;wl_compositor&lt;/code&gt; (for managing drawing surfaces), &lt;code&gt;wl_shm&lt;/code&gt; (for sharing memory with the server),
and &lt;code&gt;xdg_wm_base&lt;/code&gt; (for desktop windows).&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; wl_registry@2.bind name:0 id:+4(wl_compositor:v4)
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; wl_registry@2.bind name:2 id:+5(wl_shm:v1)
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; wl_registry@2.bind name:3 id:+6(xdg_wm_base:v1)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;The bind message is unusual in that the client gives the interface and version of the object it is creating.
For other messages, both sides know the type from the schema, and the version is always the same as the parent object.
Because the client chose the new IDs, it doesn’t need to wait for the server;
it continues by using the new objects to create a top-level window:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; wl_compositor@4.create_surface id:+7
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; xdg_wm_base@6.get_xdg_surface id:+8 surface:7
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; xdg_surface@8.get_toplevel id:+9
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; xdg_toplevel@9.set_title title:&quot;example app&quot;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; wl_surface@7.commit &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;This API is pretty strange.
The core Wayland protocol says how to make generic drawing surfaces, but not how to make windows,
so the application is using the &lt;code&gt;xdg_wm_base&lt;/code&gt; extension to do that.
Logically, there’s only one object here (a toplevel window),
but it ends up making three separate Wayland objects representing the different aspects of it.&lt;/p&gt;

&lt;p&gt;The &lt;code&gt;commit&lt;/code&gt; tells the server that the client has finished setting up the window and the server should
now do something with it.&lt;/p&gt;

&lt;p&gt;The above was all in response to the callback firing.
The client now processes the last message in that batch, which is the server destroying the callback:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_display@1.delete_id id:3&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;Object destruction is a bit strange in Wayland.
Normally, clients ask for things to be destroyed (by sending a “destructor” message)
and the server confirms by sending &lt;code&gt;delete_id&lt;/code&gt; from object 1.
But this isn’t symmetrical: there is no standard way for a client to confirm deletion when the server calls
a destructor (such as the callback’s &lt;code&gt;done&lt;/code&gt;), so these have to be handled on a case-by-case basis.
Since callbacks don’t accept any messages, there is no need for the client to confirm that it got the &lt;code&gt;done&lt;/code&gt;
message and the server just sends a delete message immediately.&lt;/p&gt;

&lt;p&gt;The client now waits for the server to respond to all the messages it sent about the new window,
and gets a bunch of replies:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;9&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_shm@5.format format:0
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_shm@5.format format:1
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_shm@5.format format:875709016
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_shm@5.format format:875708993
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- xdg_wm_base@6.ping serial:1129043
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; xdg_wm_base@6.pong serial:1129043
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- xdg_toplevel@9.configure width:0 height:0 states:&quot;&quot;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- xdg_surface@8.configure serial:1129042
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; xdg_surface@8.ack_configure serial:1129042&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;It gets some messages telling it what pixel formats are supported, a ping message (which the server sends from time to time to check the client is still alive),
and a configure message giving the size for the new window.
Oddly, Sway has set the size to 0x0, which means the client should choose whatever size it likes.&lt;/p&gt;

&lt;p&gt;The client picks a suitable default size, allocates some shared memory (by opening a tmpfs file and immediately unlinking it),
shares the file descriptor with the server (&lt;code&gt;create_pool&lt;/code&gt;), and then carves out a portion of the memory to use as a buffer for the pixel data:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; wl_shm@5.create_pool id:+3 fd:(fd) size:1228800
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; wl_shm_pool@3.create_buffer id:+10 offset:0 width:640 height:480 stride:2560 format:1
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; wl_shm_pool@3.destroy &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;In this case it used the whole memory region. It could also have allocated two buffers for double-buffering.
The client then draws whatever it wants into the buffer (mapping the file into its memory and writing to it directly),
attaches the buffer to the window’s surface, marks the whole area as “damaged” (in need of being redrawn) and calls &lt;code&gt;commit&lt;/code&gt;,
telling the server the surface is ready for display:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; wl_surface@7.attach buffer:10 x:0 y:0
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; wl_surface@7.damage x:0 y:0 width:2147483647 height:2147483647
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; wl_surface@7.commit &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;At this point the window appears on the screen!
The server lets the client know it has finished with the buffer and the client destroys it:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_display@1.delete_id id:3
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- wl_buffer@10.release 
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; wl_buffer@10.destroy &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;Although the window is visible, the content is the wrong size.
Sway now suddenly remembers that it’s a tiling window manager.
It sends another &lt;code&gt;configure&lt;/code&gt; event with the correct size, causing the client to allocate a fresh memory pool of the correct size,
allocate a fresh buffer from it, redraw everything at the new size, and tell the server to draw it.&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;- xdg_toplevel@9.configure width:1534 height:1029 states:&quot;&quot;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;This process of telling the client to pick a size and then overruling it explains why Firefox draws itself incorrectly at first and then flickers into position a moment later. It probably also explains why Vim tries to open a 0x0 window.&lt;/p&gt;

&lt;h3 id=&quot;copying-text&quot;&gt;Copying text&lt;/h3&gt;

&lt;p&gt;A bit of searching revealed that the &lt;code&gt;^M&lt;/code&gt; problem is a known &lt;a href=&quot;https://github.com/swaywm/wlroots/issues/1839&quot;&gt;Sway bug&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;However, the main reason copying text wasn’t working turned out to be a limitation in the design of the core &lt;code&gt;wl_data_device_manager&lt;/code&gt; protocol.
The normal way to copy text on X11 is to select the text you want to copy,
then click the middle mouse button where you want it (or press Shift-Insert).&lt;/p&gt;

&lt;p&gt;X also supports a clipboard mechanism, where you select text, then press Ctrl-C, then click at the destination, then press Ctrl-V.
The original Wayland protocol only supports the clipboard system, not the selection, and so Wayland compositors have added selection support through extensions.
Sommelier didn’t proxy these extensions, leading to failure when copying in or out of VMs.&lt;/p&gt;

&lt;p&gt;I also found that the reason weston-terminal wouldn’t start was because I didn’t have anything in my clipboard,
and sommelier was trying to dereference a null pointer.&lt;/p&gt;

&lt;p&gt;One problem with the Wayland protocol is that it’s very hard to proxy.
Although the wire protocol gives the length in bytes of each message, it doesn’t say how many file descriptors it has.
This means that you can’t just pass through messages you don’t understand, because you don’t know which FDs go with which message.
Also, the wire protocol doesn’t give types for FDs (nor does the schema),
which is a problem for anything that needs to proxy across a VM boundary or over a network.&lt;/p&gt;

&lt;p&gt;This all meant that VMs could only use protocols explicitly supported by sommelier, and sommelier limited the version too.
Which means that supporting extra extensions or new versions means writing (and debugging) loads of C++ code.&lt;/p&gt;

&lt;p&gt;I didn’t have time to write and debug C++ code for every missing Wayland protocol, so I took a short-cut:
I wrote my own Wayland library, &lt;a href=&quot;https://github.com/talex5/ocaml-wayland&quot;&gt;ocaml-wayland&lt;/a&gt;, and then used that to write my own version of sommelier.
With that, adding support for copying text was fairly easy.&lt;/p&gt;

&lt;p&gt;For each Wayland interface we need to handle each incoming message from the client and forward it to the host,
and also forward each message from the host to the client.
Here’s &lt;a href=&quot;https://github.com/talex5/wayland-virtwl-proxy/blob/29333ac7e6071a1c08ece77b513f4b0ee3ee8f8e/relay.ml#L587&quot;&gt;the code&lt;/a&gt; to handle the “selection” event in OCaml,
which we receive from the host and send to the client (&lt;code&gt;c&lt;/code&gt;):&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;ocaml&quot;&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;k&quot;&gt;method&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on_selection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Wl_data_device&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;selection&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Option&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to_client&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;The host passes us an “offer” argument, which is a previously-created host offer object.
We look up the corresponding client object with &lt;code&gt;to_client&lt;/code&gt; and pass that as the argument
to the client.&lt;/p&gt;

&lt;p&gt;For comparison, here’s &lt;a href=&quot;https://chromium.googlesource.com/chromiumos/platform2/+/7ea49bbabed436e608a0b8974ec90366a787d841/vm_tools/sommelier/sommelier-data-device-manager.cc#492&quot;&gt;sommelier’s equivalent&lt;/a&gt; to this line of code, in C++:&lt;/p&gt;

&lt;div class=&quot;bogus-wrapper&quot;&gt;&lt;notextile&gt;&lt;figure class=&quot;code&quot;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&quot;line-number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;6&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;7&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;9&lt;/span&gt;
&lt;span class=&quot;line-number&quot;&gt;10&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;c&quot;&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sl_data_device_selection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;                                     &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wl_data_device&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data_device&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;                                     &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wl_data_offer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data_offer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sl_host_data_device&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;host&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;static_cast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sl_host_data_device&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;n&quot;&gt;wl_data_device_get_user_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data_device&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sl_host_data_offer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;host_data_offer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;n&quot;&gt;static_cast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sl_host_data_offer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wl_data_offer_get_user_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data_offer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;n&quot;&gt;wl_data_device_send_selection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;resource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;host_data_offer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;resource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;

&lt;p&gt;I think this is a great demonstration of the difference between “type safety” and “type ceremony”.
The C++ code is covered in types, making the code very hard to read, yet it crashes at runtime because it
fails to consider that &lt;code&gt;data_offer&lt;/code&gt; can be &lt;code&gt;NULL&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;By contract, the OCaml version has no type annotations, but the compiler would reject if I forgot to handle this (with &lt;code&gt;Option.map&lt;/code&gt;).&lt;/p&gt;

&lt;h3 id=&quot;security&quot;&gt;Security&lt;/h3&gt;

&lt;p&gt;According to &lt;a href=&quot;https://wiki.gnome.org/Initiatives/Wayland/PrimarySelection&quot;&gt;the GNOME wiki&lt;/a&gt;, the original justification for not supporting selection copies was
“security concerns with unexpected data stealing if the mere act of selecting a text fragment makes it available to all running applications”.
The implication is that applications stealing data instead from the clipboard is OK,
and that you should therefore never put anything confidential on the clipboard.&lt;/p&gt;

&lt;p&gt;This seemed a bit odd, so I read the &lt;a href=&quot;https://wayland.freedesktop.org/docs/html/ch04.html#sect-Protocol-Security-and-Authentication&quot;&gt;security section&lt;/a&gt; of the Wayland specification to learn more about its security model.
That section of the specification is fairly short, so I’ll reproduce it here in full:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Security and Authentication&lt;/strong&gt;&lt;/p&gt;

  &lt;ul&gt;
    &lt;li&gt;mostly about access to underlying buffers, need new drm auth mechanism (the grant-to ioctl idea), need to check the cmd stream?&lt;/li&gt;
    &lt;li&gt;getting the server socket depends on the compositor type, could be a system wide name, through fd passing on the session dbus. or the client is forked by the compositor and the fd is already opened.&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;It looks like implementations have to figure things out for themselves.&lt;/p&gt;

&lt;p&gt;The main advantage of Wayland over X11 here is that Wayland mostly isolates applications from each other.
In X11 applications collaborate together to manage a tree of windows, and any application can access any window.
In the Wayland protocol, each application’s connection only includes that application’s objects.
Applications only get events relevant to their own windows
(for example, you only get pointer motion events while the pointer is over your window).
Communication between applications (e.g. copy-and-paste or drag-and-drop) is all handled though the compositor.&lt;/p&gt;

&lt;p&gt;Also, to request the contents of the clipboard you need to quote the serial number of the mouse click or key press that triggered it.
If it’s too far in the past, the compositor can ignore the request.&lt;/p&gt;

&lt;p&gt;I’ve also heard people say that security is the reason you can’t take screenshots with Wayland.
However, Sway lets you take screenshots, and this worked even from inside a VM through virtwl.
I didn’t add screenshot support to the proxy, because I don’t want VMs to be able to take screenshots,
but the proxy isn’t a security tool (it runs inside the VM, which isn’t trusted).&lt;/p&gt;

&lt;p&gt;Clearly, the way to fix this was with a new compositor.
One that would offer a different Wayland socket to each VM, tag the windows with the VM name, colour the frames,
confirm copies across VM boundaries, and work with Vim.
Luckily, I already had a handy pure-OCaml Wayland protocol library available.
Unluckily, at this point I ran out of holiday.&lt;/p&gt;

&lt;h2 id=&quot;future-work&quot;&gt;Future work&lt;/h2&gt;

&lt;p&gt;There are quite a few things left to do here:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;One problem with &lt;code&gt;virtwl&lt;/code&gt; is that, while we can receive shared memory FDs &lt;em&gt;from&lt;/em&gt; the host, we can’t export guest memory &lt;em&gt;to&lt;/em&gt; the host.
This is unfortunate, because in Wayland the shared memory for window contents is allocated by the application from guest memory,
and the proxy therefore has to copy each frame. If the host provided the memory to the guest, this wouldn’t be needed.
There is a &lt;code&gt;wl_drm&lt;/code&gt; protocol for allocating video memory, which might help here, but I don’t know how that works and,
like many Wayland specifications, it seems to be in the process of being replaced by something else.
Also, if we’re going to copy the memory, we should at least only copy the damaged region, not the whole thing.
I only got this code working just far enough to run the Wayland applications I use (mainly Firefox and Evince).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;I’m still using ssh to proxy X11 connections (mainly for Vim and gitk).
I’d prefer to run Xwayland in the VM, but it seems you need to provide a bit of &lt;a href=&quot;https://wayland.freedesktop.org/docs/html/ch05.html&quot;&gt;extra support&lt;/a&gt; for that,
which I haven’t implemented yet.
Sommelier can do this, but then copying doesn’t work.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The host Wayland compositor needs to be aware of VMs, so it can colour the titles appropriately and
limit access to privileged operations.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;For the full Qubes experience, the network card should be handled by a VM, with another VM managing the firewall.
Perhaps the &lt;a href=&quot;https://github.com/mirage/qubes-mirage-firewall/&quot;&gt;Mirage unikernel firewall&lt;/a&gt; could be made to work on KVM too.
I’m not sure how guest-to-guest communication works with KVM.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;However, because the host NixOS environment is a fully-working Linux system,
I can always trade off some security to get things working
(e.g. by doing video conferencing directly on the host).&lt;/p&gt;

&lt;p&gt;I hope the SpectrumOS project will resume at some point,
or that Qubes will find a solution to its hardware compatibility and performance problems.&lt;/p&gt;

</content><id>https://roscidus.com/blog/blog/2021/03/07/qubes-lite-with-kvm-and-wayland</id><title xml:base="http://roscidus.com/blog/blog/categories/ocaml/atom.xml" type="html">Qubes-lite with KVM and Wayland</title><updated>2021-03-07T15:00:00-00:00</updated><author><name>Thomas Leonard</name></author></entry><entry><source><updated>2021-03-04T00:00:00-00:00</updated><link title="Tarides RSS Feed" type="text/html" href="https://tarides.com" rel="related"/><link title="Tarides RSS Feed" type="application/rss+xml" href="https://tarides.com/feed.xml" rel="self"/><generator>GatsbyJS</generator><id>https://tarides.com</id><title type="text">Tarides RSS Feed</title><author><name>Tarides</name></author></source><link href="https://tarides.com/blog/2021-03-04-florence-and-beyond-the-future-of-tezos-storage" rel="alternate"/><content xml:base="https://tarides.com/feed.xml" type="html">&lt;p&gt;In collaboration with Nomadic Labs, Marigold and DaiLambda, we're happy to
announce the completion of the next Tezos protocol proposal:
&lt;a href=&quot;http://doc.tzalpha.net/protocols/009_florence.html&quot;&gt;&lt;strong&gt;Florence&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://tezos.com/&quot;&gt;Tezos&lt;/a&gt; is an open-source decentralised blockchain network providing a
platform for smart contracts and digital assets. A crucial feature of Tezos is
&lt;a href=&quot;https://tezos.com/static/white_paper-2dc8c02267a8fb86bd67a108199441bf.pdf&quot;&gt;&lt;em&gt;self-amendment&lt;/em&gt;&lt;/a&gt;: the network protocol can be upgraded
dynamically by the network participants themselves. This amendment process is
initiated when a participant makes a &lt;em&gt;proposal&lt;/em&gt;, which is then subject to a
vote. After several years working on the Tezos storage stack, this is our first
contribution to a proposal; we hope that it will be the first of many!&lt;/p&gt;
&lt;p&gt;As detailed in today's &lt;a href=&quot;https://blog.nomadic-labs.com/florence-our-next-protocol-upgrade-proposal.html&quot;&gt;announcement from Nomadic Labs&lt;/a&gt;,
the Florence proposal contains several important changes, from the introduction
of Baking Accounts to major quality-of-life improvements for smart contract
developers. Of all of these changes, we're especially excited about the
introduction of &lt;em&gt;sub-trees&lt;/em&gt; to the blockchain context API. In this post, we'll
give a brief tour of what these sub-trees will bring for the future of Tezos.
But first, what &lt;em&gt;are&lt;/em&gt; they?&lt;/p&gt;
&lt;h3 id=&quot;merkle-sub-trees&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#merkle-sub-trees&quot; aria-label=&quot;merkle sub trees permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Merkle sub-trees&lt;/h3&gt;
&lt;p&gt;The Tezos protocol runs on top of a versioned tree called the “context”, which
holds the chain state (balances, contracts etc.). Ever since the pre-Alpha era,
the Tezos context has been implemented using &lt;a href=&quot;https://github.com/mirage/irmin&quot;&gt;Irmin&lt;/a&gt; – an open-source
Merkle tree database originally written for use by MirageOS unikernels.&lt;/p&gt;
&lt;p&gt;For MirageOS, Irmin’s key strength is flexibility: it can run over arbitrary
backends. This is a perfect fit for Tezos, which must be agile and
widely-deployable. Indeed, the Tezos shell has already leveraged this agility
many times, all the way from initial prototypes using a Git backend to the
optimised &lt;a href=&quot;https://tarides.com/blog/2020-09-01-introducing-irmin-pack&quot;&gt;&lt;code&gt;irmin-pack&lt;/code&gt;&lt;/a&gt; implementation used today.&lt;/p&gt;
&lt;p&gt;But Irmin can do more than just swapping backends! It also allows users to
manipulate the underlying Merkle tree structure of the store with a high-level
API. This “&lt;a href=&quot;https://mirage.github.io/irmin/irmin/Irmin/module-type-S/Tree/&quot;&gt;Tree&lt;/a&gt;” API enables lots of interesting use-cases of
Irmin, from mergeable data types (&lt;a href=&quot;https://kcsrk.info/papers/banyan_aplas20.pdf&quot;&gt;MRDTs&lt;/a&gt;) to zero-knowledge proofs.
Tezos doesn't use these more powerful features directly yet; that’s where Merkle
proofs come in!&lt;/p&gt;
&lt;h3 id=&quot;proofs-and-lightweight-tezos-clients&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#proofs-and-lightweight-tezos-clients&quot; aria-label=&quot;proofs and lightweight tezos clients permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Proofs and lightweight Tezos clients&lt;/h3&gt;
&lt;p&gt;Since the Tezos context keeps track of the current &quot;state&quot; of the blockchain,
each participant needs their own copy of the tree to run transactions against.
This context can grow to be very large, so it's important that it be stored as
compactly as possible: this goal shaped the design of &lt;code&gt;irmin-pack&lt;/code&gt;, our latest
Irmin backend.&lt;/p&gt;
&lt;p&gt;However, it's possible to reduce the storage requirements even further via the
magic of Merkle trees: individuals only need to store a &lt;em&gt;fragment&lt;/em&gt; of the root
tree, provided they can demonstrate that this fragment is valid by sending
“&lt;a href=&quot;https://bentnib.org/posts/2016-04-12-authenticated-data-structures-as-a-library.html&quot;&gt;proofs&lt;/a&gt;” of its membership to the other participants.&lt;/p&gt;
&lt;p&gt;This property can be used to support ultra-lightweight Tezos clients, a feature
&lt;a href=&quot;https://gitlab.com/smelc/tezos/-/commits/tweag-client-light-mode&quot;&gt;currently being developed&lt;/a&gt; by TweagIO. To make this a reality,
the Tezos protocol needs fine-grained access to context sub-trees in order build
Merkle proofs out of them. Fortunately, Irmin already supports this! We
&lt;a href=&quot;https://gitlab.com/tezos/tezos/-/merge_requests/2457&quot;&gt;extended the protocol&lt;/a&gt; to understand sub-trees, lifting the power
of Merkle trees to the user.&lt;/p&gt;
&lt;p&gt;We’re excited to work with TweagIO and Nomadic Labs on lowering the barriers to
entering the Tezos ecosystem and look forward to seeing what they achieve with
sub-trees!&lt;/p&gt;
&lt;h3 id=&quot;efficient-merkle-proof-representations&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#efficient-merkle-proof-representations&quot; aria-label=&quot;efficient merkle proof representations permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Efficient Merkle proof representations&lt;/h3&gt;
&lt;p&gt;Simply exposing sub-trees in the Tezos context API isn’t quite enough:
lightweight clients will also need to &lt;em&gt;serialize&lt;/em&gt; them efficiently, since proofs
must be exchanged over the network to establish trust between collaborating
nodes. Enter &lt;a href=&quot;https://dailambda.jp/blog/2020-05-11-plebeia/&quot;&gt;Plebeia&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Plebeia is an alternative Tezos storage layer – developed by DaiLambda – with
strengths that complement those of Irmin. In particular, Plebeia is capable of
generating very compact Merkle proofs. This is partly due to its specialized
store structure, and partly due to clever optimizations such as path compression
and inlining.&lt;/p&gt;
&lt;p&gt;We’re working with the DaiLambda team to unite the strengths of Irmin and
Plebeia, which will bring built-in Merkle proof support to the Tezos storage
stack. The future is bright for Merkle proofs in Tezos!&lt;/p&gt;
&lt;h3 id=&quot;baking-account-migrations&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#baking-account-migrations&quot; aria-label=&quot;baking account migrations permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Baking account migrations&lt;/h3&gt;
&lt;p&gt;Trees don’t just enable &lt;em&gt;new&lt;/em&gt; features; they have a big impact on performance
too! Currently, indexing into the context always happens from its &lt;em&gt;root&lt;/em&gt;, which
duplicates effort when accessing adjacent values deep in the tree. Fortunately,
the new sub-trees provide a natural representation for “cursors” into the
context, allowing the protocol to optimize its interactions with the storage
layer.&lt;/p&gt;
&lt;p&gt;To take just one example, DaiLambda recently exploited this feature to reduce
the migration time necessary to introduce Baking Accounts to the network by a
factor of 15! We’ll be teaming up with Nomadic Labs and DaiLambda to ensure that
Tezos extracts every bit of performance from its storage.&lt;/p&gt;
&lt;p&gt;It's especially exciting to have access to lightning-fast storage migrations,
since this enables Tezos to evolve rapidly even as the ecosystem expands.&lt;/p&gt;
&lt;h3 id=&quot;storage-in-other-languages&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#storage-in-other-languages&quot; aria-label=&quot;storage in other languages permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Storage in other languages&lt;/h3&gt;
&lt;p&gt;Of course, Tezos isn’t just an OCaml project: the storage layer also has a
performant Rust implementation as part of &lt;a href=&quot;https://github.com/simplestaking/tezedge&quot;&gt;TezEdge&lt;/a&gt;. We’re working with
&lt;a href=&quot;https://github.com/simplestaking&quot;&gt;Simple Staking&lt;/a&gt; to bring Irmin to the Rust community via an
&lt;a href=&quot;https://github.com/simplestaking/ocaml-interop&quot;&gt;FFI toolchain&lt;/a&gt;, enabling closer alignment between the different
Tezos shell implementations.&lt;/p&gt;
&lt;h3 id=&quot;conclusion&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;All in all, it’s an exciting time to work on Tezos storage, with many
open-source collaborators from around the world. We’re especially happy to see
Tezos taking greater advantage of Irmin’s features, which will strengthen both
projects and help them grow together.&lt;/p&gt;
&lt;p&gt;If all of this sounds interesting, you can play with it yourself using the
recently-released &lt;a href=&quot;https://github.com/mirage/irmin&quot;&gt;Irmin 2.5.0&lt;/a&gt;. Thanks for reading, and stay tuned for
future Tezos development updates!&lt;/p&gt;</content><id>https://tarides.com/blog/2021-03-04-florence-and-beyond-the-future-of-tezos-storage.html</id><title type="text">Florence and beyond: the future of Tezos storage</title><updated>2021-03-04T00:00:00-00:00</updated><author><name>Tarides</name></author></entry><entry><source><updated>2021-03-03T15:00:00-00:00</updated><link title="ReScript Blog" type="text/html" href="https://rescript-lang.org" rel="related"/><link title="ReScript Blog" type="application/rss+xml" href="https://rescript-lang.org/blog/feed.xml" rel="self"/><id>https://rescript-lang.org</id><title type="text">ReScript Blog</title><author><name>Reason Documentation Blog</name></author></source><link href="%20https://rescript-lang.org/blog/rescript-association-rebranding%20" rel="alternate"/><content xml:base="https://rescript-lang.org/blog/feed.xml" type="html">
        After the rebranding of ReScript, its Reason Association has now followed through to become the ReScript Association.

        </content><id>%20https://rescript-lang.org/blog/rescript-association-rebranding%20</id><title type="text"> The ReScript Association</title><updated>2021-03-03T15:00:00-00:00</updated><author><name>Reason Documentation Blog</name></author></entry><entry><source><updated>2021-02-26T00:00:00-00:00</updated><link title="The Coq Proof Assistant" type="text/html" href="https://coq.inria.fr" rel="related"/><link title="The Coq Proof Assistant" type="application/rss+xml" href="https://coq.inria.fr/rss.xml" rel="self"/><id>https://coq.inria.fr</id><title type="text">The Coq Proof Assistant</title><author><name>Coq</name></author></source><link href="https://coq.inria.fr/news/coq-platform-2021.02.0-is-out.html" rel="alternate"/><content xml:base="https://coq.inria.fr/rss.xml" type="html">

&lt;p&gt;
The Coq development team is proud to announce the immediate availability of
the &lt;a href=&quot;https://github.com/coq/platform/releases/tag/2021.02.0&quot;&gt;Coq Platform 2021.02.0&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
The Coq platform is a distribution of the Coq proof assistant together
with a selection of Coq libraries. It provides a set of scripts to
compile and install OPAM, Coq, Coq libraries and Coq plugins on MacOS,
Windows and many Linux distributions in a reliable way with consistent
results.
&lt;/p&gt;

&lt;p&gt;
This release is based on Coq 8.13.1 and provides binary installers
for Windows and Linux. We plan to release 2021.02.1 as soon as the
MacOS installer is ready. The following point releases, starting with
2021.02.2, will focus on including more Coq libraries (and no
breaking change).
&lt;/p&gt;


 </content><id>https://coq.inria.fr/news/coq-platform-2021.02.0-is-out.html</id><title type="text">Coq Platform 2021.02.0 is out</title><updated>2021-02-26T00:00:00-00:00</updated><author><name>Coq</name></author></entry><entry><source><updated>2021-02-26T00:00:00-00:00</updated><link title="The Coq Proof Assistant" type="text/html" href="https://coq.inria.fr" rel="related"/><link title="The Coq Proof Assistant" type="application/rss+xml" href="https://coq.inria.fr/rss.xml" rel="self"/><id>https://coq.inria.fr</id><title type="text">The Coq Proof Assistant</title><author><name>Coq</name></author></source><link href="https://coq.inria.fr/news/coq-8-13-1-is-out.html" rel="alternate"/><content xml:base="https://coq.inria.fr/rss.xml" type="html">

&lt;p&gt;
The Coq development team is proud to announce the immediate availability of
&lt;a href=&quot;https://github.com/coq/coq/releases/tag/V8.13.1&quot;&gt;Coq 8.13.1&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
Hotfix:
&lt;ul&gt;
&lt;li&gt;Fix arities of VM opcodes for some floating-point operations
  that could cause memory corruption &lt;/li&gt;
&lt;/ul&gt;
&lt;/p&gt;


&lt;p&gt;Please see &lt;a href=&quot;https://coq.github.io/doc/v8.13/refman/changes.html#version-8-13&quot; rel=&quot;nofollow&quot;&gt;the changelog&lt;/a&gt; to learn more about this release.&lt;/p&gt;


 </content><id>https://coq.inria.fr/news/coq-8-13-1-is-out.html</id><title type="text">Coq 8.13.1 is out</title><updated>2021-02-22T00:00:00-00:00</updated><author><name>Coq</name></author></entry><entry><summary xml:base="http://math.andrej.com/feed.xml" type="html">This is joint work with Marc Bezem, Thierry Coquand, Peter Dybjer. We use the Burali-Forti argument to show that, in homotopy type theory and univalent foundations, the embedding $$ \mathcal{U} \to \mathcal{U}^+$$ of a universe $\mathcal{U}$ into its successor $\mathcal{U}^+$ is not an equivalence. We also establish this for the types of sets, magmas, monoids and groups. The arguments in this post are also written in Agda.</summary><source><updated>2021-02-24T17:51:19-00:00</updated><subtitle type="text">A blog about mathematics for computers</subtitle><link type="text/html" href="http://math.andrej.com/" rel="alternate"/><link type="application/atom+xml" href="http://math.andrej.com/feed.xml" rel="self"/><generator uri="https://jekyllrb.com/" version="4.2.0">Jekyll</generator><id>http://math.andrej.com/feed.xml</id><title xml:base="http://math.andrej.com/feed.xml" type="html">Mathematics and Computation</title><author><name>Andrej Bauer</name></author></source><published>2021-02-21T23:00:00-00:00</published><link title="The Burali-Forti argument in HoTT/UF" type="text/html" href="http://math.andrej.com/2021/02/22/burali-forti-in-hott-uf/" rel="alternate"/><content xml:base="http://math.andrej.com/feed.xml" type="html">&lt;p&gt;This is joint work with &lt;a href=&quot;https://www.uib.no/en/persons/Marcus.Aloysius.Bezem&quot;&gt;Marc Bezem&lt;/a&gt;, &lt;a href=&quot;https://www.cse.chalmers.se/~coquand/&quot;&gt;Thierry Coquand&lt;/a&gt;, &lt;a href=&quot;https://www.cse.chalmers.se/~peterd/&quot;&gt;Peter Dybjer&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We use the
&lt;a href=&quot;https://en.wikipedia.org/wiki/Burali-Forti_paradox&quot;&gt;Burali-Forti&lt;/a&gt;
argument to show that, in &lt;a href=&quot;https://homotopytypetheory.org/&quot;&gt;homotopy type theory and univalent foundations&lt;/a&gt;,
the embedding $$ \mathcal{U} \to \mathcal{U}^+$$ of a universe
$\mathcal{U}$ into its successor $\mathcal{U}^+$ is not an
equivalence.  We also establish this for the types of sets, magmas, monoids and
groups. The arguments in this post are also &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/BuraliForti.html#Burali-Forti&quot;&gt;written&lt;/a&gt; in
&lt;a href=&quot;https://agda.readthedocs.io/en/v2.6.1.3/&quot;&gt;Agda&lt;/a&gt;.&lt;/p&gt;

&lt;!--more--&gt;

&lt;h4 id=&quot;ordinals-in-univalent-type-theory&quot;&gt;Ordinals in univalent type theory&lt;/h4&gt;

&lt;p&gt;The Burali-Forti paradox is about the collection of all ordinals. In set theory, this collection cannot be a set, because it is too big, and this is what the Burali-Forti argument shows. This collection is a &lt;a href=&quot;https://en.wikipedia.org/wiki/Class_(set_theory)&quot;&gt;proper class&lt;/a&gt; in set theory.&lt;/p&gt;

&lt;p&gt;In univalent type theory, we can collect all ordinals of a universe $\mathcal{U}$ in
a type $\operatorname{Ordinal}\,\mathcal{U}$ that lives in the
successor universe $\mathcal{U}^+$: $$
\operatorname{Ordinal}\,\mathcal{U} : \mathcal{U}^+.$$ See Chapter
10.3 of the &lt;a href=&quot;https://homotopytypetheory.org/book/&quot;&gt;HoTT book&lt;/a&gt;, which
uses univalence to show that this type is a set in the sense of
univalent foundations (meaning that its equality is proposition valued).&lt;/p&gt;

&lt;p&gt;The analogue in type theory of the notion of proper
class in set theory is that of &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/UF-Size.html#is-large&quot;&gt;large
type&lt;/a&gt;,
that is, a type in a successor universe $\mathcal{U}^+$ that doesn't
have a copy in the universe $\mathcal{U}$. In this post we show that the type of ordinals is large and derive some consequences from this.&lt;/p&gt;

&lt;p&gt;We have two further uses of univalence, at least:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;to adapt the Burali-Forti argument from set theory to our type theory, and&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;to resize down the values of the order relation of the ordinal
of ordinals, to conclude that the ordinal of ordinals is large.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;There are also a number of uses of univalence via functional and
propositional extensionality.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://unimath.github.io/bham2017/UniMath_origins-present-future.pdf&quot;&gt;Propositional resizing&lt;/a&gt;
rules or axioms are not needed, thanks to (2).&lt;/p&gt;

&lt;p&gt;An ordinal in a universe $\mathcal{U}$ is a type $X : \mathcal{U}$ equipped with a relation
$$ - \prec - : X \to X \to \mathcal{U}$$&lt;/p&gt;

&lt;p&gt;required to be&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;proposition valued,&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;transitive,&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;extensional (any two points with same lower set are the same),&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;well founded (every element is accessible, or, equivalently, the
principle of &lt;a href=&quot;https://en.wikipedia.org/wiki/Transfinite_induction&quot;&gt;transfinite
induction&lt;/a&gt;
holds).&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The HoTT book additionally requires $X$ to be a set, but this &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/OrdinalNotions.html#extensionally-ordered-types-are-sets&quot;&gt;follows
automatically&lt;/a&gt; from the above requirements for the order.&lt;/p&gt;

&lt;p&gt;The underlying type of an ordinal $\alpha$ is denoted by $\langle
\alpha \rangle$ and its order relation is denoted by $\prec_{\alpha}$ or simply $\prec$ when we believe the reader will be able to infer the missing subscript.&lt;/p&gt;

&lt;p&gt;Equivalence of ordinals in universes $\mathcal{U}$ and $\mathcal{V}$,
$$    -\simeq_o- : \operatorname{Ordinal}\,\mathcal{U} \to \operatorname{Ordinal}\,\mathcal{V} \to \mathcal{U} \sqcup \mathcal{V},$$
means that there is an equivalence of the underlying types that
preserves and reflects order. Here we denote by $\mathcal{U} \sqcup \mathcal{V}$ the least upper bound of the two universes $\mathcal{U}$ and $\mathcal{V}$. The precise definition of the type theory we adopt here, including the handling of universes, can be found in &lt;a href=&quot;https://www.cambridge.org/core/journals/mathematical-structures-in-computer-science/article/injective-types-in-univalent-mathematics/AFCBBABE47F29ED7AFB4C262929D8810&quot;&gt;Section 2 of this paper&lt;/a&gt; and also in our &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/HoTT-UF-in-Agda-Lecture-Notes/index.html&quot;&gt;Midlands Graduate School 2019 lecture notes&lt;/a&gt; in Agda form.&lt;/p&gt;

&lt;p&gt;For ordinals $\alpha$ and $\beta$ in the &lt;strong&gt;same&lt;/strong&gt; universe, their
identity type $\alpha = \beta$ is canonically equivalent to the
ordinal-equivalence type $\alpha \simeq_o \beta$, by univalence.&lt;/p&gt;

&lt;p&gt;The lower set of a point $x : \langle \alpha \rangle$ is written
$\alpha \downarrow x$, and is itself an ordinal under the inherited
order. The ordinals in a universe $\mathcal{U}$ form an ordinal in the
successor universe $\mathcal{U}^+$, denoted by
$$ \operatorname{OO}\,\mathcal{U} : \operatorname{Ordinal}\,\mathcal{U}^+,$$
for &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/OrdinalOfOrdinals.html#OO&quot;&gt;ordinal of ordinals&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Its underlying type is $\operatorname{Ordinal}\,\mathcal{U}$ and
its order relation is denoted by $-\triangleleft-$ and is defined by
$$\alpha \triangleleft \beta = \Sigma b : \langle \beta \rangle , \alpha = (\beta \downarrow b).$$&lt;/p&gt;

&lt;p&gt;This order has type $$-\triangleleft- : \operatorname{Ordinal}\,\mathcal{U} \to
\operatorname{Ordinal}\,\mathcal{U} \to \mathcal{U}^+,$$ as required for it to make the
type $\operatorname{\operatorname{Ordinal}} \mathcal{U}$ into an ordinal in the next
universe.&lt;/p&gt;

&lt;p&gt;By univalence, this order is equivalent to the
order defined by
$$\alpha \triangleleft^- \beta = \Sigma b : \langle \beta \rangle , \alpha \simeq_o (\beta \downarrow b).$$
This has the more general type
$$ -\triangleleft^-- : \operatorname{\operatorname{Ordinal}}\,\mathcal{U} \to \operatorname{\operatorname{Ordinal}}\,\mathcal{V} \to \mathcal{U} \sqcup \mathcal{V},$$
so that we can compare ordinals in different universes. But also when the universes $\mathcal{U}$ and $\mathcal{V}$ are the same, this order has values in $\mathcal{U}$ rather than $\mathcal{U}^+$. The existence of such a resized-down order is crucial for our
corollaries of Burali-Forti, but not for Burali-Forti itself.&lt;/p&gt;

&lt;p&gt;For any $\alpha : \operatorname{Ordinal}\,\mathcal{U}$ we have
$$ \alpha \simeq_o (\operatorname{OO}\,\mathcal{U} \downarrow \alpha),$$
so that $\alpha$ is an initial segment of the ordinal of ordinals, and hence
$$ \alpha \triangleleft^- \operatorname{OO}\,\mathcal{U}.$$&lt;/p&gt;

&lt;h4 id=&quot;the-burali-forti-theorem-in-hottuf&quot;&gt;The Burali-Forti theorem in HoTT/UF&lt;/h4&gt;

&lt;p&gt;We adapt the original formulation and argument from set theory.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Theorem&lt;/strong&gt;. No ordinal in a universe $\mathcal{U}$ can be equivalent to the ordinal of all ordinals in $\mathcal{U}$.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;Proof.&lt;/strong&gt; Suppose, for the &lt;a href=&quot;http://math.andrej.com/2010/03/29/proof-of-negation-and-proof-by-contradiction/&quot;&gt;sake of
deriving
absurdity&lt;/a&gt;,
that there is an ordinal $\alpha \simeq_o \operatorname{OO}\,\mathcal{U}$ in the universe
$\mathcal{U}$.  By the above discussion, $\alpha \simeq_o \operatorname{OO}\,\mathcal{U} \downarrow
\alpha$, and, hence, by symmetry and transitivity, $\operatorname{OO}\,\mathcal{U} \simeq_o \operatorname{OO}\,\mathcal{U} \downarrow
\alpha$. Therefore, by univalence, $\operatorname{OO}\,\mathcal{U} = \operatorname{OO}\,\mathcal{U} \downarrow \alpha$. But this
means that $\operatorname{OO}\,\mathcal{U} \triangleleft \operatorname{OO}\,\mathcal{U}$, which is impossible as any accessible
relation is irreflexive. $\square$&lt;/p&gt;

&lt;p&gt;Some corollaries follow.&lt;/p&gt;

&lt;h4 id=&quot;the-type-of-ordinals-is-large&quot;&gt;The type of ordinals is large&lt;/h4&gt;

&lt;p&gt;We say that a type in the successor universe $\mathcal{U}^+$ is &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/UF-Size.html#is-small&quot;&gt;&lt;strong&gt;small&lt;/strong&gt;&lt;/a&gt; if it is
equivalent to some type in the universe $\mathcal{U}$, and &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/UF-Size.html#is-large&quot;&gt;&lt;strong&gt;large&lt;/strong&gt;&lt;/a&gt; otherwise.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Theorem&lt;/strong&gt;. The type of ordinals of any universe is large.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;Proof.&lt;/strong&gt; Suppose the type of ordinals in the universe $\mathcal{U}$
is small, so that there is a type $X : \mathcal{U}$ equivalent to the
type $\operatorname{Ordinal}\, \mathcal{U} : \mathcal{U}^+$. We can
then transport the ordinal structure from the type $\operatorname{Ordinal}\,
\mathcal{U}$ to $X$ along this equivalence to get an ordinal in
$\mathcal{U}$ equivalent to the ordinal of ordinals in $\mathcal{U}$,
which is impossible by the Burali-Forti theorem.&lt;/p&gt;

&lt;p&gt;But the proof is not concluded yet, because we have to say how we transport the ordinal structure.  At first sight &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/OrdinalsWellOrderTransport.html#transport-ordinal-structure&quot;&gt;we should be able to simply apply univalence&lt;/a&gt;. However, this is not possible because the types $X : \mathcal{U}$ and $\operatorname{Ordinal}\,\mathcal{U} :\mathcal{U}^+$ live in different universes. The problem is that only elements of the same type can be compared for equality.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;In the cumulative universe hierarchy of the HoTT book, we
automatically have that $X : \mathcal{U}^+$ and hence, being
equivalent to the type $\operatorname{Ordinal}\,\mathcal{U} :
\mathcal{U}^+$, the type $X$ is equal to the type
$\operatorname{Ordinal}\,\mathcal{U}$ by univalence. But this
equality is an element of an identity type of the universe
$\mathcal{U}^+$. Therefore when we transport the ordinal structure
on the type $\operatorname{Ordinal}\,\mathcal{U}$ to the type $X$
along this equality and equip $X$ with it, we get an ordinal in the
successor universe $\mathcal{U}^+$. But, in order to get the desired
contradiction, we need to get an ordinal in $\mathcal{U}$.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;In the non-cumulative universe hierarchy we adopt here, we face
essentially the same difficulty. We cannot assert that $X :
\mathcal{U}^+$ but we can promote $X$ to an equivalent type in the
universe $\mathcal{U}^+$, and from this point on we reach the same
obstacle as in the cumulative case.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;So we have to transfer the ordinal structure from $\operatorname{Ordinal}\,\mathcal{U}$ to $X$ &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/OrdinalsWellOrderTransport.html&quot;&gt;manually&lt;/a&gt; along the given equivalence, call it
$$f : X \to \operatorname{Ordinal}\,\mathcal{U}.$$
We define the order of $X$ from that of $\operatorname{Ordinal}\,\mathcal{U}$ by
$$
x \prec y = f(x) \triangleleft f(y).
$$
It is &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/OrdinalsWellOrderTransport.html#transfer-structure&quot;&gt;laborious but not hard to see&lt;/a&gt; that this order satisfies the required axioms for making $X$ into an ordinal, except that it has values in $\mathcal{U}^+$ rather than $\mathcal{U}$. But this problem is solved by instead using the resized-down relation $\triangleleft^-$ discussed above, which is equivalent to $\triangleleft$ by univalence.
$\square$&lt;/p&gt;

&lt;h4 id=&quot;there-are-more-types-and-sets-in-mathcalu-than-in-mathcalu&quot;&gt;There are more types and sets in $\mathcal{U}^+$ than in $\mathcal{U}$&lt;/h4&gt;

&lt;p&gt;By a &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/UF-UniverseEmbedding.html#is-universe-embedding&quot;&gt;&lt;strong&gt;universe embedding&lt;/strong&gt;&lt;/a&gt; we mean a map
$$f : \mathcal{U} \to \mathcal{V}$$
of universes such that, for all $X : \mathcal{U}$,
$$f(X) \simeq X.$$ Of course, any two universe embeddings of $\mathcal{U}$ into $\mathcal{V}$ are equal,
by univalence, so that there is at most one universe embedding between
any two universes.  Moreover, universe embeddings &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/UF-UniverseEmbedding.html&quot;&gt;are automatically
type embeddings&lt;/a&gt; (meaning that they have propositional fibers).&lt;/p&gt;

&lt;p&gt;So the following says that the universe $\mathcal{U}^+$ is strictly larger than the
universe $\mathcal{U}$:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Theorem.&lt;/strong&gt; The universe embedding $\mathcal{U} \to \mathcal{U}^+$ doesn't have a section and therefore is not an equivalence.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;Proof.&lt;/strong&gt; A section would give a type in the universe $\mathcal{U}$ equivalent to the type of ordinals in $\mathcal{U}$, but we have seen that there is no such type. $\square$&lt;/p&gt;

&lt;p&gt;(However, by Theorem 29 of &lt;a href=&quot;https://www.cambridge.org/core/journals/mathematical-structures-in-computer-science/article/injective-types-in-univalent-mathematics/AFCBBABE47F29ED7AFB4C262929D8810&quot;&gt;Injective types in univalent mathematics&lt;/a&gt;, if propositional resizing holds then the universe embedding $\mathcal{U} \to \mathcal{U}^+$
&lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/UF-Size.html#Lift-is-section&quot;&gt;is a section&lt;/a&gt;.)&lt;/p&gt;

&lt;p&gt;The same argument of the above theorem shows that there are more sets
in $\mathcal{U}^+$ than in $\mathcal{U}$, because the type of ordinals
is a set. For a universe $\mathcal{U}$ define the type
$$\operatorname{hSet}\,\mathcal{U} : \mathcal{U}^+$$
by
$$ \operatorname{hSet}\,\mathcal{U} = \Sigma A : \mathcal{U} , \text{$A$ is a set}.$$
By an &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/UF-UniverseEmbedding.html#is-hSet-embedding&quot;&gt;&lt;strong&gt;hSet embedding&lt;/strong&gt;&lt;/a&gt; we mean a map
$$f : \operatorname{hSet}\,\mathcal{U} → \operatorname{hSet}\,\mathcal{V}$$
such that the underlying type of $f(\mathbb{X})$ is equivalent to the underlying type of $\mathbb{X}$ for every $\mathbb{X} : \operatorname{hSet}\,\mathcal{U}$, that is,
$$
\operatorname{pr_1} (f (\mathbb{X})) ≃ \operatorname{pr_1}(\mathbb{X}).
$$
Again &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/UF-UniverseEmbedding.html#at-most-one-hSet-embedding&quot;&gt;there is at most one hSet-embedding&lt;/a&gt; between any two universes, hSet-embeddings are type embeddings, and we have:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Theorem.&lt;/strong&gt; The hSet-embedding $\operatorname{hSet}\,\mathcal{U} \to \operatorname{hSet}\,\mathcal{U}^+$ doesn't have a section and therefore is not an equivalence.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;there-are-more-magmas-and-monoids-in-mathcalu-than-in-mathcalu&quot;&gt;There are more magmas and monoids in $\mathcal{U}^+$ than in $\mathcal{U}$&lt;/h4&gt;

&lt;p&gt;This is because the type of ordinals is a monoid under
addition with the ordinal zero as its neutral element, and hence also a magma.  If the
inclusion of the type of magmas (respectively monoids) of one universe into that of the
next were an equivalence, then we would have a small copy of the type of ordinals.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/BuraliForti.html&quot;&gt;&lt;strong&gt;Theorem.&lt;/strong&gt;&lt;/a&gt; The canonical embeddings $\operatorname{Magma}\,\mathcal{U} → \operatorname{Magma}\,\mathcal{U}^+$ and $\operatorname{Monoid}\,\mathcal{U} → \operatorname{Monoid}\,\mathcal{U}^+$ don't have sections and hence are not equivalences.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;there-are-more-groups-in-mathcalu-than-in-mathcalu&quot;&gt;There are more groups in $\mathcal{U}^+$ than in $\mathcal{U}$&lt;/h4&gt;

&lt;p&gt;This case is more interesting.&lt;/p&gt;

&lt;p&gt;The axiom of choice is equivalent to the statement that &lt;a href=&quot;https://en.wikipedia.org/wiki/Group_structure_and_the_axiom_of_choice&quot;&gt;any non-empty set can
be given the structure of a
group&lt;/a&gt;. So
if we assumed the axiom of choice we would be done. But we are brave
and work without assuming excluded middle, and hence without choice.&lt;/p&gt;

&lt;p&gt;It is also  the case that &lt;a href=&quot;https://homotopytypetheory.org/2021/01/23/can-the-type-of-truth-values-be-given-the-structure-of-a-group/&quot;&gt;the type of propositions can be given the structure of a group&lt;/a&gt; if and only if the principle of excluded middle holds. And &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/OrdinalArithmetic-Properties.html#retract-%CE%A9-of-Ordinal&quot;&gt;the type of propositions is a retract of the type of ordinals&lt;/a&gt;, which makes it unlikely that the type of ordinals can be given the structure of a group without excluded middle.&lt;/p&gt;

&lt;p&gt;So our strategy is to embed the type of ordinals into a group, and the free group does the job.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;First we need to show that the inclusion of generators, or the
universal map into the free group, &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/FreeGroup.html&quot;&gt;is an
embedding&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;But having a large type $X$ embedded into a type $Y$ is not enough
to conclude that $Y$ is also large. For example, if $P$ is a
proposition then the unique map $P \to \mathbb{1}$ is an embedding,
and the unit type $\mathbb{1}$ is small but $P$ may be large.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;So more work is needed to show that the group freely generated by
the type of ordinals is large. We say that a map is &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/UF-Size.html#is-small&quot;&gt;&lt;strong&gt;small&lt;/strong&gt;&lt;/a&gt; if
each of its fibers is small, and &lt;strong&gt;large&lt;/strong&gt; otherwise.
&lt;a href=&quot;https://arxiv.org/abs/2102.08812&quot;&gt;De Jong and Escardo&lt;/a&gt; showed that
if a map $X \to Y$ is small and the type $Y$ is small, &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/UF-Size.html#is-small&quot;&gt;then so is
the type
$X$&lt;/a&gt;,
and hence if $X$ is large then so is $Y$. Therefore our approach is
to show that the universal map into the free group is small. To &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/FreeGroupOfLargeLocallySmallSet.html&quot;&gt;do
this&lt;/a&gt;,
we exploit the fact that the type of ordinals is &lt;a href=&quot;https://arxiv.org/abs/1701.07538&quot;&gt;locally
small&lt;/a&gt; (&lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/BuraliForti.html#the-type-of-ordinals-is-locally-small&quot;&gt;its identity types are
all equivalent to small
types&lt;/a&gt;).&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;But we want to be as general as possible, and hence work with a spartan univalent type theory which doesn't include higher inductive types other than propositional truncation. We include the empty type, the unit type, natural numbers, list types (&lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/agda-new/Fin.html#vec&quot;&gt;which can actually be constructed from the other type formers&lt;/a&gt;), coproduct types, $\Sigma$-types, $\Pi$-types, identity types and a sequence of universes. We also assume the univalence axiom (from which we automatically get functional and propositional extensionality) and the axiom of existence of propositional truncations.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;We &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/FreeGroup.html&quot;&gt;construct the free
group&lt;/a&gt;
as a quotient of a type of words following &lt;a href=&quot;https://www.springer.com/gb/book/9780387966403&quot;&gt;Mines, Richman and
Ruitenburg&lt;/a&gt;. To
prove that the universal map is an embedding, one first proves a
Church-Rosser property for the equivalence relation on words. It is
remarkable that this can be done without assuming that the set of
generators has decidable equality.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Quotients &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/agda-new/UF-Quotient.html&quot;&gt;can be constructed from propositional
truncation&lt;/a&gt;. This
construction increases the universe level by one, but eliminates
into any universe.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;To &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/FreeGroupOfLargeLocallySmallSet.html#resize-free-group&quot;&gt;resize back&lt;/a&gt; the quotient used to construct the group freely
generated by the type of ordinals to the original universe, we
exploit the fact that the type of ordinals is locally small.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;As above, we have to transfer &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/Groups.html#transport-Group-structure&quot;&gt;&lt;strong&gt;manually&lt;/strong&gt;&lt;/a&gt; group structures between equivalent types of different universes, because univalence can't be applied.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Putting the above together, and leaving many steps to the &lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/BuraliForti.html&quot;&gt;Agda code&lt;/a&gt;, we get the following in our spartan univalent type theory.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/FreeGroupOfLargeLocallySmallSet.html&quot;&gt;&lt;strong&gt;Theorem.&lt;/strong&gt;&lt;/a&gt; For any large, locally small set, the free group is also large and locally small.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/BuraliForti.html&quot;&gt;&lt;strong&gt;Corollary.&lt;/strong&gt;&lt;/a&gt; In any  successor universe $\mathcal{U}^+$ there is a group which is not isomorphic to any group in the universe $\mathcal{U}$.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;https://www.cs.bham.ac.uk/~mhe/TypeTopology/BuraliForti.html&quot;&gt;&lt;strong&gt;Corollary.&lt;/strong&gt;&lt;/a&gt; The canonical embedding $\operatorname{Group}\,\mathcal{U} → \operatorname{Group}\,\mathcal{U}^+$ doesn't have a section and hence is not an equivalence.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Can we formulate and prove a general theorem of this kind that
specializes to a wide variety of mathematical structures that occur in
practice?&lt;/p&gt;</content><category term="Constructive mathematics"/><category term="Type theory"/><id>http://math.andrej.com/2021/02/22/Burali-Forti-in-HoTT-UF</id><title xml:base="http://math.andrej.com/feed.xml" type="html">The Burali-Forti argument in HoTT/UF</title><updated>2021-02-21T23:00:00-00:00</updated><author><name>Martin Escardo</name></author></entry><entry><source><updated>2021-03-04T00:00:00-00:00</updated><link title="Tarides RSS Feed" type="text/html" href="https://tarides.com" rel="related"/><link title="Tarides RSS Feed" type="application/rss+xml" href="https://tarides.com/feed.xml" rel="self"/><generator>GatsbyJS</generator><id>https://tarides.com</id><title type="text">Tarides RSS Feed</title><author><name>Tarides</name></author></source><link href="https://tarides.com/blog/2021-02-15-partnering-for-more-diversity-in-tech" rel="alternate"/><content xml:base="https://tarides.com/feed.xml" type="html">&lt;p&gt;Tarides is very glad to announce our partnership with &lt;a href=&quot;https://adatechschool.fr&quot;&gt;Ada Tech
School&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Founded in 2019 and based in Paris (France), Ada Tech School, named for pioneer
computer scientist &lt;a href=&quot;https://en.wikipedia.org/wiki/Ada_Lovelace&quot;&gt;Ada Lovelace&lt;/a&gt;,
is a programming school designed for women but open to all. The program is
driven by three values: feminism, empathy and singularity. Its mission is to
facilitate access to programming positions and promote the feminization of tech,
by creating training that tackles the gender and cultural biases of IT.&lt;/p&gt;
&lt;p&gt;Unfortunately, the diversity of the candidate pool is very limited when a
company tries to fill positions. Barely 10% of computer science students in
France are girls. Ada Tech School is an excellent initiative to democratize
software education amongst women. The school was created so that women can land
a job easily in the IT industry through rigorous training, and then offer
ongoing coaching and support to ascend the professional ladder within tech
companies.&lt;/p&gt;
&lt;p&gt;At Tarides, we believe that a healthy team is a diverse one; and that trust,
fairness and inclusion are values needed to build a strong company.&lt;/p&gt;
&lt;p&gt;We are committed to doing better, not only by hiring a diverse team and
providing a welcoming work environment, but also by putting people first at
every stage. This means providing fair and equitable compensation as well as
meaningful career advancement opportunities for every employee.&lt;/p&gt;
&lt;p&gt;We believe that a great technology always derives from great people, regardless
of their background. Head &lt;a href=&quot;https://tarides.com/company&quot;&gt;here&lt;/a&gt; to see our
currently-open positions.&lt;/p&gt;</content><id>https://tarides.com/blog/2021-02-15-partnering-for-more-diversity-in-tech.html</id><title type="text">Partnering for more diversity in Tech</title><updated>2021-02-15T00:00:00-00:00</updated><author><name>Tarides</name></author></entry><entry><source><updated>2021-03-29T10:00:00-00:00</updated><logo>https://www.ocamlpro.com/wp-content/uploads/2020/07/cropped-favicon-32x32.png</logo><link title="OCamlPro" type="text/html" href="https://www.ocamlpro.com" rel="related"/><link title="OCamlPro" type="application/rss+xml" href="https://www.ocamlpro.com/feed/" rel="self"/><generator>https://wordpress.org/?v=5.4.4</generator><id>https://www.ocamlpro.com</id><title type="text">OCamlPro</title><author><name>OCamlPro</name></author></source><link href="https://www.ocamlpro.com/2021/02/09/opam-2-0-8-release/" rel="alternate"/><link href="https://www.ocamlpro.com/2021/02/09/opam-2-0-8-release/#respond" rel="related"/><content xml:base="https://www.ocamlpro.com/feed/" type="html">
&lt;p&gt;We are pleased to announce the minor release of &lt;a href=&quot;https://github.com/ocaml/opam/releases/tag/2.0.8&quot;&gt;opam 2.0.8&lt;/a&gt;.&lt;/p&gt;



&lt;p&gt;This new version contains some &lt;a href=&quot;https://github.com/ocaml/opam/pull/4425&quot;&gt;backported&lt;/a&gt; fixes:&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Critical for fish users!&lt;/strong&gt; Don&amp;#8217;t add &lt;code&gt;.&lt;/code&gt; to &lt;code&gt;PATH&lt;/code&gt;. [&lt;a href=&quot;https://github.com/ocaml/opam/issues/4078&quot;&gt;#4078&lt;/a&gt;]&lt;/li&gt;&lt;li&gt;Fix sandbox script for newer &lt;code&gt;ccache&lt;/code&gt; versions. [&lt;a href=&quot;https://github.com/ocaml/opam/issues/4079&quot;&gt;#4079&lt;/a&gt; and &lt;a href=&quot;https://github.com/ocaml/opam/pull/4087&quot;&gt;#4087&lt;/a&gt;]&lt;/li&gt;&lt;li&gt;Fix sandbox crash when &lt;code&gt;~/.cache&lt;/code&gt; is a symlink. [&lt;a href=&quot;https://github.com/ocaml/opam/issues/4068&quot;&gt;#4068&lt;/a&gt;]&lt;/li&gt;&lt;li&gt;User modifications to the sandbox script are no longer overwritten by &lt;code&gt;opam init&lt;/code&gt;. [&lt;a href=&quot;https://github.com/ocaml/opam/pull/4092&quot;&gt;#4020&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://github.com/ocaml/opam/pull/4092&quot;&gt;#4092&lt;/a&gt;]&lt;/li&gt;&lt;li&gt;macOS sandbox script always mounts &lt;code&gt;/tmp&lt;/code&gt; read-write, regardless of &lt;code&gt;TMPDIR&lt;/code&gt; [&lt;a href=&quot;https://github.com/ocaml/opam/pull/3742&quot;&gt;#3742&lt;/a&gt;, addressing &lt;a href=&quot;https://github.com/ocaml/opam-repository/issues/13339&quot;&gt;ocaml/opam-repository#13339&lt;/a&gt;]&lt;/li&gt;&lt;li&gt;&lt;code&gt;pre-&lt;/code&gt; and &lt;code&gt;post-session&lt;/code&gt; hooks can now print to the console [&lt;a href=&quot;https://github.com/ocaml/opam/issues/4359&quot;&gt;#4359&lt;/a&gt;]&lt;/li&gt;&lt;li&gt;Switch-specific pre/post sessions hooks are now actually run [&lt;a href=&quot;https://github.com/ocaml/opam/issues/4472&quot;&gt;#4472&lt;/a&gt;]&lt;/li&gt;&lt;li&gt;Standalone &lt;code&gt;opam-installer&lt;/code&gt; now correctly builds from sources [&lt;a href=&quot;https://github.com/ocaml/opam/issues/4173&quot;&gt;#4173&lt;/a&gt;]&lt;/li&gt;&lt;li&gt;Fix &lt;code&gt;arch&lt;/code&gt; variable detection when using 32bit mode on ARM64 and i486 [&lt;a href=&quot;https://github.com/ocaml/opam/pull/4462&quot;&gt;#4462&lt;/a&gt;]&lt;/li&gt;&lt;/ul&gt;



&lt;p&gt;A more complete &lt;a href=&quot;https://github.com/ocaml/opam/releases/tag/2.0.8&quot;&gt;release note&lt;/a&gt; is available.&lt;/p&gt;



&lt;blockquote class=&quot;wp-block-quote&quot;&gt;&lt;p&gt;Note: To homogenise macOS name on system detection, we decided to keep &lt;code&gt;macos&lt;/code&gt;, and convert &lt;code&gt;darwin&lt;/code&gt; to &lt;code&gt;macos&lt;/code&gt; in opam. For the moment, in order to avoid breaking jobs &amp;amp; CIs, we keep uploading &lt;code&gt;darwin&lt;/code&gt; &amp;amp; &lt;code&gt;macos&lt;/code&gt; binaries, but from the 2.1.0 release, only &lt;code&gt;macos&lt;/code&gt; ones will be kept.&lt;/p&gt;&lt;/blockquote&gt;



&lt;hr class=&quot;wp-block-separator&quot;/&gt;



&lt;p&gt;Installation instructions (unchanged):&lt;/p&gt;



&lt;ol&gt;&lt;li&gt;From binaries: run &lt;code&gt;sh &amp;lt;(curl -sL https://raw.githubusercontent.com/ocaml/opam/master/shell/install.sh)&lt;/code&gt; or download manually from &lt;a href=&quot;https://github.com/ocaml/opam/releases/tag/2.0.8&quot;&gt;the Github &amp;#8220;Releases&amp;#8221; page&lt;/a&gt; to your PATH. In this case, don&amp;#8217;t forget to run &lt;code&gt;opam init --reinit -ni&lt;/code&gt; to enable sandboxing if you had version 2.0.0~rc manually installed or to update you sandbox script.&lt;/li&gt;&lt;li&gt;From source, using opam: &lt;code&gt;opam update; opam install opam-devel&lt;/code&gt; (then copy the opam binary to your PATH as explained, and don&amp;#8217;t forget to run &lt;code&gt;opam init --reinit -ni&lt;/code&gt; to enable sandboxing if you had version 2.0.0~rc manually installed or to update you sandbox script)&lt;/li&gt;&lt;li&gt;From source, manually: see the instructions in the &lt;a href=&quot;https://github.com/ocaml/opam/tree/2.0.8#compiling-this-repo&quot;&gt;README&lt;/a&gt;.&lt;/li&gt;&lt;/ol&gt;



&lt;p&gt;We hope you enjoy this new minor version, and remain open to &lt;a href=&quot;https://github.com/ocaml/opam/issues&quot;&gt;bug reports&lt;/a&gt; and &lt;a href=&quot;https://github.com/ocaml/opam/issues&quot;&gt;suggestions&lt;/a&gt;.&lt;/p&gt;



&lt;blockquote class=&quot;wp-block-quote&quot;&gt;&lt;p&gt;NOTE: this article is cross-posted on &lt;a href=&quot;https://opam.ocaml.org/blog/&quot;&gt;opam.ocaml.org&lt;/a&gt; and &lt;a href=&quot;http://www.ocamlpro.com/category/blog/&quot;&gt;ocamlpro.com&lt;/a&gt;, and published in &lt;a href=&quot;https://discuss.ocaml.org/t/ann-opam-2-0-8-release/7242&quot;&gt;discuss.ocaml.org&lt;/a&gt;. Please head to the latter for the comments!&lt;/p&gt;&lt;/blockquote&gt;



&lt;blockquote class=&quot;wp-block-quote&quot;&gt;&lt;p&gt;&lt;strong&gt;About OCamlPro:&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;OCamlPro is a R&amp;amp;D lab founded in 2011, with the mission to help industrial users benefit from state-of-the art programming languages like OCaml and Rust. We design, create and implement custom ad-hoc software for our clients. We also have a long experience in developing and maintaining open-source tooling for OCaml, such as Opam, &lt;a href=&quot;http://try.ocamlpro.com&quot;&gt;TryOCaml&lt;/a&gt;, ocp-indent, ocp-index and ocp-browser, and we contribute to the core-development of OCaml, notably with our work on the Flambda optimizer branch. Another area of expertise is that of Formal Methods, with tools such as our SMT Solver Alt-Ergo (check our &lt;a href=&quot;https://alt-ergo.ocamlpro.com/#club&quot;&gt;Alt-Ergo Users&amp;#8217; Club&lt;/a&gt;). We also provide vocational trainings in OCaml and Rust, and we can build courses on formal methods on-demand. Do not hesitate to reach out by email: &lt;a href=&quot;mailto:contact@ocamlpro.com&quot;&gt;contact@ocamlpro.com&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
</content><category term="Blog"/><id>https://www.ocamlpro.com/?p=4665</id><title type="text">opam 2.0.8 release</title><updated>2021-02-09T16:37:30-00:00</updated><author><name>OCamlPro</name></author></entry><entry><source><updated>2021-03-03T15:00:00-00:00</updated><link title="ReScript Blog" type="text/html" href="https://rescript-lang.org" rel="related"/><link title="ReScript Blog" type="application/rss+xml" href="https://rescript-lang.org/blog/feed.xml" rel="self"/><id>https://rescript-lang.org</id><title type="text">ReScript Blog</title><author><name>Reason Documentation Blog</name></author></source><link href="%20https://rescript-lang.org/blog/release-9-0%20" rel="alternate"/><content xml:base="https://rescript-lang.org/blog/feed.xml" type="html">
        Featuring a new external stdlib configuration, some syntax improvements and a small breaking change for nested records.

        </content><id>%20https://rescript-lang.org/blog/release-9-0%20</id><title type="text"> ReScript 9.0</title><updated>2021-02-09T15:00:00-00:00</updated><author><name>Reason Documentation Blog</name></author></entry><entry><source><updated>2021-02-08T00:00:00-00:00</updated><link href="https://opam.ocaml.org/blog/feed.xml" rel="self"/><contributor><uri>mailto:David.Allsopp(%C3%A0)cl.cam.ac.uk</uri><name>{ David Allsopp }</name></contributor><contributor><uri>mailto:raja.boujbel(%C3%A0)ocamlpro.com</uri><name>{ Raja Boujbel - OCamlPro, Louis Gesbert - OCamlPro }</name></contributor><contributor><uri>mailto:louis.gesbert(%C3%A0)ocamlpro.com</uri><name>{ Louis Gesbert - OCamlPro }</name></contributor><contributor><uri>mailto:louis.gesbert(%C3%A0)ocamlpro.com</uri><name>{ Louis Gesbert }</name></contributor><contributor><uri>http://anil.recoil.org</uri><name>{ Anil Madhavapeddy, Louis Gesbert }</name></contributor><contributor><uri>mailto:louis.gesbert(%C3%A0)ocamlpro.com</uri><name>{ Louis Gesbert, Hannes Mehnert }</name></contributor><contributor><uri>https://opam.ocaml.org</uri><name>{ OCaml Platform Team }</name></contributor><contributor><uri>http://dave.recoil.org/</uri><name>{ Dave Scott }</name></contributor><contributor><uri>http://gazagnaire.org</uri><name>{ Thomas Gazagnaire }</name></contributor><contributor><uri>https://github.com/def-lkb</uri><name>{ Frederic Bour, Thomas Refis }</name></contributor><contributor><uri>http://roscidus.com/blog/</uri><name>{ Thomas Leonard }</name></contributor><contributor><uri>https://github.com/diml</uri><name>{ Jérémie Dimino }</name></contributor><contributor><uri>http://ocamlpro.com</uri><name>{ Louis Gesbert }</name></contributor><contributor><uri>http://ocamlpro.com</uri><name>{ Thomas Gazagnaire }</name></contributor><id>https://opam.ocaml.org/blog/</id><title type="text">The OCaml Platform Blog</title><author><name>OCaml Platform</name></author><author><uri>https://opam.ocaml.org/</uri><name>The OCaml Platform Team</name></author></source><link type="text/html" href="https://opam.ocaml.org/blog/opam-2-0-8/" rel="alternate"/><link href="https://opam.ocaml.org/blog/opam-2-0-8/" rel="self"/><content xml:base="http://opam.ocaml.org/blog/feed.xml" type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml">

<p>We are pleased to announce the minor release of <a href="https://github.com/ocaml/opam/releases/tag/2.0.8">opam 2.0.8</a>.</p>
<p>This new version contains some <a href="https://github.com/ocaml/opam/pull/4425">backported</a> fixes:</p>
<ul><li><strong>Critical for fish users!</strong> Don't add <code>.</code> to <code>PATH</code>. [<a href="https://github.com/ocaml/opam/issues/4078">#4078</a>]</li><li>Fix sandbox script for newer <code>ccache</code> versions. [<a href="https://github.com/ocaml/opam/issues/4079">#4079</a> and <a href="https://github.com/ocaml/opam/pull/4087">#4087</a>]</li><li>Fix sandbox crash when <code>~/.cache</code> is a symlink. [<a href="https://github.com/ocaml/opam/issues/4068">#4068</a>]</li><li>User modifications to the sandbox script are no longer overwritten by <code>opam init</code>. [<a href="https://github.com/ocaml/opam/pull/4092">#4020</a> &amp; <a href="https://github.com/ocaml/opam/pull/4092">#4092</a>]</li><li>macOS sandbox script always mounts <code>/tmp</code> read-write, regardless of <code>TMPDIR</code> [<a href="https://github.com/ocaml/opam/pull/3742">#3742</a>, addressing <a href="https://github.com/ocaml/opam-repository/issues/13339">ocaml/opam-repository#13339</a>]</li><li><code>pre-</code> and <code>post-session</code> hooks can now print to the console [<a href="https://github.com/ocaml/opam/issues/4359">#4359</a>]</li><li>Switch-specific pre/post sessions hooks are now actually run [<a href="https://github.com/ocaml/opam/issues/4472">#4472</a>]</li><li>Standalone <code>opam-installer</code> now correctly builds from sources [<a href="https://github.com/ocaml/opam/issues/4173">#4173</a>]</li><li>Fix <code>arch</code> variable detection when using 32bit mode on ARM64 and i486 [<a href="https://github.com/ocaml/opam/pull/4462">#4462</a>]</li></ul>

<p>A more complete <a href="https://github.com/ocaml/opam/releases/tag/2.0.8">release note</a> is available.</p>
<blockquote><p>Note: To homogenise macOS name on system detection, we decided to keep <code>macos</code>, and convert <code>darwin</code> to <code>macos</code> in opam. For the moment, in order to avoid breaking jobs &amp; CIs, we keep uploading <code>darwin</code> &amp; <code>macos</code> binaries, but from the 2.1.0 release, only <code>macos</code> ones will be kept.</p>
</blockquote>

<p><hr/>Installation instructions (unchanged):</p>
<ol><li><p>From binaries: run</p>
<pre><code>sh &lt;(curl -sL https://raw.githubusercontent.com/ocaml/opam/master/shell/install.sh)</code></pre>

<p>or download manually from <a href="https://github.com/ocaml/opam/releases/tag/2.0.8">the Github &quot;Releases&quot; page</a> to your PATH. In this case, don't forget to run <code>opam init --reinit -ni</code> to enable sandboxing if you had version 2.0.0~rc manually installed or to update you sandbox script.</p>
</li><li><p>From source, using opam:</p>
<pre><code>opam update; opam install opam-devel</code></pre>

<p>(then copy the opam binary to your PATH as explained, and don't forget to run <code>opam init --reinit -ni</code> to enable sandboxing if you had version 2.0.0~rc manually installed or to update you sandbox script)</p>
</li><li><p>From source, manually: see the instructions in the <a href="https://github.com/ocaml/opam/tree/2.0.8#compiling-this-repo">README</a>.</p>
</li></ol>

<p>We hope you enjoy this new minor version, and remain open to <a href="https://github.com/ocaml/opam/issues">bug reports</a> and <a href="https://github.com/ocaml/opam/issues">suggestions</a>.</p>
<blockquote><p>NOTE: this article is cross-posted on <a href="https://opam.ocaml.org/blog/">opam.ocaml.org</a> and <a href="http://www.ocamlpro.com/category/blog/">ocamlpro.com</a>, and published in <a href="https://discuss.ocaml.org/t/ann-opam-2-0-8-release/7242">discuss.ocaml.org</a>. Please head to the latter for the comments!</p>
</blockquote></div></content><id>https://opam.ocaml.org/blog/opam-2-0-8/</id><title type="text">opam 2.0.8 release</title><updated>2021-02-08T00:00:00-00:00</updated><author><uri>mailto:raja.boujbel(%C3%A0)ocamlpro.com</uri><name>Raja Boujbel - OCamlPro, Louis Gesbert - OCamlPro</name></author></entry><entry><source><updated>2021-02-08T00:00:00-00:00</updated><link href="https://opam.ocaml.org/blog/feed.xml" rel="self"/><contributor><uri>mailto:David.Allsopp(%C3%A0)cl.cam.ac.uk</uri><name>{ David Allsopp }</name></contributor><contributor><uri>mailto:raja.boujbel(%C3%A0)ocamlpro.com</uri><name>{ Raja Boujbel - OCamlPro, Louis Gesbert - OCamlPro }</name></contributor><contributor><uri>mailto:louis.gesbert(%C3%A0)ocamlpro.com</uri><name>{ Louis Gesbert - OCamlPro }</name></contributor><contributor><uri>mailto:louis.gesbert(%C3%A0)ocamlpro.com</uri><name>{ Louis Gesbert }</name></contributor><contributor><uri>http://anil.recoil.org</uri><name>{ Anil Madhavapeddy, Louis Gesbert }</name></contributor><contributor><uri>mailto:louis.gesbert(%C3%A0)ocamlpro.com</uri><name>{ Louis Gesbert, Hannes Mehnert }</name></contributor><contributor><uri>https://opam.ocaml.org</uri><name>{ OCaml Platform Team }</name></contributor><contributor><uri>http://dave.recoil.org/</uri><name>{ Dave Scott }</name></contributor><contributor><uri>http://gazagnaire.org</uri><name>{ Thomas Gazagnaire }</name></contributor><contributor><uri>https://github.com/def-lkb</uri><name>{ Frederic Bour, Thomas Refis }</name></contributor><contributor><uri>http://roscidus.com/blog/</uri><name>{ Thomas Leonard }</name></contributor><contributor><uri>https://github.com/diml</uri><name>{ Jérémie Dimino }</name></contributor><contributor><uri>http://ocamlpro.com</uri><name>{ Louis Gesbert }</name></contributor><contributor><uri>http://ocamlpro.com</uri><name>{ Thomas Gazagnaire }</name></contributor><id>https://opam.ocaml.org/blog/</id><title type="text">The OCaml Platform Blog</title><author><name>OCaml Platform</name></author><author><uri>https://opam.ocaml.org/</uri><name>The OCaml Platform Team</name></author></source><link type="text/html" href="https://opam.ocaml.org/blog/opam-2-1-0-beta4/" rel="alternate"/><link href="https://opam.ocaml.org/blog/opam-2-1-0-beta4/" rel="self"/><content xml:base="http://opam.ocaml.org/blog/feed.xml" type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml">

<p><em>Feedback on this post is welcomed on <a href="https://discuss.ocaml.org/t/ann-opam-2-1-0-beta4/7252">Discuss</a>!</em></p>
<p>On behalf of the opam team, it gives me great pleasure to announce the third beta release of opam 2.1. Don’t worry, you didn’t miss beta3 - we had an issue with a configure script that caused beta2 to report as beta3 in some instances, so we skipped to beta4 to avoid any further confusion!</p>
<p>We encourage you to try out this new beta release: there are instructions for doing so in <a href="https://github.com/ocaml/opam/wiki/How-to-test-an-opam-feature">our wiki</a>. The instructions include taking a backup of your <code>~/.opam</code> root as part of the process, which can be restored in order to wind back. <em>Please note that local switches which are written to by opam 2.1 are upgraded and will need to be rebuilt if you go back to opam 2.0</em>. This can either be done by removing <code>_opam</code> and repeating whatever you use in your build process to create the switch, or you can use <code>opam switch export switch.export</code> to backup the switch to a file before installing new packages. Note that opam 2.1 <em>shouldn’t</em> upgrade a local switch unless you upgrade the base packages (i.e. the compiler).</p>
<h2 id="What-s-new-in-opam-2-1">What’s new in opam 2.1?</h2>

<ul><li>Switch invariants</li><li>Improved options configuration (see the new <code>option</code> and expanded <code>var</code> sub-commands)</li><li>Integration of system dependencies (formerly the opam-depext plugin), increasing their reliability as it integrates the solving step</li><li>Creation of lock files for reproducible installations (formerly the opam-lock plugin)</li><li>CLI versioning, allowing cleaner deprecations for opam now and also improvements to semantics in future without breaking backwards-compatibility</li><li>Performance improvements to opam-update, conflict messages, and many other areas</li><li>New plugins: opam-compiler and opam-monorepo</li></ul>

<h3 id="Switch-invariants">Switch invariants</h3>

<p>In opam 2.0, when a switch is created the packages selected are put into the “base” of the switch. These packages are not normally considered for upgrade, in order to ease pressure on opam’s solver. This was a much bigger concern early on in opam 2.0’s development, but is less of a problem with the default mccs solver.</p>
<p>However, it’s a problem for system compilers. opam would detect that your system compiler version had changed, but be unable to upgrade the ocaml-system package unless you went through a slightly convoluted process with <code>--unlock-base</code>.</p>
<p>In opam 2.1, base packages have been replaced by switch invariants. The switch invariant is a package formula which must be satisfied on every upgrade and install. All existing switches’ base packages could just be expressed as <code>package1 &amp; package2 &amp; package3</code> etc. but opam 2.1 recognises many existing patterns and simplifies them, so in most cases the invariant will be <code>&quot;ocaml-base-compiler&quot; {= 4.11.1}</code>, etc. This means that <code>opam switch create my_switch ocaml-system</code> now creates a <em>switch invariant</em> of <code>&quot;ocaml-system&quot;</code> rather than a specific version of the <code>ocaml-system</code> package. If your system OCaml package is updated, <code>opam upgrade</code> will seamlessly switch to the new package.</p>
<p>This also allows you to have switches which automatically install new point releases of OCaml. For example:</p>
<pre><code>opam switch create ocaml-4.11 --formula='&quot;ocaml-base-compiler&quot; {&gt;= &quot;4.11.0&quot; &amp; &lt; &quot;4.12.0~&quot;}' --repos=old=git+https://github.com/ocaml/opam-repository#a11299d81591
opam install utop

</code></pre>

<p>Creates a switch with OCaml 4.11.0 (the <code>--repos=</code> was just to select a version of opam-repository from before 4.11.1 was released). Now issue:</p>
<pre><code>opam repo set-url old git+https://github.com/ocaml/opam-repository
opam upgrade</code></pre>

<p>and opam 2.1 will automatically offer to upgrade OCaml 4.11.1 along with a rebuild of the switch. There’s not yet a clean CLI for specifying the formula, but we intend to iterate further on this with future opam releases so that there is an easier way of saying “install OCaml 4.11.x”.</p>
<h3 id="opam-depext-integration">opam depext integration</h3>

<p>opam has long included the ability to install system dependencies automatically via the <a href="https://github.com/ocaml-opam/opam-depext">depext plugin</a>. This plugin has been promoted to a native feature of opam 2.1.0 onwards, giving the following benefits:</p>
<ul><li>You no longer have to remember to run <code>opam depext</code>, opam always checks depexts (there are options to disable this or automate it for CI use). Installation of an opam package in a CI system is now as easy as <code>opam install .</code>, without having to do the dance of <code>opam pin add -n/depext/install</code>. Just one command now for the common case!</li><li>The solver is only called once, which both saves time and also stabilises the behaviour of opam in cases where the solver result is not stable. It was possible to get one package solution for the <code>opam depext</code> stage and a different solution for the <code>opam install</code> stage, resulting in some depexts missing.</li><li>opam now has full knowledge of depexts, which means that packages can be automatically selected based on whether a system package is already installed. For example, if you have <em>neither</em> MariaDB nor MySQL dev libraries installed, <code>opam install mysql</code> will offer to install <code>conf-mysql</code> and <code>mysql</code>, but if you have the MariaDB dev libraries installed, opam will offer to install <code>conf-mariadb</code> and <code>mysql</code>.</li></ul>

<h3 id="opam-lock-files-and-reproducibility">opam lock files and reproducibility</h3>

<p>When opam was first released, it had the mission of gathering together scattered OCaml source code to build a <a href="https://github.com/ocaml/opam-repository">community repository</a>. As time marches on, the size of the opam repository has grown tremendously, to over 3000 unique packages with over 18000 unique versions. opam looks at all these packages and is designed to solve for the best constraints for a given package, so that your project can keep up with releases of your dependencies.</p>
<p>While this works well for libraries, we need a different strategy for projects that need to test and ship using a fixed set of dependencies. To satisfy this use-case, opam 2.0.0 shipped with support for <em>using</em> <code>project.opam.locked</code> files. These are normal opam files but with exact versions of dependencies. The lock file can be used as simply as <code>opam install . --locked</code> to have a reproducible package installation.</p>
<p>With opam 2.1.0, the creation of lock files is also now integrated into the client:</p>
<ul><li><code>opam lock</code> will create a <code>.locked</code> file for your current switch and project, that you can check into the repository.</li><li><code>opam switch create . --locked</code> can be used by users to reproduce your dependencies in a fresh switch.</li></ul>

<p>This lets a project simultaneously keep up with the latest dependencies (without lock files) while providing a stricter set for projects that need it (with lock files).</p>
<h3 id="CLI-Versioning">CLI Versioning</h3>

<p>A new <code>--cli</code> switch was added to the first beta release, but it’s only now that it’s being widely used. opam is a complex enough system that sometimes bug fixes need to change the semantics of some commands. For example:</p>
<ul><li><code>opam show --file</code> needed to change behaviour</li><li>The addition of new controls for setting global variables means that the <code>opam config</code> was becoming cluttered and some things want to move to <code>opam var</code></li><li><code>opam switch create 4.11.1</code> still works in opam 2.0, but it’s really an OPAM 1.2.2 syntax.</li></ul>

<p>Changing the CLI is exceptionally painful since it can break scripts and tools which themselves need to drive <code>opam</code>. CLI versioning is our attempt to solve this. The feature is inspired by the <code>(lang dune ...)</code> stanza in <code>dune-project</code> files which has allowed the Dune project to rename variables and alter semantics without requiring every single package using Dune to upgrade their <code>dune</code> files on each release.</p>
<p>Now you can specify which version of opam you expected the command to be run against. In day-to-day use of opam at the terminal, you wouldn’t specify it, and you’ll get the latest version of the CLI. For example: <code>opam var --global</code> is the same as <code>opam var --cli=2.1 --global</code>. However, if you issue <code>opam var --cli=2.0 --global</code>, you will told that <code>--global</code> was added in 2.1 and so is not available to you. You can see similar things with the renaming of <code>opam upgrade --unlock-base</code> to <code>opam upgrade --update-invariant</code>.</p>
<p>The intention is that <code>--cli</code> should be used in scripts, user guides (e.g. blog posts), and in software which calls opam. The only decision you have to take is the <em>oldest</em> version of opam which you need to support. If your script is using a new opam 2.1 feature (for example <code>opam switch create --formula=</code>) then you simply don’t support opam 2.0. If you need to support opam 2.0, then you can’t use <code>--formula</code> and should use <code>--packages</code> instead. opam 2.0 does not have the <code>--cli</code> option, so for opam 2.0 instead of <code>--cli=2.0</code> you should set the environment variable <code>OPAMCLI</code> to <code>2.0</code>. As with <em>all</em> opam command line switches, <code>OPAMCLI</code> is simply the equivalent of <code>--cli</code> which opam 2.1 will pick-up but opam 2.0 will quietly ignore (and, as with other options, the command line takes precedence over the environment).</p>
<p>Note that opam 2.1 sets <code>OPAMCLI=2.0</code> when building packages, so on the rare instances where you need to use the <code>opam</code> command in a <em>package</em> <code>build:</code> command (or in your build system), you <em>must</em> specify <code>--cli=2.1</code> if you’re using new features.</p>
<p>There’s even more detail on this feature <a href="https://github.com/ocaml/opam/wiki/Spec-for-opam-CLI-versioning">in our wiki</a>. We’re still finalising some details on exactly how <code>opam</code> behaves when <code>--cli</code> is not given, but we’re hoping that this feature will make it much easier in future releases for opam to make required changes and improvements to the CLI without breaking existing set-ups and tools.</p>
<h2 id="What-s-new-since-the-last-beta">What’s new since the last beta?</h2>

<ul><li>opam now uses CLI versioning (<a href="https://github.com/ocaml/opam/pull/4385">#4385</a>)</li><li>opam now exits with code 31 if all failures were during fetch operations (<a href="https://github.com/ocaml/opam/issues/4214">#4214</a>)</li><li><code>opam install</code> now has a <code>--download-only</code> flag (<a href="https://github.com/ocaml/opam/issues/4036">#4036</a>), allowing opam’s caches to be primed</li><li><code>opam init</code> now advises the correct shell-specific command for <code>eval $(opam env)</code> (<a href="https://github.com/ocaml/opam/pull/4427">#4427</a>)</li><li><code>post-install</code> hooks are now allowed to modify or remove installed files (<a href="https://github.com/ocaml/opam/pull/4388">#4388</a>)</li><li>New package variable <code>opamfile-loc</code> with the location of the installed package opam file (<a href="https://github.com/ocaml/opam/pull/4402">#4402</a>)</li><li><code>opam update</code> now has <code>--depexts</code> flag (<a href="https://github.com/ocaml/opam/issues/4355">#4355</a>), allowing the system package manager to update too</li><li>depext support NetBSD and DragonFlyBSD added (<a href="https://github.com/ocaml/opam/pull/4396">#4396</a>)</li><li>The format-preserving opam file printer has been overhauled (<a href="https://github.com/ocaml/opam/issues/3993">#3993</a>, <a href="https://github.com/ocaml/opam/pull/4298">#4298</a> and <a href="https://github.com/ocaml/opam/pull/4302">#4302</a>)</li><li>pins are now fetched in parallel (<a href="https://github.com/ocaml/opam/issues/4315">#4315</a>)</li><li><code>os-family=ubuntu</code> is now treated as <code>os-family=debian</code> (<a href="https://github.com/ocaml/opam/pull/4441">#4441</a>)</li><li><code>opam lint</code> now checks that strings in filtered package formulae are booleans or variables (<a href="https://github.com/ocaml/opam/issues/4439">#4439</a>)</li></ul>

<p>and many other bug fixes as listed <a href="https://github.com/ocaml/opam/releases/tag/2.1.0-beta4">on the release page</a>.</p>
<h2 id="New-Plugins">New Plugins</h2>

<p>Several features that were formerly plugins have been integrated into opam 2.1.0. We have also developed some <em>new</em> plugins that satisfy emerging workflows from the community and the core OCaml team. They are available for use with the opam 2.1 beta as well, and feedback on them should be directed to the respective GitHub trackers for those plugins.</p>
<h3 id="opam-compiler">opam compiler</h3>

<p>The <a href="https://github.com/ocaml-opam/opam-compiler"><code>opam compiler</code></a> plugin can be used to create switches from various sources such as the main opam repository, the ocaml-multicore fork, or a local development directory. It can use Git tag names, branch names, or PR numbers to specify what to install.</p>
<p>Once installed, these are normal opam switches, and one can install packages in them. To iterate on a compiler feature and try opam packages at the same time, it supports two ways to reinstall the compiler: either a safe and slow technique that will reinstall all packages, or a quick way that will just overwrite the compiler in place.</p>
<h3 id="opam-monorepo">opam monorepo</h3>

<p>The <a href="https://github.com/ocamllabs/opam-monorepo"><code>opam monorepo</code></a> plugin lets you assemble standalone dune workspaces with your projects and all of their opam dependencies, letting you build it all from scratch using only Dune and OCaml. This satisfies the “monorepo” workflow which is commonly requested by large projects that need all of their dependencies in one place. It is also being used by projects that need global cross-compilation for all aspects of a codebase (including C stubs in packages), such as the MirageOS unikernel framework.</p>
<h2 id="Next-Steps">Next Steps</h2>

<p>This is anticipated to be the final beta in the 2.1 series, and we will be moving to release candidate status after this. We could really use your help with testing this release in your infrastructure and projects and let us know if you run into any blockers. If you have feature requests, please also report them on <a href="https://github.com/ocaml/opam/issues">our issue tracker</a> -- we will be planning the next release cycle once we ship opam 2.1.0 shortly.</p>
</div></content><id>https://opam.ocaml.org/blog/opam-2-1-0-beta4/</id><title type="text">opam 2.1.0~beta4 released</title><updated>2021-02-08T00:00:00-00:00</updated><author><uri>mailto:David.Allsopp(%C3%A0)cl.cam.ac.uk</uri><name>David Allsopp</name></author></entry><entry><summary xml:base="http://math.andrej.com/feed.xml" type="html">It is my pleasure to have the opportunity to speak at the University of Wisconsin Logic seminar. The hosts are graciously keeping the seminar open for everyone. I will speak about a favorite topic of mine: Synthetic mathematics with an excursion into computability theory Speaker: Andrej Bauer (University of Ljubljana) Location: University of Wisconsin Logic seminar Time: February 8th 2021, 21:30 UTC (3:30pm CST in Wisconsin, 22:30 CET in Ljubljana) Video link: the Zoom link is available at the seminar page Abstract: According to Felix Klein, “synthetic geometry is that which studies figures as such, without recourse to formulae, whereas analytic geometry consistently makes use of such formulae as can be written down after the adoption of an appropriate system of coordinates”. To put it less eloquently, the synthetic method axiomatizes geometry directly by construing points and lines as primitive notions, whereas the analytic method builds a model, the Euclidean plane, from the real numbers. Do other branches of mathematics posses the synthetic method, too? For instance, what would “synthetic topology” look like? To build spaces out of sets, as topologists usually do, is the analytic way. The synthetic approach must construe spaces as primitive and axiomatize them directly, without any recourse to sets. It cannot introduce continuity as a desirable property of functions, for that would be like identifying straight lines as the non-bending curves. It is indeed possible to build the synthetic worlds of topology, smooth analysis, measure theory, and computability. In each of them, the basic structure – topological, smooth, measurable, computable – is implicit by virtue of permeating everything, even logic itself. The synthetic worlds demand an economy of thought that the unaccustomed mind finds frustrating at first, but eventually rewards it with new elegance and conceptual clarity. The synthetic method is still fruitfully related to the analytic method by interpretation of the former in models provided by the latter. We demonstrate the approach by taking a closer look at synthetic computability, whose central axiom states that there are countably many countable subsets of the natural numbers. The axiom is validated and explained by its interpretation in the effective topos, where it corresponds to the familiar fact that the computably enumerable sets may be computably enumerated. Classic theorems of computability may be proved in a straightforward manner, without reference to any notion of computation. We end by showing that in synthetic computability Turing reducibility is expressed in terms of sequential continuity of maps between directed-complete partial orders. The slides and the video recording of the talk are now available.</summary><source><updated>2021-02-24T17:51:19-00:00</updated><subtitle type="text">A blog about mathematics for computers</subtitle><link type="text/html" href="http://math.andrej.com/" rel="alternate"/><link type="application/atom+xml" href="http://math.andrej.com/feed.xml" rel="self"/><generator uri="https://jekyllrb.com/" version="4.2.0">Jekyll</generator><id>http://math.andrej.com/feed.xml</id><title xml:base="http://math.andrej.com/feed.xml" type="html">Mathematics and Computation</title><author><name>Andrej Bauer</name></author></source><published>2021-02-02T23:00:00-00:00</published><link title="Synthetic mathematics with an excursion into computability theory" type="text/html" href="http://math.andrej.com/2021/02/03/synthetic-mathematics-with-excursion-to-computability/" rel="alternate"/><content xml:base="http://math.andrej.com/feed.xml" type="html">&lt;p&gt;It is my pleasure to have the opportunity to speak at the &lt;a href=&quot;https://www.math.wisc.edu/logic/seminar.html&quot;&gt;University of Wisconsin Logic
seminar&lt;/a&gt;. The hosts are graciously keeping the seminar open for everyone.
I will speak about a favorite topic of mine:&lt;/p&gt;

&lt;h5 id=&quot;synthetic-mathematics-with-an-excursion-into-computability-theory&quot;&gt;Synthetic mathematics with an excursion into computability theory&lt;/h5&gt;

&lt;p&gt;&lt;strong&gt;Speaker:&lt;/strong&gt; Andrej Bauer (University of Ljubljana)&lt;br /&gt;
&lt;strong&gt;Location:&lt;/strong&gt; &lt;a href=&quot;https://www.math.wisc.edu/logic/seminar.html&quot;&gt;University of Wisconsin Logic seminar&lt;/a&gt;&lt;br /&gt;
&lt;strong&gt;Time:&lt;/strong&gt; February 8th 2021, 21:30 UTC (3:30pm CST in Wisconsin, 22:30 CET in Ljubljana)&lt;br /&gt;
&lt;strong&gt;Video link:&lt;/strong&gt; the Zoom link is available at the &lt;a href=&quot;https://www.math.wisc.edu/logic/seminar.html&quot;&gt;seminar page&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Abstract:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;According to Felix Klein, “synthetic geometry is that which studies figures as such, without recourse to
formulae, whereas analytic geometry consistently makes use of such formulae as can be written down after the adoption of
an appropriate system of coordinates”. To put it less eloquently, the synthetic method axiomatizes geometry directly by
construing points and lines as primitive notions, whereas the analytic method builds a model, the Euclidean plane, from
the real numbers.&lt;/p&gt;

&lt;p&gt;Do other branches of mathematics posses the synthetic method, too? For instance, what would “synthetic topology” look
like? To build spaces out of sets, as topologists usually do, is the analytic way. The synthetic approach must construe
spaces as primitive and axiomatize them directly, without any recourse to sets. It cannot introduce continuity as a
desirable property of functions, for that would be like identifying straight lines as the non-bending curves.&lt;/p&gt;

&lt;p&gt;It is indeed possible to build the synthetic worlds of topology, smooth analysis, measure theory, and computability. In
each of them, the basic structure – topological, smooth, measurable, computable – is implicit by virtue of permeating
everything, even logic itself. The synthetic worlds demand an economy of thought that the unaccustomed mind finds
frustrating at first, but eventually rewards it with new elegance and conceptual clarity. The synthetic method is still
fruitfully related to the analytic method by interpretation of the former in models provided by the latter.&lt;/p&gt;

&lt;p&gt;We demonstrate the approach by taking a closer look at synthetic computability, whose central axiom states that there
are countably many countable subsets of the natural numbers. The axiom is validated and explained by its interpretation
in the effective topos, where it corresponds to the familiar fact that the computably enumerable sets may be computably
enumerated. Classic theorems of computability may be proved in a straightforward manner, without reference to any
notion of computation. We end by showing that in synthetic computability Turing reducibility is expressed in terms of
sequential continuity of maps between directed-complete partial orders.&lt;/p&gt;

&lt;p&gt;The &lt;a href=&quot;/asset/data/madison-synthetic-computability-talk.pdf&quot;&gt;&lt;strong&gt;slides&lt;/strong&gt;&lt;/a&gt; and the &lt;a href=&quot;https://vimeo.com/510188470&quot;&gt;&lt;strong&gt;video&lt;/strong&gt;&lt;/a&gt;
recording of the talk are now available.&lt;/p&gt;</content><category term="Synthetic computability"/><category term="Talks"/><id>http://math.andrej.com/2021/02/03/synthetic-mathematics-with-excursion-to-computability</id><title xml:base="http://math.andrej.com/feed.xml" type="html">Synthetic mathematics with an excursion into computability theory</title><updated>2021-02-02T23:00:00-00:00</updated><author><name>Andrej Bauer</name></author></entry><entry><source><updated>2021-03-29T10:00:00-00:00</updated><logo>https://www.ocamlpro.com/wp-content/uploads/2020/07/cropped-favicon-32x32.png</logo><link title="OCamlPro" type="text/html" href="https://www.ocamlpro.com" rel="related"/><link title="OCamlPro" type="application/rss+xml" href="https://www.ocamlpro.com/feed/" rel="self"/><generator>https://wordpress.org/?v=5.4.4</generator><id>https://www.ocamlpro.com</id><title type="text">OCamlPro</title><author><name>OCamlPro</name></author></source><link href="https://www.ocamlpro.com/2021/02/02/2020-at-ocamlpro/" rel="alternate"/><link href="https://www.ocamlpro.com/2021/02/02/2020-at-ocamlpro/#respond" rel="related"/><content xml:base="https://www.ocamlpro.com/feed/" type="html">
&lt;p&gt;OCamlPro was created in 2011 to advocate the adoption of the &lt;a href=&quot;https://ocaml.org&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;OCaml language&lt;/a&gt; and formal methods in general in the industry. While building a team of highly-skilled engineers, we navigated through our expertise domains, delivering works on the OCaml language and tooling, training companies to the use of strongly-typed languages like OCaml but also Rust, tackling formal verification challenges with formal methods, maintaining &lt;a href=&quot;https://alt-ergo.ocamlpro.com&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;the SMT solver Alt-Ergo&lt;/a&gt;, designing languages and tools for smart contracts and blockchains, and more!&lt;/p&gt;



&lt;p&gt;In this article, as every year, we review some of the work we did during 2020, in many different worlds.&lt;/p&gt;


&lt;p&gt;&lt;strong&gt;Table of contents&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#ocaml&quot;&gt;In the World of OCaml&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#flambda&quot;&gt;Flambda &amp;amp; Compilation Team&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#opam&quot;&gt;Opam, the OCaml Package Manager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#community&quot;&gt;Encouraging OCaml Adoption: Trainings and Resources for OCaml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#tooling&quot;&gt;Open Source Tooling and Libraries for OCaml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#foundation&quot;&gt;Supporting the OCaml Software Foundation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#events&quot;&gt;Events&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#formal-methods&quot;&gt;In the World of Formal Methods&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#alt-ergo&quot;&gt;Alt-Ergo Development&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#club&quot;&gt;Alt-Ergo Users&amp;#8217; Club and R&amp;amp;D Projects&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#roadmap&quot;&gt;Alt-Ergo&amp;#8217;s Roadmap&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#rust&quot;&gt;In the World of Rust&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#blockchains&quot;&gt;In the World of Blockchain Languages&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;We warmly thank all our partners, clients and friends for their support and collaboration during this peculiar year!&lt;/p&gt;



&lt;p&gt;The first lockdown was a surprise and we took advantage of this special moment to go over our past contributions and sum it up in a timeline that gives an overview of the key events that made OCamlPro over the years. The &lt;a href=&quot;https://timeline.ocamlpro.com&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;timeline format&lt;/a&gt; is amazing to reconnect with our history and to take stock in our accomplishments.&lt;/p&gt;



&lt;p&gt;Now this will turn into a generic timeline edition tool on the Web, stay tuned if you are interested in our internal project to be available to the general public! If you think that a timeline would fit your needs and audience, &lt;a href=&quot;https://timelines.cc/&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;we designed a simplistic tool&lt;/a&gt;, tailored for users who want complete control over their data.&lt;/p&gt;



&lt;h2 id=&quot;ocaml&quot;&gt;&lt;a href=&quot;#ocaml&quot;&gt;&lt;img src=&quot;https://s.w.org/images/core/emoji/12.0.0-1/72x72/2693.png&quot; alt=&quot;⚓&quot; class=&quot;wp-smiley&quot; style=&quot;height: 1em; max-height: 1em;&quot; /&gt;&lt;/a&gt; In the World of OCaml&lt;/h2&gt;



&lt;h3 id=&quot;flambda&quot;&gt;Flambda &amp;amp; Compilation Team &lt;a href=&quot;#flambda&quot;&gt;&lt;img src=&quot;https://s.w.org/images/core/emoji/12.0.0-1/72x72/2693.png&quot; alt=&quot;⚓&quot; class=&quot;wp-smiley&quot; style=&quot;height: 1em; max-height: 1em;&quot; /&gt;&lt;/a&gt;&lt;/h3&gt;



&lt;p&gt;*&lt;em&gt; Work by Pierre Chambart, Vincent Laviron, Guillaume Bury, Pierrick Couderc and Louis Gesbert&lt;/em&gt;&lt;/p&gt;



&lt;figure class=&quot;wp-block-image size-large is-resized&quot;&gt;&lt;img src=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/02/Cpu-processor.jpg&quot; alt=&quot;&quot; class=&quot;wp-image-4609&quot; width=&quot;488&quot; height=&quot;209&quot; srcset=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/02/Cpu-processor.jpg 650w, https://www.ocamlpro.com/wp-content/uploads/2021/02/Cpu-processor-300x129.jpg 300w&quot; sizes=&quot;(max-width: 488px) 100vw, 488px&quot; /&gt;&lt;/figure&gt;



&lt;p&gt;OCamlPro is proud to be working on Flambda2, an ambitious work on an OCaml optimizing compiler, in close collaboration with Mark Shinwell from our long-term partner and client Jane Street. Flambda focuses on reducing the runtime cost of abstractions and removing as many short-lived allocations as possible. In 2020, the Flambda team worked on a considerable number of fixes and improvements, transforming Flambda2 from an experimental prototype to a version ready for testing in production!&lt;/p&gt;



&lt;p&gt;This year also marked the conclusion of our work on the pack rehabilitation (see our two recent posts &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://www.ocamlpro.com/2020/09/24/rehabilitating-packs-using-functors-and-recursivity-part-1/&quot; target=&quot;_blank&quot;&gt;Part1&lt;/a&gt; and &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://www.ocamlpro.com/2020/09/30/rehabilitating-packs-using-functors-and-recursivity-part-2/&quot; target=&quot;_blank&quot;&gt;Part2&lt;/a&gt;, and a much simpler &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://www.ocamlpro.com/2011/08/10/packing-and-functors/&quot; target=&quot;_blank&quot;&gt;Version&lt;/a&gt; in 2011). Our work aimed to give them a new youth and utility by adding the possibility to generate functors or recursive packs. This improvement allows programmers to define big functors, functors that are split among multiple files, resulting in what we can view as a way to implement some form of parameterized libraries.&lt;/p&gt;



&lt;p&gt;&lt;em&gt;This work is allowed thanks to Jane Street’s funding.&lt;/em&gt;&lt;/p&gt;



&lt;h3 id=&quot;opam&quot;&gt;Opam, the Ocaml Package Manager &lt;a href=&quot;#opam&quot;&gt;&lt;img src=&quot;https://s.w.org/images/core/emoji/12.0.0-1/72x72/2693.png&quot; alt=&quot;⚓&quot; class=&quot;wp-smiley&quot; style=&quot;height: 1em; max-height: 1em;&quot; /&gt;&lt;/a&gt;&lt;/h3&gt;



&lt;p&gt;&lt;em&gt;* Work by Raja Boujbel, Louis Gesbert and Thomas Blanc&lt;/em&gt;&lt;/p&gt;



&lt;figure class=&quot;wp-block-image size-large is-resized&quot;&gt;&lt;img src=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/02/containers.jpg&quot; alt=&quot;&quot; class=&quot;wp-image-4610&quot; width=&quot;512&quot; height=&quot;342&quot; srcset=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/02/containers.jpg 1024w, https://www.ocamlpro.com/wp-content/uploads/2021/02/containers-300x200.jpg 300w&quot; sizes=&quot;(max-width: 512px) 100vw, 512px&quot; /&gt;&lt;/figure&gt;



&lt;p&gt;&lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://opam.ocaml.org/&quot; target=&quot;_blank&quot;&gt;Opam&lt;/a&gt; is OCamlPro’s source-based package manager. The first specification draft was written &lt;a href=&quot;https://opam.ocaml.org/about.html&quot;&gt;in early 2012&lt;/a&gt; and went on to become OCaml&amp;#8217;s official package manager — though it may be used for other languages and projects, since Opam is language-agnostic! If you need to install, upgrade and manage your compiler(s), tools and libraries easily, Opam is meant for you. It supports multiple simultaneous compiler installations, flexible package constraints, and a Git-friendly development workflow.&amp;nbsp;&lt;/p&gt;



&lt;p&gt;&lt;a href=&quot;https://github.com/ocaml/opam/releases&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;Our 2020 work on Opam&lt;/a&gt; led to the release of two versions of opam 2.0 with small fixes, and the release of three alphas and two betas of Opam 2.1!&amp;nbsp;&lt;/p&gt;



&lt;p&gt;Opam 2.1.0 will soon go to release candidate and will introduce a seamless integration of depexts (system dependencies handling), dependency locking, pinning sub-directories, invariant-based definition for Opam switches, the configuration of Opam from the command-line without the need for a manual edition of the configuration files, and the CLI versioning for better handling of CLI evolutions.&lt;/p&gt;



&lt;p&gt;&lt;em&gt;This work is greatly helped by Jane Street’s funding and support.&lt;/em&gt;&lt;/p&gt;



&lt;h3 id=&quot;community&quot;&gt;Encouraging Ocaml Adoption: Trainings and Resources for Ocaml &lt;a href=&quot;#community&quot;&gt;&lt;img src=&quot;https://s.w.org/images/core/emoji/12.0.0-1/72x72/2693.png&quot; alt=&quot;⚓&quot; class=&quot;wp-smiley&quot; style=&quot;height: 1em; max-height: 1em;&quot; /&gt;&lt;/a&gt;&lt;/h3&gt;



&lt;p&gt;&lt;em&gt;* Work by Pierre Chambart, Vincent Laviron, Adrien Champion, Mattias, Louis Gesbert and Thomas Blanc&lt;/em&gt;&lt;/p&gt;



&lt;figure class=&quot;wp-block-image size-large is-resized&quot;&gt;&lt;img src=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/02/ocaml-adoption-1024x683.jpg&quot; alt=&quot;&quot; class=&quot;wp-image-4630&quot; width=&quot;512&quot; height=&quot;342&quot; srcset=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/02/ocaml-adoption-1024x683.jpg 1024w, https://www.ocamlpro.com/wp-content/uploads/2021/02/ocaml-adoption-300x200.jpg 300w, https://www.ocamlpro.com/wp-content/uploads/2021/02/ocaml-adoption.jpg 1200w&quot; sizes=&quot;(max-width: 512px) 100vw, 512px&quot; /&gt;&lt;/figure&gt;



&lt;p&gt;OCamlPro is also a training centre. We organise yearly training sessions for programmers from multiple companies in our offices: from OCaml to OCaml tooling to Rust! We can also design custom and on-site trainings to meet specific needs.&lt;/p&gt;



&lt;p&gt;We released a brand new version of TryOCaml, a tool born from our work on &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://ocaml-sf.org/learn-ocaml/&quot; target=&quot;_blank&quot;&gt;Learn-OCaml&lt;/a&gt;! &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://try.ocamlpro.com&quot; target=&quot;_blank&quot;&gt;Try OCaml&lt;/a&gt; has been highly praised by professors at the beginning of the Covid lockdown. Even if it can be used as a personal sandbox, it’s also possible to adapt its usage for classes. TryOCaml is a hassle-free tool that lowers significantly the barriers to start coding in OCaml, as no installation is required.&lt;/p&gt;



&lt;p&gt;We regularly release cheat sheets for developers: in 2020, we shared &lt;a href=&quot;https://www.ocamlpro.com/2020/01/10/opam-2-0-cheatsheet/&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;the long-awaited Opam 2.0 cheat sheet&lt;/a&gt;, with a new theme! In just two pages, you’ll have in one place the everyday commands you need as an Opam user. We also shine some light on unsung features which may just change your coding life.&amp;nbsp;&lt;/p&gt;



&lt;p&gt;2020 was also an important year for the OCaml language itself: we were pleased to welcome &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://ocaml.org/releases/4.10.0.html&quot; target=&quot;_blank&quot;&gt;OCaml 4.10&lt;/a&gt;! One of the highlights of the release was the “Best-fit” Garbage Collector Strategy. We had &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://www.ocamlpro.com/2020/03/23/ocaml-new-best-fit-garbage-collector/&quot; target=&quot;_blank&quot;&gt;an in-depth look&lt;/a&gt; at this exciting change.&lt;/p&gt;



&lt;p&gt;&lt;em&gt;This work is self-funded by OCamlPro as part of its effort to ease the adoption of OCaml.&lt;/em&gt;&lt;/p&gt;



&lt;h3 id=&quot;tooling&quot;&gt;Open Source Tooling and Libraries for OCaml &lt;a href=&quot;#tooling&quot;&gt;&lt;img src=&quot;https://s.w.org/images/core/emoji/12.0.0-1/72x72/2693.png&quot; alt=&quot;⚓&quot; class=&quot;wp-smiley&quot; style=&quot;height: 1em; max-height: 1em;&quot; /&gt;&lt;/a&gt; &lt;/h3&gt;



&lt;p&gt;&lt;em&gt;* Work by Fabrice Le Fessant, Léo Andrès and David Declerck&lt;/em&gt;&lt;/p&gt;



&lt;figure class=&quot;wp-block-image size-large is-resized&quot;&gt;&lt;img src=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/01/tools-1024x712.jpg&quot; alt=&quot;&quot; class=&quot;wp-image-4569&quot; width=&quot;512&quot; height=&quot;356&quot; srcset=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/01/tools-1024x712.jpg 1024w, https://www.ocamlpro.com/wp-content/uploads/2021/01/tools-300x209.jpg 300w, https://www.ocamlpro.com/wp-content/uploads/2021/01/tools.jpg 1750w&quot; sizes=&quot;(max-width: 512px) 100vw, 512px&quot; /&gt;&lt;/figure&gt;



&lt;p&gt;OCamlPro has a long history of developing open source tooling and libraries for the community. 2020 was no exception!&lt;/p&gt;



&lt;p&gt;&lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://github.com/ocamlpro/drom&quot; target=&quot;_blank&quot;&gt;drom&lt;/a&gt; is a simple tool to create new OCaml projects that will use best OCaml practices, i.e. Opam, Dune and tests. Its goal is to provide a cargo-like user experience and helps onboarding new developers in the community. drom is available in the official opam repository.&lt;/p&gt;



&lt;p&gt;&lt;a href=&quot;https://github.com/OCamlPro/directories&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;directories&lt;/a&gt; is a new OCaml Library that provides configuration, cache and data paths (and more!). The library follows the suitable conventions on Linux, MacOS and Windows.&lt;/p&gt;



&lt;p&gt;&lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://ocamlpro.github.io/opam-bin/&quot; target=&quot;_blank&quot;&gt;opam-bin&lt;/a&gt; is a framework to create and use binary packages with Opam. It enables you to create, use and share binary packages easily with opam, and to create as many local switches as you want spending no time, no disk space! If you often use Opam, opam-bin is a must-have!&lt;/p&gt;



&lt;p&gt;We also released a number of libraries, focused on making things easy for developers&amp;#8230; so we named them with an &lt;code&gt;ez_&lt;/code&gt; prefix: &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://github.com/OCamlPro/ez_cmdliner&quot; target=&quot;_blank&quot;&gt;ez_cmdliner&lt;/a&gt; provides an Arg-like interface for cmdliner,  &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://github.com/OCamlPro/ez_file&quot; target=&quot;_blank&quot;&gt;ez_file&lt;/a&gt; provides simple functions to read and write files, &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://github.com/OCamlPro/ez_subst&quot; target=&quot;_blank&quot;&gt;ez_subst&lt;/a&gt; provides easily configurable string substitutions for shell-like variable syntax, &lt;a href=&quot;https://github.com/OCamlPro/ez_config&quot;&gt;ez_config&lt;/a&gt; provides abstract options stored in configuration files with an OCaml syntax. There are also a lot of &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://github.com/OCamlPro?q=ezjs_&amp;amp;type=&amp;amp;language=&quot; target=&quot;_blank&quot;&gt;ezjs-*&lt;/a&gt; libraries, that are bindings to Javascript libraries that we used in some of our js_of_ocaml projects.&lt;/p&gt;



&lt;p&gt;&lt;em&gt;This work was self-funded by OCamlPro as part of its effort to improve the OCaml ecosystem.&lt;/em&gt;&lt;/p&gt;



&lt;h3 id=&quot;foundation&quot;&gt;Supporting the OCaml Software Foundation &lt;a href=&quot;#foundation&quot;&gt;&lt;img src=&quot;https://s.w.org/images/core/emoji/12.0.0-1/72x72/2693.png&quot; alt=&quot;⚓&quot; class=&quot;wp-smiley&quot; style=&quot;height: 1em; max-height: 1em;&quot; /&gt;&lt;/a&gt;&lt;/h3&gt;



&lt;p&gt;OCamlPro was proud and happy to initiate the &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://www.dropbox.com/s/omba1d8vhljnrcn/OCaml-user-survey-2020.pdf?dl=0&quot; target=&quot;_blank&quot;&gt;OCaml User Survey 2020&lt;/a&gt; as part of the mission of the &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://ocaml-sf.org/&quot; target=&quot;_blank&quot;&gt;OCaml Software Foundation&lt;/a&gt;. The goal of the survey was to better understand the community and its needs. The final results have not yet been published by the Foundation, we are looking forward to reading them soon!&lt;/p&gt;



&lt;h3 id=&quot;events&quot;&gt;Events &lt;a href=&quot;#events&quot;&gt;&lt;img src=&quot;https://s.w.org/images/core/emoji/12.0.0-1/72x72/2693.png&quot; alt=&quot;⚓&quot; class=&quot;wp-smiley&quot; style=&quot;height: 1em; max-height: 1em;&quot; /&gt;&lt;/a&gt;&lt;/h3&gt;



&lt;p&gt;Though the year took its toll on our usual tour of the world conferences and events, OCamlPro members still took part in the annual 72-hour team programming competition organised by the International Conference on Functional Programming (ICFP). Our joint team &amp;#8220;crapo on acid&amp;#8221; went &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://icfpcontest2020.github.io/#/scoreboard#final&quot; target=&quot;_blank&quot;&gt;through the final&lt;/a&gt;!&lt;/p&gt;



&lt;h2 id=&quot;formal-methods&quot;&gt;&lt;a href=&quot;#formal-methods&quot;&gt;&lt;img src=&quot;https://s.w.org/images/core/emoji/12.0.0-1/72x72/2693.png&quot; alt=&quot;⚓&quot; class=&quot;wp-smiley&quot; style=&quot;height: 1em; max-height: 1em;&quot; /&gt;&lt;/a&gt; In the World of Formal Methods&lt;/h2&gt;



&lt;p&gt;* &lt;em&gt;Work by Albin Coquereau, Mattias, Sylvain Conchon, Guillaume Bury and Louis Rustenholz&lt;/em&gt;&lt;/p&gt;



&lt;figure class=&quot;wp-block-image is-resized&quot;&gt;&lt;img src=&quot;https://www.ocamlpro.com/wp-content/uploads/2020/09/altergo-meeting.jpeg&quot; alt=&quot;&quot; width=&quot;700&quot; height=&quot;525&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;&lt;a href=&quot;https://www.ocamlpro.com/2020/06/05/interview-sylvain-conchon-joins-ocamlpro/&quot;&gt;Sylvain Conchon joined us&lt;/a&gt; as Formal Methods Chief Scientific Officer in 2020! &lt;/p&gt;



&lt;h3 id=&quot;alt-ergo&quot;&gt;Alt-Ergo Development &lt;a href=&quot;#alt-ergo&quot;&gt;&lt;img src=&quot;https://s.w.org/images/core/emoji/12.0.0-1/72x72/2693.png&quot; alt=&quot;⚓&quot; class=&quot;wp-smiley&quot; style=&quot;height: 1em; max-height: 1em;&quot; /&gt;&lt;/a&gt;&lt;/h3&gt;



&lt;p&gt;OCamlPro develops and maintains &lt;a href=&quot;https://alt-ergo.ocamlpro.com/&quot;&gt;Alt-Ergo&lt;/a&gt;, an automatic solver of mathematical formulas designed for program verification and based on Satisfiability Modulo Theories (SMT). Alt-Ergo was initially created within the&amp;nbsp;&lt;a rel=&quot;noreferrer noopener&quot; target=&quot;_blank&quot; href=&quot;https://vals.lri.fr/&quot;&gt;VALS&lt;/a&gt;&amp;nbsp;team at &lt;a rel=&quot;noreferrer noopener&quot; target=&quot;_blank&quot; href=&quot;https://www.universite-paris-saclay.fr/en&quot;&gt;University of Paris-Saclay&lt;/a&gt;.&lt;/p&gt;



&lt;p&gt;In 2020, we focused on the maintainability of our solver. The first part of this work was to maintain and fix issues within the already released version. The 2.3.0 (released in 2019) had some issues that needed to be fixed (&lt;a rel=&quot;noreferrer noopener&quot; target=&quot;_blank&quot; href=&quot;https://ocamlpro.github.io/alt-ergo/About/changes.html#version-2-3-2-march-23-2020&quot;&gt;minor releases&lt;/a&gt;).&lt;/p&gt;



&lt;p&gt;The second part of the maintainability of Alt-Ergo contains more major features. All these features were released in the new&amp;nbsp;&lt;a rel=&quot;noreferrer noopener&quot; target=&quot;_blank&quot; href=&quot;https://alt-ergo.ocamlpro.com/#releases&quot;&gt;version 2.4.0&lt;/a&gt;&amp;nbsp;of Alt-Ergo. The main goal of this release was to focus on the user experience and the documentation. This release also contains bug fixes and many other improvements. Alt-Ergo has a new&amp;nbsp;&lt;a rel=&quot;noreferrer noopener&quot; target=&quot;_blank&quot; href=&quot;https://ocamlpro.github.io/alt-ergo/index.html&quot;&gt;documentation&lt;/a&gt;&amp;nbsp;and in particular a documentation on its &lt;a rel=&quot;noreferrer noopener&quot; target=&quot;_blank&quot; href=&quot;https://ocamlpro.github.io/alt-ergo/Input_file_formats/Native/index.html&quot;&gt;native syntax&lt;/a&gt;.&lt;/p&gt;



&lt;p&gt;We also tried to improve the command line experience of our tools with the use of the &lt;a href=&quot;https://erratique.ch/software/cmdliner&quot;&gt;cmdliner library&lt;/a&gt; to parse Alt-Ergo option. This library allows us to improve the manpage of our tool. We tried to harmonise the debug messages and to improve all of Alt-Ergo&amp;#8217;s outputs to make it clearer for the users.&lt;/p&gt;



&lt;h3 id=&quot;club&quot;&gt;Alt-Ergo Users&amp;#8217; Club and R&amp;amp;D Projects &lt;a href=&quot;#club&quot;&gt;&lt;img src=&quot;https://s.w.org/images/core/emoji/12.0.0-1/72x72/2693.png&quot; alt=&quot;⚓&quot; class=&quot;wp-smiley&quot; style=&quot;height: 1em; max-height: 1em;&quot; /&gt;&lt;/a&gt;&lt;/h3&gt;



&lt;p&gt;We thank our partners from the &lt;a href=&quot;https://alt-ergo.ocamlpro.com/#club&quot;&gt;Alt-Ergo Users&amp;#8217; Club&lt;/a&gt;, Adacore, CEA List, MERCE (Mitsubishi Electric R&amp;amp;D Centre Europe) and Trust-In-Soft, for their trust. Their support allows us to maintain our tool. &lt;/p&gt;



&lt;p&gt;The club was launched in 2019 and the second annual meeting of the Alt-Ergo Users’ Club was held in mid-February 2020. Our annual meeting is the perfect place to review each partner’s needs regarding Alt-Ergo. This year, we had the pleasure of receiving our partners to discuss the roadmap for future Alt-Ergo developments and enhancements. If you want to join us for the next meeting (coming soon), contact us!&lt;/p&gt;



&lt;p&gt;We also want to thank our partners from the FUI R&amp;amp;D Project LCHIP. Thanks to this project, we were able to add a new major feature in Alt-Ergo: the support for incremental commands (&lt;code&gt;push&lt;/code&gt;, &lt;code&gt;pop&lt;/code&gt; and &lt;code&gt;check-sat-assuming&lt;/code&gt;) from the&amp;nbsp;&lt;a rel=&quot;noreferrer noopener&quot; target=&quot;_blank&quot; href=&quot;https://alt-ergo.ocamlpro.com/#releases&quot;&gt;smt-lib2 standard&lt;/a&gt;.&lt;/p&gt;



&lt;h3 id=&quot;roadmap&quot;&gt;Alt-Ergo&amp;#8217;s Roadmap &lt;a href=&quot;#roadmap&quot;&gt;&lt;img src=&quot;https://s.w.org/images/core/emoji/12.0.0-1/72x72/2693.png&quot; alt=&quot;⚓&quot; class=&quot;wp-smiley&quot; style=&quot;height: 1em; max-height: 1em;&quot; /&gt;&lt;/a&gt;&lt;/h3&gt;



&lt;p&gt;Some of the work we did in 2020 is not yet available. Thanks to our partner MERCE (Mitsubishi Electric R&amp;amp;D Centre Europe), we worked on the SMT model generation. Alt-Ergo is now (partially) able to output a model in the smt-lib2 format. Thanks to the&amp;nbsp;&lt;a rel=&quot;noreferrer noopener&quot; target=&quot;_blank&quot; href=&quot;http://why3.lri.fr/&quot;&gt;Why3&lt;/a&gt;&amp;nbsp;team from University of Paris-Saclay, we hope that this work will be available in the Why3 platform to help users in their program verification efforts.&lt;/p&gt;



&lt;p&gt;Another project was launched in 2020 but is still in early development: the complete rework of our Try-Alt-Ergo website with new features such as model generation. Try Alt-Ergo (&lt;a rel=&quot;noreferrer noopener&quot; target=&quot;_blank&quot; href=&quot;https://alt-ergo.ocamlpro.com/try.html&quot;&gt;current version&lt;/a&gt;) allows users to use Alt-Ergo directly from their browsers (Firefox, Chromium) without the need of a server for computations.&lt;/p&gt;



&lt;p&gt;This work needed a JavaScript compatible version of Alt-Ergo. We have made some work to build our solver in two versions, one compatible with Node.js and another as a webworker. We hope that this work can make it easier to use our SMT solver in web applications.&lt;/p&gt;



&lt;p&gt;&lt;em&gt;This work is funded in part by the FUI R&amp;amp;D Project LCHIP, MERCE, Adacore and with the support of the &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://alt-ergo.ocamlpro.com/#club&quot; target=&quot;_blank&quot;&gt;Alt-Ergo Users&amp;#8217; Club&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;



&lt;h2 id=&quot;rust&quot;&gt;&lt;a href=&quot;#rust&quot;&gt;&lt;img src=&quot;https://s.w.org/images/core/emoji/12.0.0-1/72x72/2693.png&quot; alt=&quot;⚓&quot; class=&quot;wp-smiley&quot; style=&quot;height: 1em; max-height: 1em;&quot; /&gt;&lt;/a&gt; In the World of Rust&lt;/h2&gt;



&lt;p&gt;*&lt;em&gt; Work by Adrien Champion&lt;/em&gt;&lt;/p&gt;



&lt;figure class=&quot;wp-block-image size-large is-resized&quot;&gt;&lt;img src=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/02/rust-1024x512.jpg&quot; alt=&quot;&quot; class=&quot;wp-image-4629&quot; width=&quot;512&quot; height=&quot;256&quot; srcset=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/02/rust-1024x512.jpg 1024w, https://www.ocamlpro.com/wp-content/uploads/2021/02/rust-300x150.jpg 300w, https://www.ocamlpro.com/wp-content/uploads/2021/02/rust.jpg 2048w&quot; sizes=&quot;(max-width: 512px) 100vw, 512px&quot; /&gt;&lt;/figure&gt;



&lt;p&gt;As OCaml-ians, we naturally saw in the Rust language a beautiful complement to our approach. One opportunity to explore this state-of-the art language has been to pursue our work on ocp-memprof and build &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://github.com/OCamlPro/memthol&quot; target=&quot;_blank&quot;&gt;Memthol&lt;/a&gt;, a visualizer and analyzer to profile OCaml programs. It works on memory dumps containing information about the size and (de)allocation date of part of the allocations performed by some execution of a program.&lt;/p&gt;



&lt;p&gt;Between lockdowns, we’ve also been able to hold &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://www.ocamlpro.com/training-ocamlpro/&quot; target=&quot;_blank&quot;&gt;our Rust training&lt;/a&gt;. It’s designed as a highly-modular vocational course, from 1 to 4 days. The training covers a beginner introduction to Rust’s basics features, crucial features and libraries for real-life development and advanced features, all through complex use-cases one would find in real life.&amp;nbsp;&lt;/p&gt;



&lt;p&gt;&lt;em&gt;This work was self-funded by OCamlPro as part of our exploration of other statically and strongly typed functional languages.&lt;/em&gt;&lt;/p&gt;



&lt;h2 id=&quot;blockchains&quot;&gt;&lt;a href=&quot;#blockchains&quot;&gt;&lt;img src=&quot;https://s.w.org/images/core/emoji/12.0.0-1/72x72/2693.png&quot; alt=&quot;⚓&quot; class=&quot;wp-smiley&quot; style=&quot;height: 1em; max-height: 1em;&quot; /&gt;&lt;/a&gt; In the World of Blockchain Languages&lt;/h2&gt;



&lt;p&gt;&lt;em&gt;* Work by David Declerck and Steven de Oliveira&lt;/em&gt;&lt;/p&gt;



&lt;figure class=&quot;wp-block-image size-large is-resized&quot;&gt;&lt;img src=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/01/Blockchain_Illustration-1024x576.jpg&quot; alt=&quot;&quot; class=&quot;wp-image-4566&quot; width=&quot;512&quot; height=&quot;288&quot; srcset=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/01/Blockchain_Illustration-1024x576.jpg 1024w, https://www.ocamlpro.com/wp-content/uploads/2021/01/Blockchain_Illustration-300x169.jpg 300w, https://www.ocamlpro.com/wp-content/uploads/2021/01/Blockchain_Illustration.jpg 1920w&quot; sizes=&quot;(max-width: 512px) 100vw, 512px&quot; /&gt;&lt;/figure&gt;



&lt;p&gt;&lt;/p&gt;



&lt;p&gt;One of our favourite activities is to develop new programming languages, specialized for specific domains, but with nice properties like clear semantics, strong typing, static typing and functional features. In 2020, we applied our skills in the domain of blockchains and smart contracts, with the creation of a new language, Love, and work on a well-known language, Solidity.&lt;/p&gt;



&lt;p&gt;In 2020, our blockchain experts released &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://dune.network/docs/dune-node-next/love-doc/introduction.html&quot; target=&quot;_blank&quot;&gt;Love&lt;/a&gt;, a type-safe language with a ML syntax and suited for formal verification. In a few words, Love is designed to be expressive for fast development, efficient in execution time and cheap in storage, and readable in terms of smart contracts auditability. Yet, it has a clear and formal semantics and a strong type system to detect bugs. It allows contracts to use other contracts as libraries, and to call viewers on other contracts. Contracts developed in Love can also be formally verified.&lt;/p&gt;



&lt;p&gt;We also released a &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://solidity.readthedocs.io/en/v0.6.8/&quot; target=&quot;_blank&quot;&gt;Solidity&lt;/a&gt; parser and printer written in OCaml using Menhir, and used it to implement a full interpreter directly in a blockchain. Solidity is probably the most used language for smart contracts, it was first born on Ethereum but many other blockchains provide it as a way to easily onboard new developers coming from the Ethereum ecosystem. In the future, we plan to extend this work with formal verification of Solidity smart contracts.&lt;/p&gt;



&lt;p&gt;&lt;em&gt;This is a joint effort with &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://www.origin-labs.com/&quot; target=&quot;_blank&quot;&gt;Origin Labs&lt;/a&gt;, the company created to tackle  blockchain-related challenges.&lt;/em&gt;&lt;/p&gt;



&lt;h2&gt;Towards 2021&lt;/h2&gt;



&lt;figure class=&quot;wp-block-image size-large is-resized&quot;&gt;&lt;img src=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/02/towards-2020-1024x563.jpg&quot; alt=&quot;&quot; class=&quot;wp-image-4632&quot; width=&quot;512&quot; height=&quot;282&quot; srcset=&quot;https://www.ocamlpro.com/wp-content/uploads/2021/02/towards-2020-1024x563.jpg 1024w, https://www.ocamlpro.com/wp-content/uploads/2021/02/towards-2020-300x165.jpg 300w, https://www.ocamlpro.com/wp-content/uploads/2021/02/towards-2020.jpg 1280w&quot; sizes=&quot;(max-width: 512px) 100vw, 512px&quot; /&gt;&lt;/figure&gt;



&lt;p&gt;Adaptability and continuous improvement, that&amp;#8217;s what 2020 brought to OCamlPro! We will remember 2020 as a complicated year, but one that allowed us to surpass ourselves and challenge our projects. We are very proud of our team who all continued to grow, learn, and develop our projects in this particular context. We are more motivated than ever for the coming year, which marks our tenth year anniversary! We&amp;#8217;re excited to continue sharing our knowledge of the OCaml world and to accompany you in your own projects.&amp;nbsp;&lt;/p&gt;



&lt;p&gt;&lt;a rel=&quot;noreferrer noopener&quot; href=&quot;mailto:contact@ocamlpro.com&quot; target=&quot;_blank&quot;&gt;Drop us a line&lt;/a&gt; or &lt;a href=&quot;https://calendly.com/contact-ocamlpro&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;call us&lt;/a&gt; if you&amp;#8217;d like to collaborate with us, we’d love to hear from you!&lt;/p&gt;
</content><category term="Highlights"/><id>https://www.ocamlpro.com/?p=4520</id><title type="text">2020 at OCamlPro</title><updated>2021-02-02T14:44:31-00:00</updated><author><name>OCamlPro</name></author></entry><entry><source><updated>2021-03-04T00:00:00-00:00</updated><link title="Tarides RSS Feed" type="text/html" href="https://tarides.com" rel="related"/><link title="Tarides RSS Feed" type="application/rss+xml" href="https://tarides.com/feed.xml" rel="self"/><generator>GatsbyJS</generator><id>https://tarides.com</id><title type="text">Tarides RSS Feed</title><author><name>Tarides</name></author></source><link href="https://tarides.com/blog/2021-01-26-recent-and-upcoming-changes-to-merlin" rel="alternate"/><content xml:base="https://tarides.com/feed.xml" type="html">&lt;p&gt;Merlin is a language server for the OCaml programming language; that is, a daemon
that connects to your favourite text editor and provides the usual services of
an IDE: instant feedback on warnings and errors, autocompletion, &quot;type of the
code under the cursor&quot;, &quot;go to definition&quot;, etc. As we (Frédéric Bour, Ulysse
Gérard and I) are about to do a new major release, we thought now would be a
good time to talk a bit about some of the changes that are going into this
release.&lt;/p&gt;
&lt;h2 id=&quot;project-configuration&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#project-configuration&quot; aria-label=&quot;project configuration permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Project configuration&lt;/h2&gt;
&lt;p&gt;Since its very first release, merlin has been getting information about the
project being worked on through a &lt;code&gt;.merlin&lt;/code&gt; file, which used to be written by
the user, but is now often generated by build systems.&lt;/p&gt;
&lt;p&gt;This had the advantage of being fairly simple: Merlin would just look in the
current directory if such a file existed, otherwise it would look in the parent
directories until it found one; and then read it. But there were also some
sore points: the granularity of the configuration is the directory not the file,
and this information is duplicated from the build system configuration (be it
dune, Makefiles, or, back in the days, ocamlbuild).&lt;/p&gt;
&lt;p&gt;After years of thinking about it, we've finally decided to make some light
changes to this process. Since version 3.4, when it scans the filesystem Merlin
is now looking for either a &lt;code&gt;.merlin&lt;/code&gt; file or a dune (or dune-project) file. And
when it finds one of those, it starts an external process in the directory where
that file lives, and asks that process for the configuration of the ml(i) file
being edited.&lt;/p&gt;
&lt;p&gt;The process in charge of communicating the configuration to Merlin will either
be a specific dune subcommand (when a dune file is found), or a dedicated
&lt;code&gt;.merlin&lt;/code&gt; reader program.&lt;/p&gt;
&lt;p&gt;We see several advantages in doing things this way (rather than, for instance,
changing the format of &lt;code&gt;.merlin&lt;/code&gt; files):&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;this change is entirely backward compatible, and indeed the transition has
already happened silently; although dune is still emitting &lt;code&gt;.merlin&lt;/code&gt; files,
this will only stop with dune 2.8.&lt;/li&gt;
&lt;li&gt;externalizing the reading of &lt;code&gt;.merlin&lt;/code&gt; files and simply requiring a
&quot;normalized&quot; version of the config (i.e. with no mention of packages, just of
flags and paths) allowed us to simplify the internals of Merlin.&lt;/li&gt;
&lt;li&gt;talking to the build system directly not only gets us a much finer grained
configuration (which is important when you build different executables with
different flags in the same directory, or if you apply different ppxes to
different files of a library), it opens the door to getting a nicer behavior
of Merlin in some circumstances. For instance, the build system can (and
does) tell Merlin when the project isn't built. Currently we only report that
information to the user when he asks for errors, alongside all the other
(mostly rubbish) errors. Which is already helpful in itself. But in the
future we can start filtering the other errors to only report those that
would remain even after building the project (e.g. parse errors).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;There are however some changes to look out for:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;people who still use &lt;code&gt;.merlin&lt;/code&gt; files but do not install Merlin using opam need
to make sure to also have the &lt;code&gt;dot-merlin-reader&lt;/code&gt; binary in their PATH (it is
available as an opam package, but is also buildable from Merlin's git
repository)&lt;/li&gt;
&lt;li&gt;vim and emacs users who could previously load packages interactively (by
calling &lt;code&gt;M-x merlin-use&lt;/code&gt; or &lt;code&gt;:MerlinUse&lt;/code&gt;) cannot do that anymore, since Merlin
itself stopped linking with findlib. They'll have to write a &lt;code&gt;.merlin&lt;/code&gt; file.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;dropping-support-for-old-versions-of-ocaml&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#dropping-support-for-old-versions-of-ocaml&quot; aria-label=&quot;dropping support for old versions of ocaml permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Dropping support for old versions of OCaml&lt;/h2&gt;
&lt;p&gt;Until now, every release of Merlin has kept support from OCaml 4.02 to the
latest version of OCaml available at the time of that release.&lt;/p&gt;
&lt;p&gt;We have done this by having one version of &quot;&lt;em&gt;the frontend&lt;/em&gt;&quot; (i.e. handling of
buffer state, project configuration; analyses like &lt;em&gt;jump-to-definition&lt;/em&gt;,
&lt;em&gt;prefix-completion&lt;/em&gt;, etc.), but several versions of &quot;&lt;em&gt;the backend&lt;/em&gt;&quot; (OCaml's
ASTs, parser and typechecker), and choosing at build time which one to use.
The reason for doing this instead of having, for instance, one branch of Merlin
per version of OCaml, is that while the backends are fairly stable once
released, Merlin's frontend keeps evolving. Having just one version of it makes
it easier to add features and fix bugs (patches don't need to be duplicated),
whilst ensuring that Merlin's behavior is consistent across every version of
OCaml that we support.&lt;/p&gt;
&lt;p&gt;For this to work however, one needs a well defined API between the frontend and
all the versions of the backend. This implies mapping every versions of OCaml's
internal ASTs (which receive modifications from one version to the next), to a
unified one, so as to keep Merlin's various features version agnostic. But it
also means being resilient to OCaml's internal API changes. For instance between
4.02 and 4.11 there were big refactorings impacting: the way one accesses the
typing environment, the way one accesses the &quot;load path&quot; (the part of the file
system the compiler/Merlin is aware of), the way error message are produced, ...&lt;/p&gt;
&lt;p&gt;The rate of changes on the compiler is a lot higher than what it was when we
first started Merlin (7 years ago now!) which doesn't just mean that we have to
spend more and more time on updating the common interface, but also that the
interface is getting harder to define. Recently (with the 4.11 release) some of
the changes were significant enough that for some parts of the backend we just
didn't manage to produce a single interface to access old and new versions, so
instead we had to start duplicating and specializing parts of the frontend.
And we don't expect things to get much better in the near future.&lt;/p&gt;
&lt;p&gt;Furthermore, Merlin's backends are patched to be more resilient to parsing and
typing errors in the user's code. Those patches also need to be evolved at each
new release of the compiler.
The work required to keep the &quot;unified interface&quot; working was taking time away
from updating our patches properly, and our support of user errors has slowly
been getting worse over the past few years, resulting in less precise type
information when asked, incomplete results when asking for auto-completion, etc.&lt;/p&gt;
&lt;p&gt;Therefore we have decided to stop dragging older versions of OCaml along. We
plan to switch to a system where we have one branch of Merlin per version of
OCaml, and each opam release of Merlin will only be buildable with one version
of OCaml. We will keep maintaining all the relatively recent branches (that is:
4.02 definitely will not get fixes, but 4.06 is still in the clear). However,
all the new features will be developed against the latest version of OCaml and
cherry-picked to older branches if, and only if, there are no merge conflicts
and they work as expected without changes.&lt;/p&gt;
&lt;p&gt;We hope that this will make it easier for us to update to new versions of OCaml
(actually, we already know it does, working on adding support for 4.12 was
easier than for any of the other recent versions), will allow us to clean up
Merlin's codebase (let's call that a work in progress), and will free some time
to work on new features.&lt;/p&gt;
&lt;p&gt;You might wonder what all this changes for you, as a user, in practice. Well, it
depends:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;if you install Merlin from opam: nothing, or almost nothing. Everything that
you currently do with Merlin will keep working. In the future, perhaps some
new feature will appear that won't work on all versions. But that day hasn't
come yet.&lt;/li&gt;
&lt;li&gt;if you install Merlin some other way (manually?): you can't just fetch master
and build it anymore. You have to pick the appropriate branch for your
version of OCaml.&lt;/li&gt;
&lt;li&gt;if you're reusing Merlin's codebase as part of another project and (even
worse) have patches on it: come and talk to us if you haven't done so already!
We can try and integrate your patches, so that you only need to worry about
vendoring the right version(s) for your needs.&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Over the years, Merlin has received bugfixes and improvements from a long list of
people, but for the upcoming release Frédéric and I are particularly grateful to
Rudi Grinberg, a long time and regular contributor who also maintains the OCaml
LSP project, as well as Ulysse Gérard, who joined our team a year ago now. They
are in particular the main authors of the work to improve the handling of
projects' configuration.&lt;/p&gt;
&lt;p&gt;We hope you'll be as excited as us by all these changes!&lt;/p&gt;</content><id>https://tarides.com/blog/2021-01-26-recent-and-upcoming-changes-to-merlin.html</id><title type="text">Recent and upcoming changes to Merlin</title><updated>2021-01-26T00:00:00-00:00</updated><author><name>Tarides</name></author></entry><entry><summary type="text">&lt;p&gt;Home office, MirageOS unikernels, 2020 recap, 2021 tbd&lt;/p&gt;
</summary><source><updated>2021-01-25T12:45:54-00:00</updated><link href="https://hannes.nqsb.io/atom" rel="self"/><id>urn:uuid:981361ca-e71d-4997-a52c-baeee78e4156</id><title type="text">full stack engineer</title><author><name>Hannes Mehnert</name></author></source><published>2021-01-25T12:45:54-00:00</published><link href="https://hannes.nqsb.io/Posts/NGI" rel="alternate"/><content xml:base="https://hannes.nqsb.io/atom" type="html">

&lt;h2 id=&quot;Introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;2020 was an intense year. I hope you&amp;#39;re healthy and keep being healthy. I am privileged (as lots of software engineers and academics are) to be able to work from home during the pandemic. Let&amp;#39;s not forget people in less privileged situations,  and let’s try to give them as much practical, psychological and financial support as we can these days. And as much joy as possible to everyone around :)&lt;/p&gt;
&lt;p&gt;I cancelled the autumn MirageOS retreat due to the pandemic. Instead I collected donations for our hosts in Marrakech - they were very happy to receive our financial support, since they had a difficult year, since their income is based on tourism. I hope that in autumn 2021 we&amp;#39;ll have an on-site retreat again.&lt;/p&gt;
&lt;p&gt;For 2021, we (at &lt;a href='https://robur.coop'&gt;robur&lt;/a&gt;) got a grant from the EU (via &lt;a href='https://pointer.ngi.eu'&gt;NGI pointer&lt;/a&gt;) for &amp;quot;Deploying MirageOS&amp;quot; (more details below), and another grant from &lt;a href='https://ocaml-sf.org'&gt;OCaml software foundation&lt;/a&gt; for securing the opam supply chain (using &lt;a href='https://github.com/hannesm/conex'&gt;conex&lt;/a&gt;). Some long-awaited releases for MirageOS libraries, namely a &lt;a href='https://discuss.ocaml.org/t/ann-first-release-of-awa-ssh'&gt;ssh implementation&lt;/a&gt; and a rewrite of our &lt;a href='https://discuss.ocaml.org/t/ann-release-of-ocaml-git-v3-0-duff-encore-decompress-etc/'&gt;git implementation&lt;/a&gt; have already been published.&lt;/p&gt;
&lt;p&gt;With my MirageOS view, 2020 was a pretty successful year, where we managed to add more features, fixed lots of bugs, and paved the road ahead. I want to thank &lt;a href='https://ocamllabs.io/'&gt;OCamlLabs&lt;/a&gt; for funding work on MirageOS maintenance.&lt;/p&gt;
&lt;h2 id=&quot;Recap-2020&quot;&gt;Recap 2020&lt;/h2&gt;

&lt;p&gt;Here is a very subjective random collection of accomplishments in 2020, where I was involved with some degree.&lt;/p&gt;
&lt;h3 id=&quot;NetHSM&quot;&gt;NetHSM&lt;/h3&gt;

&lt;p&gt;&lt;a href='https://www.nitrokey.com/products/nethsm'&gt;NetHSM&lt;/a&gt; is a hardware security module in software. It is a product that uses MirageOS for security, and is based on the &lt;a href='https://muen.sk'&gt;muen&lt;/a&gt; separation kernel. We at &lt;a href='https://robur.coop'&gt;robur&lt;/a&gt; were heavily involved in this product. It already has been security audited by an external team. You can pre-order it from Nitrokey.&lt;/p&gt;
&lt;h3 id=&quot;TLS-1-3&quot;&gt;TLS 1.3&lt;/h3&gt;

&lt;p&gt;Dating back to 2016, at the &lt;a href='https://www.ndss-symposium.org/ndss2016/tron-workshop-programme/'&gt;TRON&lt;/a&gt; (TLS 1.3 Ready or NOt), we developed a first draft of a 1.3 implementation of &lt;a href='https://github.com/mirleft/ocaml-tls'&gt;OCaml-TLS&lt;/a&gt;. Finally in May 2020 we got our act together, including ECC (ECDH P256 from &lt;a href='https://github.com/mit-plv/fiat-crypto/'&gt;fiat&lt;/a&gt;, X25519 from &lt;a href='https://project-everest.github.io/'&gt;hacl&lt;/a&gt;) and testing with &lt;a href='https://github.com/tlsfuzzer/tlsfuzzer'&gt;tlsfuzzer&lt;/a&gt;, and release tls 0.12.0 with TLS 1.3 support. Later we added &lt;a href='https://github.com/mirleft/ocaml-tls/pull/414'&gt;ECC ciphersuites to TLS version 1.2&lt;/a&gt;, implemented &lt;a href='https://github.com/mirleft/ocaml-tls/pull/414'&gt;ChaCha20/Poly1305&lt;/a&gt;, and fixed an &lt;a href='https://github.com/mirleft/ocaml-tls/pull/424'&gt;interoperability issue with Go&amp;#39;s implementation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a href='https://github.com/mirage/mirage-crypto'&gt;Mirage-crypto&lt;/a&gt; provides the underlying cryptographic primitives, initially released in March 2020 as a fork of &lt;a href='https://github.com/mirleft/ocaml-nocrypto'&gt;nocrypto&lt;/a&gt; -- huge thanks to &lt;a href='https://github.com/pqwy'&gt;pqwy&lt;/a&gt; for his great work. Mirage-crypto detects &lt;a href='https://github.com/mirage/mirage-crypto/pull/53'&gt;CPU features at runtime&lt;/a&gt; (thanks to &lt;a href='https://github.com/Julow'&gt;Julow&lt;/a&gt;) (&lt;a href='https://github.com/mirage/mirage-crypto/pull/96'&gt;bugfix for bswap&lt;/a&gt;), using constant time modular exponentation (powm_sec) and hardens against Lenstra&amp;#39;s CRT attack, supports &lt;a href='https://github.com/mirage/mirage-crypto/pull/39'&gt;compilation on Windows&lt;/a&gt; (thanks to &lt;a href='https://github.com/avsm'&gt;avsm&lt;/a&gt;), &lt;a href='https://github.com/mirage/mirage-crypto/pull/90'&gt;async entropy harvesting&lt;/a&gt; (thanks to &lt;a href='https://github.com/seliopou'&gt;seliopou&lt;/a&gt;), &lt;a href='https://github.com/mirage/mirage-crypto/pull/65'&gt;32 bit support&lt;/a&gt;, &lt;a href='https://github.com/mirage/mirage-crypto/pull/72'&gt;chacha20/poly1305&lt;/a&gt; (thanks to &lt;a href='https://github.com/abeaumont'&gt;abeaumont&lt;/a&gt;), &lt;a href='https://github.com/mirage/mirage-crypto/pull/84'&gt;cross-compilation&lt;/a&gt; (thanks to &lt;a href='https://github.com/EduardoRFS'&gt;EduardoRFS&lt;/a&gt;) and &lt;a href='https://github.com/mirage/mirage-crypto/pull/78'&gt;various&lt;/a&gt; &lt;a href='https://github.com/mirage/mirage-crypto/pull/81'&gt;bug&lt;/a&gt; &lt;a href='https://github.com/mirage/mirage-crypto/pull/83'&gt;fixes&lt;/a&gt;, even &lt;a href='https://github.com/mirage/mirage-crypto/pull/95'&gt;memory leak&lt;/a&gt; (thanks to &lt;a href='https://github.com/talex5'&gt;talex5&lt;/a&gt; for reporting several of these issues), and &lt;a href='https://github.com/mirage/mirage-crypto/pull/99'&gt;RSA&lt;/a&gt; &lt;a href='https://github.com/mirage/mirage-crypto/pull/100'&gt;interoperability&lt;/a&gt; (thanks to &lt;a href='https://github.com/psafont'&gt;psafont&lt;/a&gt; for investigation and &lt;a href='https://github.com/mattjbray'&gt;mattjbray&lt;/a&gt; for reporting). This library feels very mature now - being used by multiple stakeholders, and lots of issues have been fixed in 2020.&lt;/p&gt;
&lt;h3 id=&quot;Qubes-Firewall&quot;&gt;Qubes Firewall&lt;/h3&gt;

&lt;p&gt;The &lt;a href='https://github.com/mirage/qubes-mirage-firewall/'&gt;MirageOS based Qubes firewall&lt;/a&gt; is the most widely used MirageOS unikernel. And it got major updates: in May &lt;a href='https://github.com/linse'&gt;Steffi&lt;/a&gt; &lt;a href='https://groups.google.com/g/qubes-users/c/Xzplmkjwa5Y'&gt;announced&lt;/a&gt; her and &lt;a href='https://github.com/yomimono'&gt;Mindy&amp;#39;s&lt;/a&gt; work on improving it for Qubes 4.0 - including &lt;a href='https://www.qubes-os.org/doc/vm-interface/#firewall-rules-in-4x'&gt;dynamic firewall rules via QubesDB&lt;/a&gt;. Thanks to &lt;a href='https://prototypefund.de/project/portable-firewall-fuer-qubesos/'&gt;prototypefund&lt;/a&gt; for sponsoring.&lt;/p&gt;
&lt;p&gt;In October 2020, we released &lt;a href='https://mirage.io/blog/announcing-mirage-39-release'&gt;Mirage 3.9&lt;/a&gt; with PVH virtualization mode (thanks to &lt;a href='https://github.com/mato'&gt;mato&lt;/a&gt;). There&amp;#39;s still a &lt;a href='https://github.com/mirage/qubes-mirage-firewall/issues/120'&gt;memory leak&lt;/a&gt; to be investigated and fixed.&lt;/p&gt;
&lt;h3 id=&quot;IPv6&quot;&gt;IPv6&lt;/h3&gt;

&lt;p&gt;In December, with &lt;a href='https://mirage.io/blog/announcing-mirage-310-release'&gt;Mirage 3.10&lt;/a&gt; we got the IPv6 code up and running. Now MirageOS unikernels have a dual stack available, besides IPv4-only and IPv6-only network stacks. Thanks to &lt;a href='https://github.com/nojb'&gt;nojb&lt;/a&gt; for the initial code and &lt;a href='https://github.com/MagnusS'&gt;MagnusS&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Turns out this blog, but also robur services, are now available via IPv6 :)&lt;/p&gt;
&lt;h3 id=&quot;Albatross&quot;&gt;Albatross&lt;/h3&gt;

&lt;p&gt;Also in December, I pushed an initial release of &lt;a href='https://github.com/roburio/albatross'&gt;albatross&lt;/a&gt;, a unikernel orchestration system with remote access. &lt;em&gt;Deploy your unikernel via a TLS handshake -- the unikernel image is embedded in the TLS client certificates.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Thanks to &lt;a href='https://github.com/reynir'&gt;reynir&lt;/a&gt; for statistics support on Linux and improvements of the systemd service scripts. Also thanks to &lt;a href='https://github.com/cfcs'&gt;cfcs&lt;/a&gt; for the initial Linux port.&lt;/p&gt;
&lt;h3 id=&quot;CA-certs&quot;&gt;CA certs&lt;/h3&gt;

&lt;p&gt;For several years I postponed the problem of how to actually use the operating system trust anchors for OCaml-TLS connections. Thanks to &lt;a href='https://github.com/emillon'&gt;emillon&lt;/a&gt; for initial code, there are now &lt;a href='https://github.com/mirage/ca-certs'&gt;ca-certs&lt;/a&gt; and &lt;a href='https://github.com/mirage/ca-certs-nss'&gt;ca-certs-nss&lt;/a&gt; opam packages (see &lt;a href='https://discuss.ocaml.org/t/ann-ca-certs-and-ca-certs-nss'&gt;release announcement&lt;/a&gt;) which fills this gap.&lt;/p&gt;
&lt;h2 id=&quot;Unikernels&quot;&gt;Unikernels&lt;/h2&gt;

&lt;p&gt;I developed several useful unikernels in 2020, and also pushed &lt;a href='https://mirage.io/wiki/gallery'&gt;a unikernel gallery&lt;/a&gt; to the Mirage website:&lt;/p&gt;
&lt;h3 id=&quot;Traceroute-in-MirageOS&quot;&gt;Traceroute in MirageOS&lt;/h3&gt;

&lt;p&gt;I already wrote about &lt;a href='/Posts/Traceroute'&gt;traceroute&lt;/a&gt; which traces the routing to a given remote host.&lt;/p&gt;
&lt;h3 id=&quot;Unipi-static-website-hosting&quot;&gt;Unipi - static website hosting&lt;/h3&gt;

&lt;p&gt;&lt;a href='https://github.com/roburio/unipi'&gt;Unipi&lt;/a&gt; is a static site webserver which retrieves the content from a remote git repository. Let&amp;#39;s encrypt certificate provisioning and dynamic updates via a webhook to be executed for every push.&lt;/p&gt;
&lt;h4 id=&quot;TLSTunnel-TLS-demultiplexing&quot;&gt;TLSTunnel - TLS demultiplexing&lt;/h4&gt;

&lt;p&gt;The physical machine this blog and other robur infrastructure runs on has been relocated from Sweden to Germany mid-December. Thanks to UPS! Fewer IPv4 addresses are available in the new data center, which motivated me to develop &lt;a href='https://github.com/roburio/tlstunnel'&gt;tlstunnel&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The new behaviour is as follows (see the &lt;code&gt;monitoring&lt;/code&gt; branch):&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;listener on TCP port 80 which replies with a permanent redirect to &lt;code&gt;https&lt;/code&gt;&lt;/li&gt;&lt;li&gt;listener on TCP port 443 which forwards to a backend host if the requested server name is configured&lt;/li&gt;&lt;li&gt;its configuration is stored on a block device, and can be dynamically changed (with a custom protocol authenticated with a HMAC)&lt;/li&gt;&lt;li&gt;it is setup to hold a wildcard TLS certificate and in DNS a wildcard entry is pointing to it&lt;/li&gt;&lt;li&gt;setting up a new service is very straightforward: only the new name needs to be registered with tlstunnel together with the TCP backend, and everything will just work&lt;/li&gt;&lt;/ul&gt;

&lt;h2 id=&quot;2021&quot;&gt;2021&lt;/h2&gt;

&lt;p&gt;The year started with a release of &lt;a href='https://discuss.ocaml.org/t/ann-first-release-of-awa-ssh'&gt;awa&lt;/a&gt;, a SSH implementation in OCaml (thanks to &lt;a href='https://github.com/haesbaert'&gt;haesbaert&lt;/a&gt; for initial code). This was followed by a &lt;a href='https://discuss.ocaml.org/t/ann-release-of-ocaml-git-v3-0-duff-encore-decompress-etc/'&gt;git 3.0 release&lt;/a&gt; (thanks to &lt;a href='https://github.com/dinosaure'&gt;dinosaure&lt;/a&gt;).&lt;/p&gt;
&lt;h3 id=&quot;Deploying-MirageOS-NGI-Pointer&quot;&gt;Deploying MirageOS - NGI Pointer&lt;/h3&gt;

&lt;p&gt;For 2021 we at robur received funding from the EU (via &lt;a href='https://pointer.ngi.eu/'&gt;NGI pointer&lt;/a&gt;) for &amp;quot;Deploying MirageOS&amp;quot;, which boils down into three parts:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;reproducible binary releases of MirageOS unikernels,&lt;/li&gt;&lt;li&gt;monitoring (and other devops features: profiling) and integration into existing infrastructure,&lt;/li&gt;&lt;li&gt;and further documentation and advertisement.&lt;/li&gt;&lt;/ul&gt;

&lt;p&gt;Of course this will all be available open source. Please get in touch via eMail (team aT robur dot coop) if you&amp;#39;re eager to integrate MirageOS unikernels into your infrastructure.&lt;/p&gt;
&lt;p&gt;We discovered at an initial meeting with an infrastructure provider that a DNS resolver is of interest - even more now that dnsmasq suffered from &lt;a href='https://www.jsof-tech.com/wp-content/uploads/2021/01/DNSpooq_Technical-Whitepaper.pdf'&gt;dnspooq&lt;/a&gt;. We are already working on an &lt;a href='https://github.com/mirage/ocaml-dns/pull/251'&gt;implementation of DNSSec&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;MirageOS unikernels are binary reproducible, and &lt;a href='https://github.com/rjbou/orb/pull/1'&gt;infrastructure tools are available&lt;/a&gt;. We are working hard on a web interface (and REST API - think of it as &amp;quot;Docker Hub for MirageOS unikernels&amp;quot;), and more tooling to verify reproducibility.&lt;/p&gt;
&lt;h3 id=&quot;Conex-securing-the-supply-chain&quot;&gt;Conex - securing the supply chain&lt;/h3&gt;

&lt;p&gt;Another funding from the &lt;a href='http://ocaml-sf.org/'&gt;OCSF&lt;/a&gt; is to continue development and deploy &lt;a href='https://github.com/hannesm/conex'&gt;conex&lt;/a&gt; - to bring trust into opam-repository. This is a great combination with the reproducible build efforts, and will bring much more trust into retrieving OCaml packages and using MirageOS unikernels.&lt;/p&gt;
&lt;h3 id=&quot;MirageOS-4-0&quot;&gt;MirageOS 4.0&lt;/h3&gt;

&lt;p&gt;Mirage so far still uses ocamlbuild and ocamlfind for compiling the virtual machine binary. But the switch to dune is &lt;a href='https://github.com/mirage/mirage/issues/1195'&gt;close&lt;/a&gt;, a lot of effort has been done. This will make the developer experience of MirageOS much more smooth, with a per-unikernel monorepo workflow where you can push your changes to the individual libraries.&lt;/p&gt;
&lt;h2 id=&quot;Footer&quot;&gt;Footer&lt;/h2&gt;

&lt;p&gt;If you want to support our work on MirageOS unikernels, please &lt;a href='https://robur.coop/Donate'&gt;donate to robur&lt;/a&gt;. I&amp;#39;m interested in feedback, either via &lt;a href='https://twitter.com/h4nnes'&gt;twitter&lt;/a&gt;, &lt;a href='https://mastodon.social/@hannesm'&gt;hannesm@mastodon.social&lt;/a&gt; or an issue on the &lt;a href='https://github.com/hannesm/hannes.nqsb.io/issues'&gt;data repository&lt;/a&gt;.&lt;/p&gt;
</content><category scheme="https://hannes.nqsb.io/tags/mirageos" term="mirageos"/><id>urn:uuid:bc7675a5-47d0-5ce1-970c-01ed07fdf404</id><title type="text">The road ahead for MirageOS in 2021</title><updated>2021-01-25T12:45:54-00:00</updated><author><name>hannes</name></author></entry><entry><source><updated>2021-03-29T10:00:00-00:00</updated><logo>https://www.ocamlpro.com/wp-content/uploads/2020/07/cropped-favicon-32x32.png</logo><link title="OCamlPro" type="text/html" href="https://www.ocamlpro.com" rel="related"/><link title="OCamlPro" type="application/rss+xml" href="https://www.ocamlpro.com/feed/" rel="self"/><generator>https://wordpress.org/?v=5.4.4</generator><id>https://www.ocamlpro.com</id><title type="text">OCamlPro</title><author><name>OCamlPro</name></author></source><link href="https://www.ocamlpro.com/2021/01/22/release-of-alt-ergo-2-4-0/" rel="alternate"/><link href="https://www.ocamlpro.com/2021/01/22/release-of-alt-ergo-2-4-0/#respond" rel="related"/><content xml:base="https://www.ocamlpro.com/feed/" type="html">
&lt;p&gt;A new release of Alt-Ergo (version 2.4.0)  is available.&lt;/p&gt;



&lt;p&gt;You can get it from &lt;a href=&quot;https://alt-ergo.ocamlpro.com/&quot;&gt;Alt-Ergo&amp;#8217;s website&lt;/a&gt;. The associated opam package will be published in the next few days.&lt;/p&gt;



&lt;p&gt;This release contains some major novelties:&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;Alt-Ergo supports incremental commands (push/pop) from the &lt;a href=&quot;https://smtlib.cs.uiowa.edu/&quot;&gt;smt-lib &lt;/a&gt;standard. &lt;/li&gt;&lt;li&gt;We switched command line parsing to use &lt;a href=&quot;https://erratique.ch/software/cmdliner&quot;&gt;cmdliner&lt;/a&gt;. You will need to  use &lt;code&gt;--&amp;lt;option name&amp;gt;&lt;/code&gt; instead of &lt;code&gt;-&amp;lt;option name&amp;gt;&lt;/code&gt;. Some options have also been renamed, see the manpage or the documentation.&lt;/li&gt;&lt;li&gt;We improved the online documentation of your solver, available &lt;a href=&quot;https://ocamlpro.github.io/alt-ergo/&quot;&gt;here&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt;



&lt;p&gt;This release also contains  some minor novelties:&lt;/p&gt;



&lt;ul&gt;&lt;li&gt; &lt;code&gt;.mlw&lt;/code&gt; and &lt;code&gt;.why&lt;/code&gt; extension are depreciated, the use of &lt;code&gt;.ae&lt;/code&gt; extension is advised.&lt;/li&gt;&lt;li&gt;Add &lt;code&gt;--input&lt;/code&gt; (resp &lt;code&gt;--output&lt;/code&gt;) option to manually set the input (resp output) file format&lt;/li&gt;&lt;li&gt;Add &lt;code&gt;--pretty-output&lt;/code&gt; option to add better debug formatting and to add colors&lt;/li&gt;&lt;li&gt;Add exponentiation operation, &lt;code&gt;**&lt;/code&gt; in native Alt-Ergo syntax. The operator is fully interpreted when applied to constants&lt;/li&gt;&lt;li&gt;Fix &lt;code&gt;--steps-count&lt;/code&gt; and improve the way steps are counted (AdaCore contribution)&lt;/li&gt;&lt;li&gt;Add &lt;code&gt;--instantiation-heuristic&lt;/code&gt; option that can enable lighter or heavier instantiation&lt;/li&gt;&lt;li&gt;Reduce the instantiation context (considered foralls / exists) in CDCL-Tableaux to better mimic the Tableaux-like SAT solver&lt;/li&gt;&lt;li&gt;Multiple bugfixes&lt;/li&gt;&lt;/ul&gt;



&lt;p&gt;The full list of changes is available &lt;a href=&quot;https://ocamlpro.github.io/alt-ergo/About/changes.html&quot;&gt;here&lt;/a&gt;. As usual, do not hesitate to report bugs, to ask questions, or to give your feedback!&lt;/p&gt;



&lt;blockquote class=&quot;wp-block-quote&quot;&gt;&lt;p&gt;&lt;strong&gt;About OCamlPro:&lt;/strong&gt;&lt;br&gt;OCamlPro SAS is an INRIA spin-off company created in April 2011 to promote the use of the OCaml programming language in the industrial sector. It actively participates in research and development aimed at improving safety and security in the security of computer applications in general. You will find more information on our website: &lt;a href=&quot;http://www.ocamlpro.com &quot;&gt;http://www.ocamlpro.com&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;



&lt;p&gt;&lt;/p&gt;



&lt;p&gt;&lt;/p&gt;



&lt;p&gt;&lt;/p&gt;
</content><category term="Blog"/><id>https://www.ocamlpro.com/?p=4499</id><title type="text">Release of Alt-Ergo 2.4.0</title><updated>2021-01-22T11:00:00-00:00</updated><author><name>OCamlPro</name></author></entry><entry><source><updated>2021-02-26T00:00:00-00:00</updated><link title="The Coq Proof Assistant" type="text/html" href="https://coq.inria.fr" rel="related"/><link title="The Coq Proof Assistant" type="application/rss+xml" href="https://coq.inria.fr/rss.xml" rel="self"/><id>https://coq.inria.fr</id><title type="text">The Coq Proof Assistant</title><author><name>Coq</name></author></source><link href="https://coq.inria.fr/news/coq-8-13-0-is-out.html" rel="alternate"/><content xml:base="https://coq.inria.fr/rss.xml" type="html">

&lt;p&gt;
The Coq development team is proud to announce the immediate availability of
&lt;a href=&quot;https://github.com/coq/coq/releases/tag/V8.13.0&quot;&gt;Coq 8.13.0&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
Highlights:
&lt;ul&gt;
&lt;li&gt;Introduction of primitive persistent arrays in the core language, implemented using imperative persistent arrays. &lt;/li&gt;
&lt;li&gt;Introduction of definitional proof irrelevance for the equality type defined in the SProp sort. &lt;/li&gt;
&lt;li&gt;Many improvements to the handling of notations, including number notations, recursive notations and notations with bindings. A new algorithm chooses the most precise notation available to print an expression, which might introduce changes in printing behavior.&lt;/li&gt;
&lt;/ul&gt;
&lt;/p&gt;


&lt;p&gt;Please see &lt;a href=&quot;https://coq.github.io/doc/v8.13/refman/changes.html#version-8-13&quot; rel=&quot;nofollow&quot;&gt;the changelog&lt;/a&gt; to learn more about this release.&lt;/p&gt;


 </content><id>https://coq.inria.fr/news/coq-8-13-0-is-out.html</id><title type="text">Coq 8.13.0 is out</title><updated>2021-01-07T00:00:00-00:00</updated><author><name>Coq</name></author></entry><entry><source><updated>2021-03-26T13:00:42-00:00</updated><link title="Seb's blog /b/" type="text/html" href="https://seb.mondet.org/b/" rel="related"/><link title="Seb's blog /b/" type="application/rss+xml" href="https://seb.mondet.org/b/OCaml.rss" rel="self"/><id>https://seb.mondet.org/b/</id><title type="text">Seb's blog /b/</title><author><name>Sebastien Mondet</name></author></source><link href="https://seb.mondet.org/b/0010-delphi-challenge-post-vivum.html" rel="alternate"/><content xml:base="https://seb.mondet.org/b/OCaml.rss" type="html">
    Because the method — some messing around with the tezos-crypto library
    — could be useful to others.
    Also, some code annotated in SVG.
   </content><id>https://seb.mondet.org/b/0010-delphi-challenge-post-vivum.html</id><title type="text">How We Lost at The Delphi Oracle Challenge</title><updated>2020-12-23T13:00:42-00:00</updated><author><name>Sebastien Mondet</name></author></entry><entry><source><updated>2021-03-04T00:00:00-00:00</updated><link title="Tarides RSS Feed" type="text/html" href="https://tarides.com" rel="related"/><link title="Tarides RSS Feed" type="application/rss+xml" href="https://tarides.com/feed.xml" rel="self"/><generator>GatsbyJS</generator><id>https://tarides.com</id><title type="text">Tarides RSS Feed</title><author><name>Tarides</name></author></source><link href="https://tarides.com/blog/2020-12-14-tarides-sponsors-the-oxbridge-women-in-computer-science-conference-2020" rel="alternate"/><content xml:base="https://tarides.com/feed.xml" type="html">&lt;p&gt;The &lt;a href=&quot;https://oxbridgewomenincs8.wixsite.com/2020&quot;&gt;Oxbridge Women in Computer Science
conference&lt;/a&gt; is an annual one-day
event hosted by the Universities of Oxford and Cambridge (UK). The
conference is free and open to everyone from any discipline, regardless of
gender identity. Its purpose is to spotlight the successes of women within
computer science and strengthen the network of women in computer science
within a supportive and friendly environment.&lt;/p&gt;
&lt;p&gt;This year, the conference was organised by the University of Cambridge and was
held virtually on December 7th.&lt;/p&gt;
&lt;p&gt;Tarides is very glad to sponsor this event as we strongly believe that diversity
and inclusive culture is a key factor in building a competitive and innovative
company. Our employees come from 8 different countries and are 1⁄3 women.
Tarides promotes transparency, openness and autonomy, creating a work atmosphere
auspicious for employees to strive in their work, to solve novel, impactful and
technical challenges. By working on open-source projects, a collaboration is
possible with worldwide experts from both academia and industry, encouraging
continuous training and education; in this context, it is very important to have
teams with diverse backgrounds and experience.&lt;/p&gt;
&lt;p&gt;The underrepresentation of women in tech, and particularly in computer science,
is not a new problem and gender equality remains a major issue in the corporate
world. By celebrating female computer scientists, as during the Oxbridge Women
in Computer Science Conference, it will hopefully encourage more women to pursue
their interests and careers in the tech field. Head
&lt;a href=&quot;https://tarides.com/company/&quot;&gt;here&lt;/a&gt; to see our currently-open positions.&lt;/p&gt;
&lt;p&gt;For the event, we made a short video to experience a day in the life of a
software engineer:&lt;/p&gt;
&lt;div style=&quot;position: relative; width: 100%; height: 0; padding-bottom: 56.25%&quot;&gt;
  &lt;iframe
    style=&quot;position: absolute; width: 100%; height: 100%; left: 0; right: 0&quot;
    src=&quot;https://www.youtube-nocookie.com/embed/5qK8elKNxKI&quot; frameborder=&quot;0&quot;
    allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot;
    allowfullscreen /&gt;
&lt;/div&gt;</content><id>https://tarides.com/blog/2020-12-14-tarides-sponsors-the-oxbridge-women-in-computer-science-conference-2020.html</id><title type="text">Tarides sponsors the Oxbridge Women in Computer Science Conference 2020</title><updated>2020-12-14T00:00:00-00:00</updated><author><name>Tarides</name></author></entry><entry><source><updated>2021-02-26T00:00:00-00:00</updated><link title="The Coq Proof Assistant" type="text/html" href="https://coq.inria.fr" rel="related"/><link title="The Coq Proof Assistant" type="application/rss+xml" href="https://coq.inria.fr/rss.xml" rel="self"/><id>https://coq.inria.fr</id><title type="text">The Coq Proof Assistant</title><author><name>Coq</name></author></source><link href="https://coq.inria.fr/news/coq-8-12-2-is-out.html" rel="alternate"/><content xml:base="https://coq.inria.fr/rss.xml" type="html">

&lt;p&gt;We are happy to announce the &lt;a
href=&quot;https://github.com/coq/coq/releases/tag/V8.12.2&quot;&gt;release of Coq
8.12.2&lt;/a&gt;.

&lt;p&gt;This release fixes two impacting 8.12 regressions (in notations and
the implicit argument inference of the exists tactic).  See the &lt;a
href=&quot;https://coq.inria.fr/distrib/V8.12.2/refman/changes.html#changes-in-8-12-2&quot;&gt;changelog&lt;/a&gt;
for details.&lt;/p&gt;


 </content><id>https://coq.inria.fr/news/coq-8-12-2-is-out.html</id><title type="text">Coq 8.12.2 is out</title><updated>2020-12-11T00:00:00-00:00</updated><author><name>Coq</name></author></entry><entry><source><updated>2021-03-08T00:00:00-00:00</updated><link title="Frama-C RSS News" type="text/html" href="https://frama-c.com" rel="related"/><link title="Frama-C RSS News" type="application/rss+xml" href="http://frama-c.com/rss.xml" rel="self"/><id>https://frama-c.com</id><title type="text">Frama-C RSS News</title><author><name>Frama-C</name></author></source><link href="https://frama-c.com/fc-plugins/metacsl.html" rel="alternate"/><id>https://frama-c.com/fc-plugins/metacsl.html#13dcc2226274e0c6f57d0f95907564c9</id><title type="text">First release of MetAcsl plugin</title><updated>2020-12-09T00:00:00-00:00</updated><author><name>Frama-C</name></author></entry><entry><source><updated>2020-12-08T13:30:00-00:00</updated><subtitle type="text">on building functional operating systems</subtitle><rights type="text">All rights reserved by the author</rights><link type="text/html" href="https://mirage.io/blog/" rel="alternate"/><link href="https://mirage.io/blog/atom.xml" rel="self"/><contributor><email>hm519@cam.ac.uk</email><uri>https://github.com/hannesm</uri><name>Hannes Mehnert</name></contributor><contributor><email>martin@lucina.net</email><uri>https://lucina.net/</uri><name>Martin Lucina</name></contributor><contributor><uri>https://www.lemonde.fr/signataires/damien-leloup/</uri><name>Damien Leloup</name></contributor><contributor><email>anil@recoil.org</email><uri>http://anil.recoil.org</uri><name>Anil Madhavapeddy</name></contributor><contributor><email>talex5@gmail.com</email><uri>http://roscidus.com/blog/</uri><name>Thomas Leonard</name></contributor><contributor><email>mindy.preston@cl.cam.ac.uk</email><uri>https://github.com/yomimono</uri><name>Mindy Preston</name></contributor><contributor><uri>https://linse.me</uri><name>Stefanie Schirmer</name></contributor><contributor><email>thomas@gazagnaire.org</email><uri>http://gazagnaire.org</uri><name>Thomas Gazagnaire</name></contributor><contributor><email>gg417@cl.cam.ac.uk</email><uri>https://github.com/GemmaG</uri><name>Gemma Gordon</name></contributor><contributor><email>drupyog@zoho.com</email><uri>https://github.com/drup</uri><name>Gabriel Radanne</name></contributor><contributor><email>djwillia@us.ibm.com</email><uri>https://github.com/djwillia</uri><name>Dan Williams</name></contributor><contributor><email>haesbaert@haesbaert.org</email><uri>http://www.haesbaert.org/</uri><name>Christiano Haesbaert</name></contributor><contributor><email>amirmc@gmail.com</email><uri>http://amirchaudhry.com</uri><name>Amir Chaudhry</name></contributor><contributor><email>david.mersinjak@cl.cam.ac.uk</email><uri>https://github.com/pqwy</uri><name>David Kaloper</name></contributor><contributor><email>dave@recoil.org</email><uri>http://dave.recoil.org/</uri><name>Dave Scott</name></contributor><contributor><email>jon@recoil.org</email><uri>http://jon.recoil.org</uri><name>Jon Ludlam</name></contributor><contributor><email>jeremy.yallop@cl.cam.ac.uk</email><uri>https://github.com/yallop</uri><name>Jeremy Yallop</name></contributor><contributor><email>mort@cantab.net</email><uri>http://mort.io/</uri><name>Richard Mortier</name></contributor><contributor><email>vb@luminar.eu.org</email><uri>https://github.com/vbmithr</uri><name>Vincent Bernardoff</name></contributor><contributor><email>raphlalou@gmail.com</email><uri>https://github.com/raphael-proust</uri><name>Raphael Proust</name></contributor><id>https://mirage.io/blog/</id><title type="text">The MirageOS Blog</title><author><name>MirageOS</name></author></source><link type="text/html" href="https://mirage.io/blog/announcing-mirage-310-release" rel="alternate"/><content xml:base="https://mirage.io/blog/atom.xml" type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml"><h1 id="MirageOS-3-10-release-IPv6">MirageOS 3.10 release - IPv6</h1>

<p>IPv6 and dual (IPv4 and IPv6) stack support https://github.com/mirage/mirage/pull/1187 https://github.com/mirage/mirage/issues/1190</p>
<p>Since a long time, IPv6 code was around in our TCP/IP stack (thanks to @nojb who developed it in 2014). Some months ago, @hannesm and @MagnusS got excited to use it. After we managed to fix some bugs and add some test cases, and writing more code to setup IPv6-only and dual stacks, we are eager to share this support for MirageOS in a released version. We expect there to be bugs lingering around, but duplicate address detection (neighbour solicitation and advertisements) has been implemented, and (unless &quot;--accept-router-advertisement=false&quot;) router advertisements are decoded and used to configure the IPv6 part of the stack. Configuring a static IPv6 address is also possible (with
&quot;--ipv6=2001::42/64&quot;).</p>
<p>While at it, we unified the boot arguments between the different targets: namely, on Unix (when using the socket stack), you can now pass &quot;--ipv4=127.0.0.1/24&quot; to the same effect as the direct stack: only listen on 127.0.0.1 (the subnet mask is ignored for the Unix socket stack).</p>
<p>A dual stack unikernel has &quot;--ipv4-only=BOOL&quot; and &quot;--ipv6-only=BOOL&quot; parameters, so a unikernel binary could support both Internet Protocol versions, while the operator can decide which protocol version to use. I.e. now there are both development-time (stackv4 vs stackv6 vs stackv4v6) choices, as well as the run-time choice (via boot parameter).</p>
<p>I'm keen to remove the stackv4 &amp; stackv6 in future versions, and always develop with dual stack (leaving it to configuration &amp; startup time to decide whether to enable ipv4 and ipv6).</p>
<p>Please also note that the default IPv4 network configuration no longer uses 10.0.0.1 as default gateway (since there was no way to unset the default gateway https://github.com/mirage/mirage/issues/1147).</p>
<p>For unikernel developers, there are some API changes in the Mirage module</p>
<ul><li>New &quot;v4v6&quot; types for IP protocols and stacks</li><li>The ipv6_config record was adjusted in the same fashion as the ipv4_config type: it is now a record of a network (V6.Prefix.t) and gateway (V6.t option)</li></ul>

<p>Some parts of the Mirage_key module were unified as well:</p>
<ul><li>Arp.ip_address is available (for a dual Ipaddr.t)</li><li>Arg.ipv6_address replaces Arg.ipv6 (for an Ipaddr.V6.t)</li><li>Arg.ipv6 replaces Arg.ipv6_prefix (for a Ipaddr.V6.Prefix.t)</li><li>V6.network and V6.gateway are available, mirroring the V4 submodule</li></ul>

<p>If you're ready to experiment with the dual stack: below is a diff for our basic network example (from mirage-skeleton/device-usage/network) replacing IPv4 with a dual stack, and the tlstunnel unikernel commit
https://github.com/roburio/tlstunnel/commit/2cb3e5aa11fca4b48bb524f3c0dbb754a6c8739b
changed tlstunnel from IPv4 stack to dual stack.</p>
<pre><code>diff --git a/device-usage/network/config.ml b/device-usage/network/config.ml
index c425edb..eabc9d6 100644
--- a/device-usage/network/config.ml
+++ b/device-usage/network/config.ml
@@ -4,9 +4,9 @@ let port =
   let doc = Key.Arg.info ~doc:&quot;The TCP port on which to listen for
incoming connections.&quot; [&quot;port&quot;] in
   Key.(create &quot;port&quot; Arg.(opt int 8080 doc))

-let main = foreign ~keys:[Key.abstract port] &quot;Unikernel.Main&quot; (stackv4
@-&gt; job)
+let main = foreign ~keys:[Key.abstract port] &quot;Unikernel.Main&quot;
(stackv4v6 @-&gt; job)

-let stack = generic_stackv4 default_network
+let stack = generic_stackv4v6 default_network

 let () =
   register &quot;network&quot; [
diff --git a/device-usage/network/unikernel.ml
b/device-usage/network/unikernel.ml
index 5d29111..1bf1228 100644
--- a/device-usage/network/unikernel.ml
+++ b/device-usage/network/unikernel.ml
@@ -1,19 +1,19 @@
 open Lwt.Infix

-module Main (S: Mirage_stack.V4) = struct
+module Main (S: Mirage_stack.V4V6) = struct

   let start s =
     let port = Key_gen.port () in
-    S.listen_tcpv4 s ~port (fun flow -&gt;
-        let dst, dst_port = S.TCPV4.dst flow in
+    S.listen_tcp s ~port (fun flow -&gt;
+        let dst, dst_port = S.TCP.dst flow in
         Logs.info (fun f -&gt; f &quot;new tcp connection from IP %s on port %d&quot;
-                  (Ipaddr.V4.to_string dst) dst_port);
-        S.TCPV4.read flow &gt;&gt;= function
+                  (Ipaddr.to_string dst) dst_port);
+        S.TCP.read flow &gt;&gt;= function
         | Ok `Eof -&gt; Logs.info (fun f -&gt; f &quot;Closing connection!&quot;);
Lwt.return_unit
-        | Error e -&gt; Logs.warn (fun f -&gt; f &quot;Error reading data from
established connection: %a&quot; S.TCPV4.pp_error e); Lwt.return_unit
+        | Error e -&gt; Logs.warn (fun f -&gt; f &quot;Error reading data from
established connection: %a&quot; S.TCP.pp_error e); Lwt.return_unit
         | Ok (`Data b) -&gt;
           Logs.debug (fun f -&gt; f &quot;read: %d bytes:\n%s&quot; (Cstruct.len b)
(Cstruct.to_string b));
-          S.TCPV4.close flow
+          S.TCP.close flow
       );

     S.listen s</code></pre>

<p>Other bug fixes include https://github.com/mirage/mirage/issues/1188 (in https://github.com/mirage/mirage/pull/1201) and adapt to charrua 1.3.0 and arp 2.3.0 changes (https://github.com/mirage/mirage/pull/1199).</p>
</div></content><id>https://mirage.io/blog/announcing-mirage-310-release</id><title type="text">Announcing MirageOS 3.10</title><updated>2020-12-08T13:30:00-00:00</updated><author><email>hm519@cam.ac.uk</email><uri>https://github.com/hannesm</uri><name>Hannes Mehnert</name></author></entry><entry><source><updated>2021-03-03T15:00:00-00:00</updated><link title="ReScript Blog" type="text/html" href="https://rescript-lang.org" rel="related"/><link title="ReScript Blog" type="application/rss+xml" href="https://rescript-lang.org/blog/feed.xml" rel="self"/><id>https://rescript-lang.org</id><title type="text">ReScript Blog</title><author><name>Reason Documentation Blog</name></author></source><link href="%20https://rescript-lang.org/blog/bucklescript-release-8-4%20" rel="alternate"/><content xml:base="https://rescript-lang.org/blog/feed.xml" type="html">
        bsb improvements

        </content><id>%20https://rescript-lang.org/blog/bucklescript-release-8-4%20</id><title type="text"> ReScript 8.4</title><updated>2020-12-07T15:00:00-00:00</updated><author><name>Reason Documentation Blog</name></author></entry><entry><source><updated>2021-02-26T00:00:00-00:00</updated><link title="The Coq Proof Assistant" type="text/html" href="https://coq.inria.fr" rel="related"/><link title="The Coq Proof Assistant" type="application/rss+xml" href="https://coq.inria.fr/rss.xml" rel="self"/><id>https://coq.inria.fr</id><title type="text">The Coq Proof Assistant</title><author><name>Coq</name></author></source><link href="https://coq.inria.fr/news/coq-8-13beta1-is-out.html" rel="alternate"/><content xml:base="https://coq.inria.fr/rss.xml" type="html">

&lt;p&gt;
The Coq development team is proud to announce the immediate availability of
&lt;a href=&quot;https://github.com/coq/coq/releases/tag/V8.13+beta1&quot;&gt;Coq 8.13+beta1&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
Here the &lt;a href=&quot;https://coq.github.io/doc/v8.13/refman/changes.html#version-8-13&quot;&gt;full list of changes&lt;/a&gt;.
&lt;/p&gt;

&lt;p&gt;
We encourage our users to test this beta release, in particular:
&lt;ul&gt;
&lt;li&gt;
 The windows installer is now based on the Coq platform: This
  greatly simplifies its build process and makes it easy to add 
  more packages. At the same time this new installer was only
  tested by two people, so if you use Windows please give us
  feedback on any problem you may encounter.
&lt;/li&gt;

&lt;li&gt;
 The notation system received many fixes and improvements, in
  particular the way notations are selected for printing changed:
  Coq now prefers notations which match a larger part of the term to
  abbreviate, and takes into account the order in which notations are 
  imported in the current scope only in a second instance.
  The new rules were designed together with power users, and tested
  by some of them, but our automatic testing infrastructure for 
  regressions in notation printing is still weak. If your Coq library
  makes heavy use of notations, please give us feedback on any 
  regression.
&lt;/li&gt;
&lt;/ul&gt;
&lt;/p&gt;

&lt;p&gt;
The 8.13.0 release is expected to occur about one month from now.
&lt;/p&gt;


 </content><id>https://coq.inria.fr/news/coq-8-13beta1-is-out.html</id><title type="text">Coq 8.13+beta1 is out</title><updated>2020-12-07T00:00:00-00:00</updated><author><name>Coq</name></author></entry><entry><source><updated>2021-03-29T10:00:00-00:00</updated><logo>https://www.ocamlpro.com/wp-content/uploads/2020/07/cropped-favicon-32x32.png</logo><link title="OCamlPro" type="text/html" href="https://www.ocamlpro.com" rel="related"/><link title="OCamlPro" type="application/rss+xml" href="https://www.ocamlpro.com/feed/" rel="self"/><generator>https://wordpress.org/?v=5.4.4</generator><id>https://www.ocamlpro.com</id><title type="text">OCamlPro</title><author><name>OCamlPro</name></author></source><link href="https://www.ocamlpro.com/2020/12/01/memthol-exploring-program-profiling/" rel="alternate"/><link href="https://www.ocamlpro.com/2020/12/01/memthol-exploring-program-profiling/#respond" rel="related"/><content xml:base="https://www.ocamlpro.com/feed/" type="html">
&lt;p&gt;&lt;em&gt;Memthol&lt;/em&gt; is a visualizer and analyzer for program profiling. It works on memory &lt;em&gt;dumps&lt;/em&gt; containing information about the size and (de)allocation date of part of the allocations performed by some execution of a program.&lt;/p&gt;



&lt;blockquote class=&quot;wp-block-quote&quot;&gt;&lt;p&gt;For information regarding building memthol, features, browser compatibility&amp;#8230; refer to the &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://github.com/OCamlPro/memthol&quot; target=&quot;_blank&quot;&gt;memthol github repository&lt;/a&gt;. &lt;br&gt;&lt;em&gt;Please note that Memthol, as a side project, is a work in progress that remains in beta status for now. &lt;/em&gt;&lt;/p&gt;&lt;/blockquote&gt;



&lt;figure class=&quot;wp-block-image size-large&quot;&gt;&lt;img src=&quot;https://raw.githubusercontent.com/OCamlPro/memthol/master/rsc/example.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;h3&gt;Memthol&amp;#8217;s background&lt;/h3&gt;



&lt;p&gt;The Memthol work was started more than a year ago (we had published a short introductory paper at the &lt;a href=&quot;http://jfla.inria.fr/jfla2020.html&quot;&gt;JFLA2020&lt;/a&gt;). The whole idea was to use the previous work originally achieved on &lt;a href=&quot;https://memprof.typerex.org/&quot;&gt;ocp-memprof&lt;/a&gt;, and look for some extra funding to achieve a usable and industrial version.&lt;br&gt;Then came the excellent &lt;a href=&quot;https://blog.janestreet.com/finding-memory-leaks-with-memtrace/&quot;&gt;memtrace profiler&lt;/a&gt; by Jane Street&amp;#8217;s team (congrats!)&lt;br&gt;&lt;br&gt;Memthol is a self-funded side project, that we think it still is worth giving to the OCaml community. Its approach is valuable, and can be complementary. It is released under the free GPL licence v3.&lt;/p&gt;



&lt;h3&gt;Memthol&amp;#8217;s versatility: supporting memtrace&amp;#8217;s dump format&lt;/h3&gt;



&lt;p&gt;The memtrace format is nicely designed and polished enough to be considered a future standard for other tools.&lt;br&gt;This is why Memthol supports Jane Street&amp;#8217;s &lt;em&gt;dumper&lt;/em&gt; format, instead of our own dumper library&amp;#8217;s.&lt;/p&gt;



&lt;h3&gt;Why choose Rust to implement Memthol?&lt;/h3&gt;



&lt;p&gt;We&amp;#8217;ve been exploring the Rust language for more than a year now.&lt;br&gt;The Memthol work was the opportunity to further explore this state-of-the-art language.&lt;br&gt;&lt;br&gt;&lt;em&gt;We are open to extra funding, to deepen the Memthol work should industrial users be interested.&lt;/em&gt;&lt;br&gt;&lt;/p&gt;



&lt;h3&gt;Memthol&amp;#8217;s How-to&lt;/h3&gt;



&lt;blockquote class=&quot;wp-block-quote&quot;&gt;&lt;p&gt;The following steps are from the &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/&quot; target=&quot;_blank&quot;&gt;Memthol Github howto&lt;/a&gt;.&lt;br&gt;&lt;a href=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/intro.html&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;&lt;strong&gt;1.&lt;/strong&gt; Introduction&lt;/a&gt; &lt;br&gt;&lt;a href=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/basics.html&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;&lt;strong&gt;2.&lt;/strong&gt; Basics&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/charts.html&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;&lt;strong&gt;3.&lt;/strong&gt; Charts&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/global_settings.html&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;&lt;strong&gt;4.&lt;/strong&gt; Global Settings&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/callstack_filters.html&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;&lt;strong&gt;5.&lt;/strong&gt; Callstack Filters&lt;/a&gt;&lt;/p&gt;&lt;cite&gt;https://ocamlpro.github.io/memthol/mini_tutorial/&lt;/cite&gt;&lt;/blockquote&gt;



&lt;h1&gt;Introduction&lt;/h1&gt;



&lt;p&gt;This tutorial deals with the BUI (&lt;strong&gt;B&lt;/strong&gt;rowser &lt;strong&gt;U&lt;/strong&gt;ser &lt;strong&gt;I&lt;/strong&gt;nterface) aspect of the profiling. How the dumps are generated is outside of the scope of this document. Currently, memthol accepts memory dumps produced by &lt;a href=&quot;https://blog.janestreet.com/finding-memory-leaks-with-memtrace&quot;&gt;&lt;em&gt;Memtrace&lt;/em&gt;&lt;/a&gt; (github repository &lt;a href=&quot;https://github.com/janestreet/memtrace&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;here&lt;/a&gt;). A memtrace dump for a program execution is a single &lt;a href=&quot;https://diamon.org/ctf&quot;&gt;&lt;strong&gt;C&lt;/strong&gt;ommon &lt;strong&gt;T&lt;/strong&gt;race &lt;strong&gt;F&lt;/strong&gt;ormat&lt;/a&gt; (CTF) file.&lt;/p&gt;



&lt;p&gt;This tutorial uses CTF files from the memthol repository. All paths mentioned in the examples are from its root.&lt;/p&gt;



&lt;p&gt;Memthol is written in Rust and is composed of&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;a server, written in pure Rust, and&lt;/li&gt;&lt;li&gt;a client, written in Rust and compiled to web assembly.&lt;/li&gt;&lt;/ul&gt;



&lt;p&gt;The server contains the client, which it will serve at some address on some port when launched.&lt;/p&gt;



&lt;h2&gt;Running Memthol&lt;/h2&gt;



&lt;p&gt;Memthol must be given a path to a CTF file generated by memtrace.&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;&amp;gt; ls rsc/dumps/ctf/flamba.ctf
rsc/dumps/ctf/flamba.ctf
&amp;gt; memthol rsc/dumps/ctf/flamba.ctf
|===| Starting
| url: http://localhost:7878
| target: `rsc/dumps/ctf/flamba.ctf`
|===|
&lt;/pre&gt;



&lt;p&gt;&lt;/p&gt;



&lt;h1&gt;Basics&lt;/h1&gt;



&lt;p&gt;Our running example in this section will be &lt;code&gt;rsc/dumps/mini_ae.ctf&lt;/code&gt;:&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;❯ memthol --filter_gen none rsc/dumps/ctf/mini_ae.ctf
|===| Starting
| url: http://localhost:7878
| target: `rsc/dumps/ctf/mini_ae.ctf`
|===|

&lt;/pre&gt;



&lt;p&gt;Notice the odd &lt;code&gt;--filter_gen none&lt;/code&gt; passed to memthol. Ignore it for now, it will be discussed later in this section.&lt;/p&gt;



&lt;p&gt;Once memthol is running, &lt;code&gt;http://localhost:7878/&lt;/code&gt; (here) will lead you to memthol&amp;#8217;s BUI, which should look something like this:&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/basics_pics/default.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;Click on the orange &lt;strong&gt;everything&lt;/strong&gt; tab at the bottom left of the screen.&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/basics_pics/three_parts.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;Memthol&amp;#8217;s interface is split in three parts:&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;the central, main part displays charts. There is only one here, showing the evolution of the program&amp;#8217;s total memory size over time based on the memory dump.&lt;/li&gt;&lt;li&gt;the header gives statistics about the memory dump and handles general settings. There is currently only one, the &lt;em&gt;time window&lt;/em&gt;.&lt;/li&gt;&lt;li&gt;the footer controls your &lt;em&gt;filters&lt;/em&gt; (there is only one here), which we are going to discuss right now.&lt;/li&gt;&lt;/ul&gt;



&lt;h2&gt;Filters&lt;/h2&gt;



&lt;p&gt;&lt;em&gt;Filters&lt;/em&gt; allow to split allocations and display them separately. A filter is essentially a set of allocations. Memthol has two built-in filters. The first one is the &lt;strong&gt;everything&lt;/strong&gt; filter. You cannot really do anything with it except for changing its name and color using the filter settings in the footer.&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/basics_pics/everything_name_color.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;Notice that when a filter is modified, two buttons appear in the top-left part of the footer. The first reverts the changes while the second one saves them. Let&amp;#8217;s save these changes.&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/basics_pics/everything_saved.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;The &lt;strong&gt;everything&lt;/strong&gt; filter always contains all allocations in the memory dump. It cannot be changed besides the cosmetic changes we just did. These changes are reverted in the rest of the section.&lt;/p&gt;



&lt;h2&gt;Custom Filters&lt;/h2&gt;



&lt;p&gt;Let&amp;#8217;s create a new filter using the &lt;code&gt;+&lt;/code&gt; add button in the top-right part of the footer.&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/basics_pics/new_filter.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;Notice that, unlike &lt;strong&gt;everything&lt;/strong&gt;, the settings for our new filter have a &lt;strong&gt;Catch allocation if &amp;#8230;&lt;/strong&gt; (empty) section with a &lt;code&gt;+&lt;/code&gt; add button. Let&amp;#8217;s click on that.&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/basics_pics/new_sub_filter.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;This adds a criterion to our filter. Let&amp;#8217;s modify it so that the our filter catches everything of size greater than zero machine words, rename the filter, and save these changes.&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/basics_pics/new_filter_1.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;The tab for our filter now shows &lt;strong&gt;(3)&lt;/strong&gt; next to its name, indicating that this filter catches 3 allocations, which is all the allocations of the (tiny) dump.&lt;/p&gt;



&lt;p&gt;Now, create a new filter and modify it so that it catches allocations made in file &lt;code&gt;weak.ml&lt;/code&gt;. This requires&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;creating a filter,&lt;/li&gt;&lt;li&gt;adding a criterion to that filter,&lt;/li&gt;&lt;li&gt;switching it from &lt;code&gt;size&lt;/code&gt; to &lt;code&gt;callstack&lt;/code&gt;&lt;/li&gt;&lt;li&gt;removing the trailing &lt;code&gt;**&lt;/code&gt; (anything) by erasing it,&lt;/li&gt;&lt;li&gt;write &lt;code&gt;weak.ml&lt;/code&gt; as the last file that should appear in the callstack.&lt;/li&gt;&lt;/ul&gt;



&lt;p&gt;After saving it, you should get the following.&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/basics_pics/new_filter_2.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;Sadly, this filter does not match anything, although some allocations fit this filter. This is because a &lt;strong&gt;custom filter&lt;/strong&gt; &lt;code&gt;F&lt;/code&gt; &amp;#8220;catches&amp;#8221; an allocation if&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;all of the criteria of &lt;code&gt;F&lt;/code&gt; are true for this allocation, and&lt;/li&gt;&lt;li&gt;the allocation is not caught by any &lt;strong&gt;custom&lt;/strong&gt; filter at the left of &lt;code&gt;F&lt;/code&gt; (note that the &lt;strong&gt;everything&lt;/strong&gt; filter is not a **custom filter).&lt;/li&gt;&lt;/ul&gt;



&lt;p&gt;In other words, all allocations go through the list of custom filters from left to right, and are caught by the first filter such that all of its criteria are true for this allocation. As such, it is similar to switch/case and pattern matching.&lt;/p&gt;



&lt;p&gt;Let&amp;#8217;s move our new filter to the left by clicking the left arrow next to it, and save the change.&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/basics_pics/new_filter_3.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;Nice.&lt;/p&gt;



&lt;p&gt;You can remove a filter by selecting it and clicking the &lt;code&gt;-&lt;/code&gt; remove button in the top-right part of the footer, next to the &lt;code&gt;+&lt;/code&gt; add filter button. This only works for &lt;strong&gt;custom&lt;/strong&gt; filters, you cannot remove built-in filters.&lt;/p&gt;



&lt;p&gt;Now, remove the first filter we created (size ≥ 0), which should give you this:&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/basics_pics/new_filter_4.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;Out of nowhere, we get the second and last built-in filter: &lt;strong&gt;catch-all&lt;/strong&gt;. When some allocations are not caught by any of your filters, they will end up in this filter. &lt;strong&gt;Catch-all&lt;/strong&gt; is not visible when it does not catch any allocation, which is why it was (mostly) not visible until now. The filter we wrote previously where catching all the allocations.&lt;/p&gt;



&lt;blockquote class=&quot;wp-block-quote&quot;&gt;&lt;p&gt;In the switch/case analogy, &lt;strong&gt;catch-all&lt;/strong&gt; is the &lt;code&gt;else&lt;/code&gt;/&lt;code&gt;default&lt;/code&gt; branch. In pattern matching, it would be a trailing wildcard &lt;code&gt;_&lt;/code&gt;.&lt;/p&gt;&lt;/blockquote&gt;



&lt;p&gt;So, &lt;code&gt;weak.ml&lt;/code&gt; only catches one of the three allocations: &lt;strong&gt;catch-all&lt;/strong&gt; appears and indicates it matches the remaining two.&lt;/p&gt;



&lt;blockquote class=&quot;wp-block-quote&quot;&gt;&lt;p&gt;It is also possible to write filter criteria over allocations&amp;#8217; callstacks. This is discussed in the &lt;a href=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/callstack_filters.html&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;Callstack Filters Section&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;



&lt;h2&gt;Filter Generation&lt;/h2&gt;



&lt;p&gt;When we launched this section&amp;#8217;s running example, we passed &lt;code&gt;--filter_gen none&lt;/code&gt; to memthol. This is because, by default, memthol will run &lt;em&gt;automatic filter generation&lt;/em&gt; which scans allocations and generates filters. The default (and currently only) one creates one filter per allocation-site file.&lt;/p&gt;



&lt;blockquote class=&quot;wp-block-quote&quot;&gt;&lt;p&gt;For more details, in particular filter generation customization, run &lt;code&gt;memthol --filter_gen help&lt;/code&gt;.&lt;/p&gt;&lt;/blockquote&gt;



&lt;p&gt;If we relaunch the example without &lt;code&gt;--filter_gen none&lt;/code&gt;&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;&lt;/pre&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;❯ memthol rsc/dumps/ctf/mini_ae.ctf
|===| Starting
| url: http://localhost:7878
| target: `rsc/dumps/ctf/mini_ae.ctf`
|===|

&lt;/pre&gt;



&lt;p&gt;we get something like this (actual colors may vary):&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/basics_pics/filter_gen.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;h1&gt;Charts&lt;/h1&gt;



&lt;p&gt;This section uses the same running example as the last section.&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;&lt;/pre&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;❯ memthol rsc/dumps/ctf/mini_ae.ctf
|===| Starting
| url: http://localhost:7878
| target: `rsc/dumps/ctf/mini_ae.ctf`
|===|

&lt;/pre&gt;



&lt;h2&gt;Filter Toggling&lt;/h2&gt;



&lt;p&gt;The first way to interact with a chart is to (de)activate filters. Each chart has its own filter tabs allowing to toggle filters on/off.&lt;/p&gt;



&lt;p&gt;From the initial settings&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/charts_pics/init.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;click on all filters but &lt;strong&gt;everything&lt;/strong&gt; to toggle them off.&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/charts_pics/only_everything.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;Let&amp;#8217;s create a new chart. The only kind of chart that can be constructed currently is total size over time, so click on &lt;strong&gt;create chart&lt;/strong&gt; below our current, lone chart.&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/charts_pics/two_charts_1.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;Deactivate &lt;strong&gt;everything&lt;/strong&gt; in the second chart.&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/charts_pics/two_charts_2.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;Nice. We now have the overall total size over time in the first chart, and the details for each filter in the second one.&lt;/p&gt;



&lt;p&gt;Next, notice that both charts have, on the left of their title, a down (first chart) and up (second chart) arrow. This moves the charts up and down.&lt;/p&gt;



&lt;p&gt;On the right of the title, we have a settings &lt;code&gt;...&lt;/code&gt; buttons which is discussed &lt;a href=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/charts.html#chart-settings&quot;&gt;below&lt;/a&gt;. The next button collapses the chart. If we click on the &lt;em&gt;collapse&lt;/em&gt; button of the first chart, it collapses and the button turns into an &lt;em&gt;expand&lt;/em&gt; button.&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/charts_pics/collapsed.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;The last button in the chart header removes the chart.&lt;/p&gt;



&lt;h2&gt;Chart Settings&lt;/h2&gt;



&lt;p&gt;Clicking the settings &lt;code&gt;...&lt;/code&gt; button in the header of any chart display its settings. (Clicking on the button again hides them.)&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/charts_pics/settings_1.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;Currently, these chart settings only allow to rename the chart and change its &lt;strong&gt;display mode&lt;/strong&gt;.&lt;/p&gt;



&lt;h3&gt;Display Mode&lt;/h3&gt;



&lt;p&gt;In memthol, a chart can be displayed in one of three ways:&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;normal, the one we used so far,&lt;/li&gt;&lt;li&gt;stacked area, where the values of each filter are displayed on top of each other, and&lt;/li&gt;&lt;li&gt;stacked area percent, same as stacked area but values are displayed as percents of the total.&lt;/li&gt;&lt;/ul&gt;



&lt;p&gt;Here is the second chart from our example displayed as stacked area for instance:&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/charts_pics/settings_stacked.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;h1&gt;Global Settings&lt;/h1&gt;



&lt;p&gt;This section uses the same running example as the last section.&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;&lt;/pre&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;❯ memthol rsc/dumps/ctf/mini_ae.ctf
|===| Starting
| url: http://localhost:7878
| target: `rsc/dumps/ctf/mini_ae.ctf`
|===|

&lt;/pre&gt;



&lt;p&gt;There is currently only one global setting: the &lt;em&gt;time window&lt;/em&gt;.&lt;/p&gt;



&lt;h2&gt;Time Window&lt;/h2&gt;



&lt;p&gt;The &lt;em&gt;time window&lt;/em&gt; global setting controls the time interval displayed by all the charts.&lt;/p&gt;



&lt;p&gt;In our example,&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/global_settings_pics/init.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;not much is happening before (roughly) &lt;code&gt;0.065&lt;/code&gt; seconds. Let&amp;#8217;s have the time window start at that point:&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/global_settings_pics/time_window_1.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;Similar to filter edition, we can apply or cancel this change using the two buttons that appeared in the bottom-left corner of the header.&lt;/p&gt;



&lt;p&gt;Saving these changes yields&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/global_settings_pics/time_window_2.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;p&gt;Here is the same chart but with the time window upper-bound set at &lt;code&gt;0.074&lt;/code&gt;.&lt;/p&gt;



&lt;figure class=&quot;wp-block-image&quot;&gt;&lt;img src=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/global_settings_pics/time_window_3.png&quot; alt=&quot;&quot;/&gt;&lt;/figure&gt;



&lt;h1&gt;Callstack Filters&lt;/h1&gt;



&lt;p&gt;Callstack filters are filters operating over allocation properties that are sequences of strings (potentially with some other data). Currently, this means &lt;strong&gt;allocation callstacks&lt;/strong&gt;, where the strings are file names with line/column information.&lt;/p&gt;



&lt;h2&gt;String Filters&lt;/h2&gt;



&lt;p&gt;A string filter can have three shapes: an actual &lt;em&gt;string value&lt;/em&gt;, a &lt;em&gt;regex&lt;/em&gt;, or a &lt;em&gt;match anything&lt;/em&gt; / &lt;em&gt;wildcard&lt;/em&gt; filter represented by the string &lt;code&gt;&quot;...&quot;&lt;/code&gt;. This wildcard filter is discussed in &lt;a href=&quot;https://ocamlpro.github.io/memthol/mini_tutorial/callstack_filters.html#the-wildcard-filter&quot;&gt;its own section&lt;/a&gt; below.&lt;/p&gt;



&lt;p&gt;A string value is simply given as a value. To match precisely the string &lt;code&gt;&quot;file_name&quot;&lt;/code&gt;, one only needs to write &lt;code&gt;file_name&lt;/code&gt;. So, a filter that matches precisely the list of strings &lt;code&gt;[ &quot;file_name_1&quot;, &quot;file_name_2&quot; ]&lt;/code&gt; will be written&lt;/p&gt;



&lt;figure class=&quot;wp-block-table is-style-stripes&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;string list&lt;/td&gt;&lt;td&gt;contains&lt;/td&gt;&lt;td&gt;&lt;code&gt;[ file_name_1 file_name_2 ]&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;figcaption&gt;&lt;br&gt;&lt;/figcaption&gt;&lt;/figure&gt;



&lt;p&gt;A &lt;em&gt;regex&lt;/em&gt; on the other hand has to be written between &lt;code&gt;#&quot;&lt;/code&gt; and &lt;code&gt;&quot;#&lt;/code&gt;. If we want the same filter as above, but want to relax the first string description to be &lt;code&gt;file_name_&amp;lt;i&amp;gt;&lt;/code&gt; where &lt;code&gt;&amp;lt;i&amp;gt;&lt;/code&gt; is a single digit, we write the filter as&lt;/p&gt;



&lt;figure class=&quot;wp-block-table is-style-stripes&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;string list&lt;/td&gt;&lt;td&gt;contains&lt;/td&gt;&lt;td&gt;&lt;code&gt;[ #&quot;file_name_[0-9]&quot;# file_name_2 ]&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h2&gt;The Wildcard Filter&lt;/h2&gt;



&lt;p&gt;The wildcard filter, written &lt;code&gt;...&lt;/code&gt;, &lt;strong&gt;lazily&lt;/strong&gt; (in general, see below) matches a repetition of any string-like element of the list. To break this definition down, let us separate two cases: the first one is when &lt;code&gt;...&lt;/code&gt; is not followed by another string-like filter, and second one is when it is followed by another filter.&lt;/p&gt;



&lt;p&gt;In the first case, &lt;code&gt;...&lt;/code&gt; simply matches everything. Consider for instance the filter&lt;/p&gt;



&lt;figure class=&quot;wp-block-table is-style-stripes&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;string list&lt;/td&gt;&lt;td&gt;contain&lt;/td&gt;&lt;td&gt;&lt;code&gt;[ #&quot;file_name_[0-9]&quot;# ... ]&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;This filter matches any list of strings that starts with a string accepted by the first regex filter. The following lists of strings are all accepted by the filter above.&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;&lt;code&gt;[ file_name_0 ]&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;[ file_name_7 anything at all ]&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;[ file_name_3 file_name_7 ]&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;



&lt;p&gt;Now, there is one case when &lt;code&gt;...&lt;/code&gt; is not actually lazy: when the &lt;code&gt;n&lt;/code&gt; string-filters &lt;em&gt;after&lt;/em&gt; it are not &lt;code&gt;...&lt;/code&gt;. In this case, all elements of the list but the &lt;code&gt;n&lt;/code&gt; last ones will be skipped, leaving them for the &lt;code&gt;n&lt;/code&gt; last string filters.&lt;/p&gt;



&lt;p&gt;For this reason&lt;/p&gt;



&lt;figure class=&quot;wp-block-table is-style-stripes&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;string list&lt;/td&gt;&lt;td&gt;contain&lt;/td&gt;&lt;td&gt;&lt;code&gt;[ … #&quot;file_name_[0-9]&quot;# ]&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;does work as expected. For example, on the string list&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;&lt;/pre&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;[ &quot;some_file_name&quot; &quot;file_name_7&quot; &quot;another_file_name&quot; &quot;file_name_0&quot; ]
&lt;/pre&gt;



&lt;p&gt;a lazy behavior would not match. First, &lt;code&gt;...&lt;/code&gt; would match anything up to and excluding a string recognized by &lt;code&gt;#&quot;file_name_[0-9]&quot;#&lt;/code&gt;. So &lt;code&gt;...&lt;/code&gt; would match &lt;code&gt;some_file_name&lt;/code&gt;, but that&amp;#8217;s it since &lt;code&gt;file_name_7&lt;/code&gt; is a match for &lt;code&gt;#&quot;file_name_[0-9]&quot;#&lt;/code&gt;. Hence the filter would reject this list of strings, because there should be nothing left after the match for &lt;code&gt;#&quot;file_name_[0-9]&quot;#&lt;/code&gt;. But there are still &lt;code&gt;another_file_name&lt;/code&gt; and &lt;code&gt;file_name_0&lt;/code&gt; left.&lt;/p&gt;



&lt;p&gt;Instead, the filter works as expected. &lt;code&gt;...&lt;/code&gt; discards all elements but the last one &lt;code&gt;file_name_0&lt;/code&gt;, which is accepted by &lt;code&gt;#&quot;file_name_[0-9]&quot;#&lt;/code&gt;.&lt;/p&gt;



&lt;h2&gt;Callstack (Location) Filters&lt;/h2&gt;



&lt;p&gt;Allocation callstack information is a list of tuples containing:&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;the name of the file,&lt;/li&gt;&lt;li&gt;the line in the file,&lt;/li&gt;&lt;li&gt;a column range.&lt;/li&gt;&lt;/ul&gt;



&lt;p&gt;Currently, the range information is ignored. The line in the file is not, and one can specify a line constraint while writing a callstack filter. The &lt;em&gt;normal&lt;/em&gt; syntax is&lt;/p&gt;



&lt;p&gt;&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;&amp;lt;string-filter&amp;gt;:&amp;lt;line-filter&amp;gt;&lt;/pre&gt;



&lt;p&gt;Now, a line filter has two basic shapes&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;&lt;code&gt;_&lt;/code&gt;: anything,&lt;/li&gt;&lt;li&gt;&lt;code&gt;&amp;lt;number&amp;gt;&lt;/code&gt;: an actual value.&lt;/li&gt;&lt;/ul&gt;



&lt;p&gt;It can also be a range:&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;&lt;code&gt;[&amp;lt;basic-line-filter&amp;gt;, &amp;lt;basic-line-filter&amp;gt;]&lt;/code&gt;: a potentially open range.&lt;/li&gt;&lt;/ul&gt;



&lt;h3&gt;Line Filter Examples&lt;/h3&gt;



&lt;figure class=&quot;wp-block-table is-style-stripes&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;_&lt;/code&gt;&lt;/td&gt;&lt;td&gt;matches any line at all&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;7&lt;/code&gt;&lt;/td&gt;&lt;td&gt;matches line 7&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;[50, 102]&lt;/code&gt;&lt;/td&gt;&lt;td&gt;matches any line between &lt;code&gt;50&lt;/code&gt; and &lt;code&gt;102&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;[50, _]&lt;/code&gt;&lt;/td&gt;&lt;td&gt;matches any line greater than &lt;code&gt;50&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;[_, 102]&lt;/code&gt;&lt;/td&gt;&lt;td&gt;matches any line less than &lt;code&gt;102&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;[_, _]&lt;/code&gt;&lt;/td&gt;&lt;td&gt;same as &lt;code&gt;_&lt;/code&gt; (matches any line)&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3&gt;Callstack Filter Examples&lt;/h3&gt;



&lt;p&gt;Whitespaces are inserted for readability but are not needed:&lt;/p&gt;



&lt;figure class=&quot;wp-block-table is-style-stripes&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;src/main.ml : _&lt;/code&gt;&lt;/td&gt;&lt;td&gt;matches any line of &lt;code&gt;src/main.ml&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;code&gt;#&quot;.*/main.ml&quot;# : 107&lt;/code&gt;&lt;/td&gt;&lt;td&gt;matches line 107 of any &lt;code&gt;main.ml&lt;/code&gt; file regardless of its path&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;blockquote class=&quot;wp-block-quote&quot;&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;About OCamlPro:&lt;/strong&gt;&lt;br&gt;OCamlPro is a company founded in 2011, with the mission to help industrial users benefit from state-of-the art programming languages like OCaml and Rust. We design, create and implement custom ad-hoc software for our clients. We also have a long experience in developing and maintaining open-source tooling for OCaml, such as Opam, &lt;a href=&quot;http://try.ocamlpro.com&quot;&gt;TryOCaml&lt;/a&gt;, ocp-indent, ocp-index, and ocp-browser, and we contribute to the core-development of OCaml, notably with our work on the Flambda optimizer branch. Another area of expertise is that of Formal Methods, with tools such as our SMT Solver Alt-Ergo (check our &lt;a href=&quot;https://alt-ergo.ocamlpro.com/#club&quot;&gt;Alt-Ergo Users&amp;#8217; Club&lt;/a&gt;). We also provide vocational trainings in OCaml and Rust, and we can build courses on formal methods on-demand. Do not hesitate to reach out by email: &lt;a href=&quot;mailto:contact@ocamlpro.com&quot;&gt;contact@ocamlpro.com&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;



&lt;p&gt;.&lt;/p&gt;
</content><category term="Memory profiler"/><id>https://www.ocamlpro.com/?p=4256</id><title type="text">Memthol: exploring program profiling</title><updated>2020-12-01T13:00:19-00:00</updated><author><name>OCamlPro</name></author></entry><entry><source><updated>2020-12-01T00:00:00-00:00</updated><link title="Jane Street Tech Blog" type="text/html" href="https://blog.janestreet.com" rel="related"/><link title="Jane Street Tech Blog" type="application/rss+xml" href="https://blog.janestreet.com/feed.xml" rel="self"/><id>https://blog.janestreet.com</id><title type="text">Jane Street Tech Blog</title><author><name>Jane Street</name></author></source><link href="https://blog.janestreet.com/growing-the-hardcaml-toolset-index/" rel="alternate"/><content xml:base="https://blog.janestreet.com/feed.xml" type="html">&lt;p&gt;I am pleased to announce that we have recently released a slew of new
Hardcaml libraries!&lt;/p&gt;

</content><id>https://blog.janestreet.com/growing-the-hardcaml-toolset-index/</id><title type="text">Growing the Hardcaml toolset</title><updated>2020-12-01T00:00:00-00:00</updated><author><name>Jane Street</name></author></entry><entry><source><updated>2021-03-03T15:00:00-00:00</updated><link title="ReScript Blog" type="text/html" href="https://rescript-lang.org" rel="related"/><link title="ReScript Blog" type="application/rss+xml" href="https://rescript-lang.org/blog/feed.xml" rel="self"/><id>https://rescript-lang.org</id><title type="text">ReScript Blog</title><author><name>Reason Documentation Blog</name></author></source><link href="%20https://rescript-lang.org/blog/editor-support-release-1-0%20" rel="alternate"/><content xml:base="https://rescript-lang.org/blog/feed.xml" type="html">
        Type hints, jump to definition, error diagnostics, and more.

        </content><id>%20https://rescript-lang.org/blog/editor-support-release-1-0%20</id><title type="text"> Editor Plugin for VSCode and Vim Officially Released!</title><updated>2020-11-26T15:00:00-00:00</updated><author><name>Reason Documentation Blog</name></author></entry><entry><source><updated>2020-12-01T00:00:00-00:00</updated><link title="Jane Street Tech Blog" type="text/html" href="https://blog.janestreet.com" rel="related"/><link title="Jane Street Tech Blog" type="application/rss+xml" href="https://blog.janestreet.com/feed.xml" rel="self"/><id>https://blog.janestreet.com</id><title type="text">Jane Street Tech Blog</title><author><name>Jane Street</name></author></source><link href="https://blog.janestreet.com/announcing-our-market-prediction-kaggle-competition-index/" rel="alternate"/><content xml:base="https://blog.janestreet.com/feed.xml" type="html">&lt;p&gt;Jane Street is running a Kaggle contest based on a real problem with
real financial data. If you like ML projects, or think you might,
&lt;a href=&quot;https://www.kaggle.com/c/jane-street-market-prediction&quot; target=&quot;_blank&quot;&gt;head over and check it
out&lt;/a&gt;.
We think it’s a pretty fun one. The prizes are pretty good too, with a
total $100K being paid out.&lt;/p&gt;

</content><id>https://blog.janestreet.com/announcing-our-market-prediction-kaggle-competition-index/</id><title type="text">Announcing Our Market Prediction Kaggle Competition</title><updated>2020-11-24T00:00:00-00:00</updated><author><name>Jane Street</name></author></entry><entry><summary xml:base="http://math.andrej.com/feed.xml" type="html">After a short pause, our next talk in the series will be given by Jamie Vicary, who will present a proof assistant in which the proofs are drawn! Introducing homotopy.io: A proof assistant for geometrical higher category theory Time: Thursday, November 26, 2020 from 15:00 to 16:00 (Central European Time, UTC+1) Location: online at Zoom ID 989 0478 8985 Speaker: Jamie Vicary (University of Cambridge) Proof assistant: homotopy.io Abstract: Weak higher categories can be difficult to work with algebraically, with the weak structure potentially leading to considerable bureaucracy. Conjecturally, every weak infty-category is equivalent to a &quot;semistrict&quot; one, in which unitors and associators are trivial; such a setting might reduce the burden of constructing large proofs. In this talk, I will present the proof assistant homotopy.io, which allows direct construction of composites in a finitely-generated semistrict (infty,infty)-category. The terms of the proof assistant have a geometrical interpretation as string diagrams, and interaction with the proof assistant is entirely geometrical, by clicking and dragging with the mouse, completely unlike more traditional computer algebra systems. I will give an outline of the underlying theoretical foundations, and demonstrate use of the proof assistant to construct some nontrivial homotopies, rendered in 2d and 3d. I will close with some speculations about the possible interaction of such a system with more traditional type-theoretical approaches. (Joint work with Lukas Heidemann, Nick Hu and David Reutter.) References: David Reutter, Jamie Vicary: High-level methods for homotopy construction in associative n-categories, arXiv:1902.03831 preprint, February 2019. homotopy.io at Lab</summary><source><updated>2021-02-24T17:51:19-00:00</updated><subtitle type="text">A blog about mathematics for computers</subtitle><link type="text/html" href="http://math.andrej.com/" rel="alternate"/><link type="application/atom+xml" href="http://math.andrej.com/feed.xml" rel="self"/><generator uri="https://jekyllrb.com/" version="4.2.0">Jekyll</generator><id>http://math.andrej.com/feed.xml</id><title xml:base="http://math.andrej.com/feed.xml" type="html">Mathematics and Computation</title><author><name>Andrej Bauer</name></author></source><published>2020-11-23T23:00:00-00:00</published><link title="Every proof assistant: introducing homotopy.io – a proof assistant for geometrical higher category theory" type="text/html" href="http://math.andrej.com/2020/11/24/homotopy-io/" rel="alternate"/><content xml:base="http://math.andrej.com/feed.xml" type="html">&lt;p&gt;After a short pause, our next talk in the series will be given by Jamie Vicary, who will
present a proof assistant in which the proofs are drawn!&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h5 id=&quot;introducing-homotopyio-a-proof-assistant-for-geometrical-higher-category-theory&quot;&gt;Introducing homotopy.io: A proof assistant for geometrical higher category theory&lt;/h5&gt;

  &lt;p&gt;&lt;strong&gt;Time:&lt;/strong&gt; Thursday, November 26, 2020 from 15:00 to 16:00 (Central European Time, UTC+1)&lt;br /&gt;
&lt;strong&gt;Location:&lt;/strong&gt; online at &lt;a href=&quot;https://zoom.us/j/98904788985&quot;&gt;Zoom ID 989 0478 8985&lt;/a&gt;&lt;br /&gt;
&lt;strong&gt;Speaker:&lt;/strong&gt; &lt;a href=&quot;https://www.cl.cam.ac.uk/~jv258/&quot;&gt;Jamie Vicary&lt;/a&gt; (University of Cambridge)&lt;br /&gt;
&lt;strong&gt;Proof assistant:&lt;/strong&gt; &lt;a href=&quot;https://homotopy.io/&quot;&gt;homotopy.io&lt;/a&gt;&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;Abstract:&lt;/strong&gt;&lt;/p&gt;

  &lt;p&gt;Weak higher categories can be difficult to work with algebraically,
with the weak structure potentially leading to considerable bureaucracy.
Conjecturally, every weak infty-category is equivalent to a
&quot;semistrict&quot; one, in which unitors and associators are trivial; such a
setting might reduce the burden of constructing large
proofs. In this talk, I will present the proof assistant &lt;a href=&quot;https://homotopy.io/&quot;&gt;homotopy.io&lt;/a&gt;,
which allows direct construction of composites in a finitely-generated
semistrict (infty,infty)-category. The terms of the proof assistant
have a geometrical interpretation as string diagrams, and interaction
with the proof assistant is entirely geometrical, by clicking and
dragging with the mouse, completely unlike more traditional computer
algebra systems. I will give an outline of the underlying theoretical
foundations, and demonstrate use of the proof assistant to construct
some nontrivial homotopies, rendered in 2d and 3d. I will close with
some speculations about the possible interaction of such a system with
more traditional type-theoretical approaches. (Joint work with Lukas
Heidemann, Nick Hu and David Reutter.)&lt;/p&gt;

  &lt;p&gt;References:&lt;/p&gt;

  &lt;ul&gt;
    &lt;li&gt;David Reutter, Jamie Vicary: &lt;em&gt;High-level methods for homotopy construction in
associative n-categories&lt;/em&gt;, &lt;a href=&quot;https://arxiv.org/abs/1902.03831&quot;&gt;arXiv:1902.03831&lt;/a&gt;
preprint, February 2019.&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;https://ncatlab.org/nlab/show/homotopy.io&quot;&gt;homotopy.io at Lab&lt;/a&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;</content><category term="Every proof assistant"/><category term="Talks"/><id>http://math.andrej.com/2020/11/24/homotopy-io</id><title xml:base="http://math.andrej.com/feed.xml" type="html">Every proof assistant: introducing homotopy.io – a proof assistant for geometrical higher category theory</title><updated>2020-11-23T23:00:00-00:00</updated><author><name>Andrej Bauer</name></author></entry><entry><source><updated>2021-03-26T13:00:42-00:00</updated><link title="Seb's blog /b/" type="text/html" href="https://seb.mondet.org/b/" rel="related"/><link title="Seb's blog /b/" type="application/rss+xml" href="https://seb.mondet.org/b/OCaml.rss" rel="self"/><id>https://seb.mondet.org/b/</id><title type="text">Seb's blog /b/</title><author><name>Sebastien Mondet</name></author></source><link href="https://seb.mondet.org/b/0009-dune-universe-hack.html" rel="alternate"/><content xml:base="https://seb.mondet.org/b/OCaml.rss" type="html">
    Quick hack to make “at most every n seconds” dune targets.
   </content><id>https://seb.mondet.org/b/0009-dune-universe-hack.html</id><title type="text">“Universal” Dune Tip: Rebuild Stuff, Sometimes</title><updated>2020-11-21T13:00:42-00:00</updated><author><name>Sebastien Mondet</name></author></entry><entry><source><updated>2021-03-08T00:00:00-00:00</updated><link title="Frama-C RSS News" type="text/html" href="https://frama-c.com" rel="related"/><link title="Frama-C RSS News" type="application/rss+xml" href="http://frama-c.com/rss.xml" rel="self"/><id>https://frama-c.com</id><title type="text">Frama-C RSS News</title><author><name>Frama-C</name></author></source><link href="https://frama-c.com/fc-versions/titanium.html" rel="alternate"/><id>https://frama-c.com/fc-versions/titanium.html#433327abdc1f8041a4fa02c4e2e2e7dd</id><title type="text">Release of Frama-C 22.0 (Titanium)</title><updated>2020-11-20T00:00:00-00:00</updated><author><name>Frama-C</name></author></entry><entry><source><updated>2021-03-03T15:00:00-00:00</updated><link title="ReScript Blog" type="text/html" href="https://rescript-lang.org" rel="related"/><link title="ReScript Blog" type="application/rss+xml" href="https://rescript-lang.org/blog/feed.xml" rel="self"/><id>https://rescript-lang.org</id><title type="text">ReScript Blog</title><author><name>Reason Documentation Blog</name></author></source><link href="%20https://rescript-lang.org/blog/editor-support-custom-operators-and-more%20" rel="alternate"/><content xml:base="https://rescript-lang.org/blog/feed.xml" type="html">
        Update on what we're doing around the end of 2020 and early next year.

        </content><id>%20https://rescript-lang.org/blog/editor-support-custom-operators-and-more%20</id><title type="text"> Editor Support, Custom Operators and More</title><updated>2020-11-17T15:00:00-00:00</updated><author><name>Reason Documentation Blog</name></author></entry><entry><source><updated>2021-02-26T00:00:00-00:00</updated><link title="The Coq Proof Assistant" type="text/html" href="https://coq.inria.fr" rel="related"/><link title="The Coq Proof Assistant" type="application/rss+xml" href="https://coq.inria.fr/rss.xml" rel="self"/><id>https://coq.inria.fr</id><title type="text">The Coq Proof Assistant</title><author><name>Coq</name></author></source><link href="https://coq.inria.fr/news/coq-8-12-1-is-out.html" rel="alternate"/><content xml:base="https://coq.inria.fr/rss.xml" type="html">

&lt;p&gt;We are happy to announce the &lt;a
href=&quot;https://github.com/coq/coq/releases/tag/V8.12.1&quot;&gt;release of Coq
8.12.1&lt;/a&gt;.

&lt;p&gt;This release contains numerous bug fixes and documentation improvements. Some bug fix highlights:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Polymorphic side-effects inside monomorphic definitions were incorrectly handled as not inlined. This allowed deriving an inconsistency.
&lt;li&gt;Regression in error reporting after SSReflect's &lt;code&gt;case&lt;/code&gt; tactic. A generic error message &quot;Could not fill dependent hole in apply&quot; was reported for any error following &lt;code&gt;case&lt;/code&gt; or &lt;code&gt;elim&lt;/code&gt;.
&lt;li&gt;Several bugs with &lt;code&gt;Search&lt;/code&gt;.
&lt;li&gt;The &lt;code&gt;details&lt;/code&gt; environment introduced in coqdoc in Coq 8.12 can now be used as advertised in the reference manual.
&lt;li&gt;View menu &quot;Display parentheses&quot; introduced in CoqIDE in Coq 8.12 now works correctly.
&lt;/ul&gt;
&lt;p&gt;See the &lt;a href=&quot;https://coq.inria.fr/refman/changes.html#changes-in-8-12-1&quot;&gt;changelog&lt;/a&gt; for details and a more complete list.&lt;/p&gt;


 </content><id>https://coq.inria.fr/news/coq-8-12-1-is-out.html</id><title type="text">Coq 8.12.1 is out</title><updated>2020-11-16T00:00:00-00:00</updated><author><name>Coq</name></author></entry><entry><source><updated>2021-03-08T00:00:00-00:00</updated><link title="Frama-C RSS News" type="text/html" href="https://frama-c.com" rel="related"/><link title="Frama-C RSS News" type="application/rss+xml" href="http://frama-c.com/rss.xml" rel="self"/><id>https://frama-c.com</id><title type="text">Frama-C RSS News</title><author><name>Frama-C</name></author></source><link href="https://frama-c.com/fc-versions/titanium.html" rel="alternate"/><id>https://frama-c.com/fc-versions/titanium.html#cc473ef2e8c43d369ff2315bc1ad06ce</id><title type="text">Beta release of Frama-C 22.0-beta (Titanium)</title><updated>2020-10-28T00:00:00-00:00</updated><author><name>Frama-C</name></author></entry><entry><source><updated>2020-12-08T13:30:00-00:00</updated><subtitle type="text">on building functional operating systems</subtitle><rights type="text">All rights reserved by the author</rights><link type="text/html" href="https://mirage.io/blog/" rel="alternate"/><link href="https://mirage.io/blog/atom.xml" rel="self"/><contributor><email>hm519@cam.ac.uk</email><uri>https://github.com/hannesm</uri><name>Hannes Mehnert</name></contributor><contributor><email>martin@lucina.net</email><uri>https://lucina.net/</uri><name>Martin Lucina</name></contributor><contributor><uri>https://www.lemonde.fr/signataires/damien-leloup/</uri><name>Damien Leloup</name></contributor><contributor><email>anil@recoil.org</email><uri>http://anil.recoil.org</uri><name>Anil Madhavapeddy</name></contributor><contributor><email>talex5@gmail.com</email><uri>http://roscidus.com/blog/</uri><name>Thomas Leonard</name></contributor><contributor><email>mindy.preston@cl.cam.ac.uk</email><uri>https://github.com/yomimono</uri><name>Mindy Preston</name></contributor><contributor><uri>https://linse.me</uri><name>Stefanie Schirmer</name></contributor><contributor><email>thomas@gazagnaire.org</email><uri>http://gazagnaire.org</uri><name>Thomas Gazagnaire</name></contributor><contributor><email>gg417@cl.cam.ac.uk</email><uri>https://github.com/GemmaG</uri><name>Gemma Gordon</name></contributor><contributor><email>drupyog@zoho.com</email><uri>https://github.com/drup</uri><name>Gabriel Radanne</name></contributor><contributor><email>djwillia@us.ibm.com</email><uri>https://github.com/djwillia</uri><name>Dan Williams</name></contributor><contributor><email>haesbaert@haesbaert.org</email><uri>http://www.haesbaert.org/</uri><name>Christiano Haesbaert</name></contributor><contributor><email>amirmc@gmail.com</email><uri>http://amirchaudhry.com</uri><name>Amir Chaudhry</name></contributor><contributor><email>david.mersinjak@cl.cam.ac.uk</email><uri>https://github.com/pqwy</uri><name>David Kaloper</name></contributor><contributor><email>dave@recoil.org</email><uri>http://dave.recoil.org/</uri><name>Dave Scott</name></contributor><contributor><email>jon@recoil.org</email><uri>http://jon.recoil.org</uri><name>Jon Ludlam</name></contributor><contributor><email>jeremy.yallop@cl.cam.ac.uk</email><uri>https://github.com/yallop</uri><name>Jeremy Yallop</name></contributor><contributor><email>mort@cantab.net</email><uri>http://mort.io/</uri><name>Richard Mortier</name></contributor><contributor><email>vb@luminar.eu.org</email><uri>https://github.com/vbmithr</uri><name>Vincent Bernardoff</name></contributor><contributor><email>raphlalou@gmail.com</email><uri>https://github.com/raphael-proust</uri><name>Raphael Proust</name></contributor><id>https://mirage.io/blog/</id><title type="text">The MirageOS Blog</title><author><name>MirageOS</name></author></source><link type="text/html" href="https://mirage.io/blog/announcing-mirage-39-release" rel="alternate"/><content xml:base="https://mirage.io/blog/atom.xml" type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml"><h1 id="MirageOS-3-9-0-release">MirageOS 3.9.0 release</h1>

<p>We are pleased to announce the release of MirageOS 3.9.0.</p>
<p>Our last release announcement was for <a href="https://mirage.io/blog/announcing-mirage-36-release">MirageOS 3.6.0</a>, so we will also cover changes since 3.7.x and 3.8.x in this announcement.</p>
<p>New features:</p>
<ul><li>The Xen backend has been <a href="https://github.com/mirage/mirage/issues/1159">re-written from scratch</a> to be based on Solo5, and now supports PVHv2 on Xen 4.10 or higher, and QubesOS 4.0.</li><li>As part of this re-write, the existing Mini-OS based implementation has been retired, and all non-UNIX backends now use a unified OCaml runtime based on <code>ocaml-freestanding</code>.</li><li>OCaml runtime settings settable via the <code>OCAMLRUNPARAM</code> environment variable are now exposed as unikernel boot parameters. For details, refer to <a href="https://github.com/mirage/mirage/pull/1180">#1180</a>.</li></ul>

<p>Security posture improvements:</p>
<ul><li>With the move to a unified Solo5 and ocaml-freestanding base MirageOS unikernels on Xen gain several notable improvements to their overall security posture such as SSP for all C code, W^X, and malloc heap canaries. For details, refer to the mirage-xen 6.0.0 release <a href="https://github.com/mirage/mirage-xen/releases/tag/v6.0.0">announcement</a>.</li></ul>

<p>API breaking changes:</p>
<ul><li>Several Xen-specific APIs have been removed or replaced, unikernels using these may need to be updated. For details, refer to the mirage-xen 6.0.0 release <a href="https://github.com/mirage/mirage-xen/releases/tag/v6.0.0">announcement</a>.</li></ul>

<p>Other notable changes:</p>
<ul><li><code>Mirage_runtime</code> provides event loop enter and exit hook registration (<a href="https://github.com/mirage/mirage/pull/1010">#1010</a>).</li><li>All MirageOS backends now behave similarly on a successful exit of the unikernel: they call <code>exit</code> with the return value 0, thus <code>at_exit</code> handlers are now executed (<a href="https://github.com/mirage/mirage/pull/1011">#1011</a>).</li><li>The unix backend used a toplevel exception handler, which has been removed. All backends now behave equally with respect to exceptions.</li><li>Please note that the <code>Mirage_net.listen</code> function still installs an exception handler, which will be removed in a future release. The out of memory exception is no longer caught by <code>Mirage_net.listen</code> (<a href="https://github.com/mirage/mirage/issues/1036">#1036</a>).</li><li>To reduce the number of OPAM packages, the <code>mirage-*-lwt</code> packages are now deprecated. <code>Mirage_net</code> (and others) now use <code>Lwt.t</code> directly, and their <code>buffer</code> type is <code>Cstruct.t</code> (<a href="https://github.com/mirage/mirage/issues/1004">#1004</a>).</li><li>OPAM files generated by <code>mirage configure</code> now include opam build and installation instructions, and also an URL to the Git <code>origin</code> (<a href="https://github.com/mirage/mirage/pull/1022">#1022</a>).</li></ul>

<p>Known issues:</p>
<ul><li><code>mirage configure</code> fails if the unikernel is under version control and no <code>origin</code> remote is present (<a href="https://github.com/mirage/mirage/issues/1188">#1188</a>).</li><li>The Xen backend has issues with event delivery if built with an Alpine Linux GCC toolchain. As a work-around, please use a Fedora or Debian based toolchain.</li></ul>

<p>Acknowledgements:</p>
<ul><li>Thanks to Roger Pau Monné, Andrew Cooper and other core Xen developers for help with understanding the specifics of how Xen PVHv2 works, and how to write an implementation from scratch.</li><li>Thanks to Marek Marczykowski-Górecki for help with the QubesOS specifics, and for forward-porting some missing parts of PVHv2 to QubesOS version of Xen.</li><li>Thanks to @palainp on Github for help with testing on QubesOS.</li></ul></div></content><id>https://mirage.io/blog/announcing-mirage-39-release</id><title type="text">Announcing MirageOS 3.9.0</title><updated>2020-10-27T15:00:00-00:00</updated><author><email>martin@lucina.net</email><uri>https://lucina.net/</uri><name>Martin Lucina</name></author></entry><entry><source><updated>2021-03-26T13:00:42-00:00</updated><link title="Seb's blog /b/" type="text/html" href="https://seb.mondet.org/b/" rel="related"/><link title="Seb's blog /b/" type="application/rss+xml" href="https://seb.mondet.org/b/OCaml.rss" rel="self"/><id>https://seb.mondet.org/b/</id><title type="text">Seb's blog /b/</title><author><name>Sebastien Mondet</name></author></source><link href="https://seb.mondet.org/b/0007-ocaml-2020-making-of.html" rel="alternate"/><content xml:base="https://seb.mondet.org/b/OCaml.rss" type="html">
    A quick experience report …
    Tools used for the paper, the slides, and the video.
   </content><id>https://seb.mondet.org/b/0007-ocaml-2020-making-of.html</id><title type="text">SmartPy@OCaml2020: The Making Of</title><updated>2020-10-26T13:00:42-00:00</updated><author><name>Sebastien Mondet</name></author></entry><entry><summary xml:base="https://erratique.ch/" type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml">First release of <a href="software/qrc">Qrc</a>, a <abbr>QR</abbr> code encoder for OCaml.</div></summary><source><updated>2020-10-22T23:50:55-00:00</updated><rights type="text">Copyright © 2007-2021, Daniel Bünzli</rights><link type="text/html" href="https://erratique.ch/" rel="alternate"/><link href="https://erratique.ch/feeds/news.atom" rel="self"/><icon>https://erratique.ch/images/e-small.png</icon><id>urn:uuid:3a8dc03a-ee18-4144-ab7a-a6bd91e1972a</id><title type="text">Erratique</title><author><name>Daniel Bünzli</name></author></source><link href="https://erratique.ch/software/qrc" rel="alternate"/><category term="erratique-news"/><id>urn:uuid:64e25d2d-a097-5fa3-8505-3c6bfd7b27e7</id><title type="text">Qrc</title><updated>2020-10-22T23:50:55-00:00</updated><author><name>Daniel Bünzli</name></author></entry><entry><summary xml:base="https://erratique.ch/" type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml">First release of <a href="software/brr">Brr</a>, a toolkit for programming browsers in OCaml.</div></summary><source><updated>2020-10-22T23:50:55-00:00</updated><rights type="text">Copyright © 2007-2021, Daniel Bünzli</rights><link type="text/html" href="https://erratique.ch/" rel="alternate"/><link href="https://erratique.ch/feeds/news.atom" rel="self"/><icon>https://erratique.ch/images/e-small.png</icon><id>urn:uuid:3a8dc03a-ee18-4144-ab7a-a6bd91e1972a</id><title type="text">Erratique</title><author><name>Daniel Bünzli</name></author></source><link href="https://erratique.ch/software/brr" rel="alternate"/><category term="erratique-news"/><id>urn:uuid:fdf28515-5df8-576a-9816-d07799302e06</id><title type="text">Brr</title><updated>2020-10-14T08:00:55-00:00</updated><author><name>Daniel Bünzli</name></author></entry><entry><source><updated>2020-12-01T00:00:00-00:00</updated><link title="Jane Street Tech Blog" type="text/html" href="https://blog.janestreet.com" rel="related"/><link title="Jane Street Tech Blog" type="application/rss+xml" href="https://blog.janestreet.com/feed.xml" rel="self"/><id>https://blog.janestreet.com</id><title type="text">Jane Street Tech Blog</title><author><name>Jane Street</name></author></source><link href="https://blog.janestreet.com/finding-memory-leaks-with-memtrace/" rel="alternate"/><content xml:base="https://blog.janestreet.com/feed.xml" type="html">&lt;p&gt;Memory issues can be hard to track down. A function that only
allocates a few small objects can cause a space leak if it’s called
often enough and those objects are never collected. Even then, many
objects are &lt;em&gt;supposed&lt;/em&gt; to be long-lived. How can a tool, armed with data
on allocations and their lifetimes,
help sort out the expected from the suspicious?&lt;/p&gt;

</content><id>https://blog.janestreet.com/finding-memory-leaks-with-memtrace/</id><title type="text">Finding memory leaks with Memtrace</title><updated>2020-10-06T00:00:00-00:00</updated><author><name>Jane Street</name></author></entry><entry><source><updated>2021-03-29T10:00:00-00:00</updated><logo>https://www.ocamlpro.com/wp-content/uploads/2020/07/cropped-favicon-32x32.png</logo><link title="OCamlPro" type="text/html" href="https://www.ocamlpro.com" rel="related"/><link title="OCamlPro" type="application/rss+xml" href="https://www.ocamlpro.com/feed/" rel="self"/><generator>https://wordpress.org/?v=5.4.4</generator><id>https://www.ocamlpro.com</id><title type="text">OCamlPro</title><author><name>OCamlPro</name></author></source><link href="https://www.ocamlpro.com/2020/09/30/rehabilitating-packs-using-functors-and-recursivity-part-2/" rel="alternate"/><link href="https://www.ocamlpro.com/2020/09/30/rehabilitating-packs-using-functors-and-recursivity-part-2/#respond" rel="related"/><content xml:base="https://www.ocamlpro.com/feed/" type="html">
&lt;p&gt;This blog post and the previous one about &lt;a href=&quot;https://www.ocamlpro.com/?p=3947&quot;&gt;functor packs&lt;/a&gt; covers two RFCs currently developed by OCamlPro and Jane Street. We previously introduced functor packs, a new feature adding the possiblity to compile packs as functors, allowing the user to implement functors as multiple source files or even parameterized libraries.&lt;/p&gt;



&lt;p&gt;In this blog post, we will cover the other aspect of the packs rehabilitation: allowing anyone to implement recursive compilation units using packs (as described formally in the &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://github.com/ocaml/RFCs/pull/20&quot; target=&quot;_blank&quot;&gt;RFC#20&lt;/a&gt;). Our previous post introduced briefly how packs were compiled and why we needed some bits of closure conversion to effectively implement big functors. Once again, to implement recursive packs we will need to encode modules through this technique, as such we advise the reader to check at least the introduction and the compilation part of functor packs.&lt;/p&gt;



&lt;h2&gt;Recursive modules through recursive packs&lt;/h2&gt;



&lt;p&gt;Recursive modules are a feature long available in the compiler, but restricted to modules, not compilation units. As such, it is impossible to write two files that depend on each other, except by using scripts that tie up these modules into a single compilation file. Due to the internal representation of recursive modules, it would be difficult to implement recursive (and mutually recursive) compilation units. However, we could use packs to implement these.&lt;/p&gt;



&lt;p&gt;One common example of recursive modules are trees whose nodes are represented by sets. To implement such a data structure with the standard library we need recursive modules: &lt;code&gt;Set&lt;/code&gt; is a functor that takes as parameter a module describing the values embedded in the set, but in our case the type needs the already applied functor.&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;module rec T : sig
  type t =
      Leaf of int
    | Node of TSet.t

  val compare : t -&amp;gt; t -&amp;gt; int
end = struct
  type t =
      Leaf of int
    | Node of TSet.t

  let compare t1 t2 =
    match t1, t2 with
      Leaf v1, Leaf v2 -&amp;gt; Int.compare v1 v2
    | Node s1, Node s2 -&amp;gt; TSet.compare s1 s2
    | Leaf _, Node _ -&amp;gt; -1
    | Node _, Leaf _ -&amp;gt; 1
end

and TSet : Set.S with type elt = T.t = Set.Make(T)&lt;/pre&gt;



&lt;p&gt;With recursive pack, we can simply put &lt;code&gt;T&lt;/code&gt; and &lt;code&gt;TSet&lt;/code&gt; into their respective files (&lt;code&gt;t.ml&lt;/code&gt; and &lt;code&gt;tSet.ml&lt;/code&gt;), and tie them into one module (let&amp;#8217;s name it &lt;code&gt;P&lt;/code&gt;). Signature of recursive modules cannot be infered, as such we also need to define &lt;code&gt;t.mli&lt;/code&gt; and &lt;code&gt;tSet.mli&lt;/code&gt;. Both must be compiled simultaneously since they refer to each other. The result of the compilation is the following:&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;ocamlopt -c -for-pack P -recursive t.mli tSet.mli
ocamlopt -c -for-pack P -pack-is-recursive P t.ml
ocamlopt -c -for-pack P -pack-is-recursive P tSet.ml
ocamlopt -o p.cmx -recursive-pack t.cmx tSet.cmx&lt;/pre&gt;



&lt;p&gt;We have three new compilation options:&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;&lt;code&gt;-recursive&lt;/code&gt; indicates to the compiler to typecheck all the given &lt;code&gt;mli&lt;/code&gt;s simultaneously, as recursive modules.&lt;/li&gt;&lt;li&gt;&lt;code&gt;-pack-is-recursive&lt;/code&gt; indicates which pack(s) in the hierarchy are meant to be recursive. This is necessary since it determines how the module must be compiled (&lt;em&gt;i.e&lt;/em&gt; if we will need to apply closure conversion).&lt;/li&gt;&lt;li&gt;&lt;code&gt;recursive-pack&lt;/code&gt; generates a pack that deals with the initialization of its modules, as for recursive modules.&lt;/li&gt;&lt;/ul&gt;



&lt;h3&gt;Recursives modules compilation&lt;/h3&gt;



&lt;p&gt;One may be wondering why we need packs to compile recursive modules. Let&amp;#8217;s take a look at how they are encoded. We will craft a naive example that is simple enough once compiled:&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;module rec Even : sig
  val test: int -&amp;gt; bool
end = struct
  let test i =
    if i-1 &amp;lt;= 0 then false else Odd.test (i-1)
end

and Odd : sig
  val test: int -&amp;gt; bool
end = struct
  let test i =
    if i-1 &amp;lt;= 0 then true else Even.test (i-1)
end&lt;/pre&gt;



&lt;p&gt;It defines two modules &lt;code&gt;Even&lt;/code&gt; and &lt;code&gt;Odd&lt;/code&gt;, that both test whether an integer is even or odd, and if that is not the case calls the test function from the other module. Not a really interesting use of recursive modules obviously. The compilation schema for recursive modules is the following:&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;First, it allocates empty blocks for each module according to its &lt;strong&gt;shape&lt;/strong&gt; (how many values are bound and what size they need in the block, if the module is a functor and what are its values, etc).&lt;/li&gt;&lt;li&gt;Then these blocks are filled with the implementation.&lt;/li&gt;&lt;/ul&gt;



&lt;p&gt;In our case, in a pseudo-code that is a bit higher order than Lambda (the first intermediate language of ocaml) it would translate as:&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;module Even = &amp;lt;allocation of the shape of even.cmx&amp;gt;
module Odd = &amp;lt;allocation of the shape of odd.cmx&amp;gt;&lt;allocation of=&quot;&quot; the=&quot;&quot; shape=&quot;&quot; even=&quot;&quot;&gt;&lt;allocation of=&quot;&quot; the=&quot;&quot; shape=&quot;&quot; odd=&quot;&quot;&gt;

Even := &amp;lt;struct let test = .. end&amp;gt;&lt;struct test=&quot;..&quot; let=&quot;&quot; end=&quot;&quot;&gt;
Odd := &amp;lt;struct let test = .. end&amp;gt;&lt;struct let=&quot;&quot; test=&quot;..&quot; end=&quot;&quot;&gt;&lt;/struct&gt;&lt;/struct&gt;&lt;/allocation&gt;&lt;/allocation&gt;&lt;/pre&gt;



&lt;p&gt;This ensures that every reference to &lt;code&gt;Even&lt;/code&gt; in &lt;code&gt;Odd&lt;/code&gt; (and vice-versa) are valid pointers. To respect this schema, we will use packs to tie recursive modules together. Without packs, this means we would generate this code when linking the units into an executable which can be tricky. The pack can simply do it as initialization code.&lt;/p&gt;



&lt;h3&gt;Compiling modules for recursive pack&lt;/h3&gt;



&lt;p&gt;If we tried to compile these modules naively, we would end up in the same situation than for the functor pack: the compilation units would refer to identifiers that do not exist at the time they are generated. Moreover, the initialization part needs to know the shape of the compilation unit to be able to allocate precisely the block that will contain the recursive module. In order to implement recursive compilation units into packs, we extends the compilation units in two ways:&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;The shape of the unit is computed and stored in the &lt;code&gt;cmo&lt;/code&gt; (or &lt;code&gt;cmx&lt;/code&gt;).&lt;/li&gt;&lt;li&gt;As for functor pack, we apply closure conversion on the free variables that are modules from the same pack or from packs above in the hierarchy as long as they are recursive.&lt;/li&gt;&lt;/ul&gt;



&lt;p&gt;As an example, we will reuse our &lt;code&gt;Even&lt;/code&gt; / &lt;code&gt;Odd&lt;/code&gt; example above and split it into two units &lt;code&gt;even.ml&lt;/code&gt; and &lt;code&gt;odd.ml&lt;/code&gt;, and compile them into a recursive pack &lt;code&gt;P&lt;/code&gt;. Both have the same shape: a module with a single value. &lt;code&gt;Even&lt;/code&gt; refers to a free variable &lt;code&gt;Odd&lt;/code&gt;, which is in the same recursive pack, and vice-versa. The result of the closure conversion is a function that will take the pointer resulting from the initialization. Since the module is also recursive itself, it takes its own pointer resulting from its initialization. The result will look as something like:&lt;/p&gt;



&lt;div class=&quot;wp-block-group&quot;&gt;&lt;div class=&quot;wp-block-group__inner-container&quot;&gt;
&lt;pre class=&quot;wp-block-preformatted&quot;&gt;(* even.cmx *)
module Even_rec (Even: &amp;lt;even.mli&amp;gt;&lt;even.mli&gt;)(Odd: &amp;lt;odd.mli&amp;gt;&lt;odd.mli&gt;) = ..

(* odd.cmx *)
module Odd_rec (Odd: &amp;lt;odd.mli&amp;gt;&lt;odd.mli&gt;)(Even: &lt;even.mli&gt;&amp;lt;even.mli&amp;gt;) = ..

(* p.cmx *)
module Even = &amp;lt;allocation of the shape of even.cmx&amp;gt;&lt;allocation of=&quot;&quot; the=&quot;&quot; shape=&quot;&quot; even=&quot;&quot;&gt;
module Odd = &amp;lt;allocation of the shape of odd.cmx&amp;gt;&lt;allocation of=&quot;&quot; the=&quot;&quot; shape=&quot;&quot; odd=&quot;&quot;&gt;

Even := Even_rec(Even)(Odd)
Odd := Odd_rec(Odd)(Even)&lt;/allocation&gt;&lt;/allocation&gt;&lt;/even.mli&gt;&lt;/odd.mli&gt;&lt;/odd.mli&gt;&lt;/even.mli&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;h2&gt;Rejunavating packs&lt;/h2&gt;



&lt;p&gt;Under the hood, these new features come with some refactoring in the pack implementation which follows work done for RFC on the &lt;a href=&quot;https://github.com/ocaml/RFCs/pull/13&quot; target=&quot;_blank&quot; rel=&quot;noreferrer noopener&quot;&gt;representation of symbols&lt;/a&gt; in the middle-end of the compiler. Packs were not really used anymore and were deprecated by module aliases, this work makes them relevant again. These RFCs improve the OCaml ecosystem in multiple ways:&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;Compilation units are now on par with modules, since they can be functors.&lt;/li&gt;&lt;li&gt;Functor packs allow developers to implement parameterized libraries, without having to rely on scripts to produce multiple libraries linked with different &lt;em&gt;backends&lt;/em&gt; (for example, Cohttp can use Lwt or Async as backend, and provides two libraries, one for each of these).&lt;/li&gt;&lt;li&gt;Recursive packs allow the implementation of recursive modules into separate files.&lt;/li&gt;&lt;/ul&gt;



&lt;p&gt;We hope that such improvements will benefit the users and library developers. Having a way to implement parameterize libraries without having to describe big functors by hand, or use mutually recursive compilation units without using scripts to generate a unique &lt;code&gt;ml&lt;/code&gt; file will certainly introduce new workflows.&lt;/p&gt;
</content><category term="OCaml"/><id>https://www.ocamlpro.com/?p=3994</id><title type="text">Rehabilitating packs using functors and recursivity, part 2.</title><updated>2020-09-30T11:50:00-00:00</updated><author><name>OCamlPro</name></author></entry><entry><source><updated>2021-03-03T15:00:00-00:00</updated><link title="ReScript Blog" type="text/html" href="https://rescript-lang.org" rel="related"/><link title="ReScript Blog" type="application/rss+xml" href="https://rescript-lang.org/blog/feed.xml" rel="self"/><id>https://rescript-lang.org</id><title type="text">ReScript Blog</title><author><name>Reason Documentation Blog</name></author></source><link href="%20https://rescript-lang.org/blog/release-8-3-pt2%20" rel="alternate"/><id>%20https://rescript-lang.org/blog/release-8-3-pt2%20</id><title type="text"> What's new in ReScript 8.3 (Part 2)</title><updated>2020-09-26T15:00:00-00:00</updated><author><name>Reason Documentation Blog</name></author></entry><entry><source><updated>2021-03-03T15:00:00-00:00</updated><link title="ReScript Blog" type="text/html" href="https://rescript-lang.org" rel="related"/><link title="ReScript Blog" type="application/rss+xml" href="https://rescript-lang.org/blog/feed.xml" rel="self"/><id>https://rescript-lang.org</id><title type="text">ReScript Blog</title><author><name>Reason Documentation Blog</name></author></source><link href="%20https://rescript-lang.org/blog/release-8-3-pt1%20" rel="alternate"/><id>%20https://rescript-lang.org/blog/release-8-3-pt1%20</id><title type="text"> What's new in ReScript 8.3 (Part 1)</title><updated>2020-09-25T15:00:00-00:00</updated><author><name>Reason Documentation Blog</name></author></entry><entry><source><updated>2021-03-29T10:00:00-00:00</updated><logo>https://www.ocamlpro.com/wp-content/uploads/2020/07/cropped-favicon-32x32.png</logo><link title="OCamlPro" type="text/html" href="https://www.ocamlpro.com" rel="related"/><link title="OCamlPro" type="application/rss+xml" href="https://www.ocamlpro.com/feed/" rel="self"/><generator>https://wordpress.org/?v=5.4.4</generator><id>https://www.ocamlpro.com</id><title type="text">OCamlPro</title><author><name>OCamlPro</name></author></source><link href="https://www.ocamlpro.com/2020/09/24/rehabilitating-packs-using-functors-and-recursivity-part-1/" rel="alternate"/><link href="https://www.ocamlpro.com/2020/09/24/rehabilitating-packs-using-functors-and-recursivity-part-1/#comments" rel="related"/><content xml:base="https://www.ocamlpro.com/feed/" type="html">
&lt;p&gt;OCamlPro has a long history of dedicated efforts to support the development of the OCaml compiler, through sponsorship or direct contributions from &lt;em&gt;Flambda Team&lt;/em&gt;. An important one is the Flambda intermediate representation designed for optimizations, and in the future its next iteration Flambda 2. This work is funded by JaneStreet.&lt;/p&gt;



&lt;p&gt;Packs in the OCaml ecosystem are kind of an outdated concept (options &lt;code&gt;-pack&lt;/code&gt; and &lt;code&gt;-for-pack&lt;/code&gt; in the &lt;a href=&quot;https://caml.inria.fr/pub/docs/manual-ocaml/comp.html&quot;&gt;OCaml manual&lt;/a&gt;), and their main utility has been overtaken by the introduction of &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://caml.inria.fr/pub/docs/manual-ocaml/modulealias.html&quot; target=&quot;_blank&quot;&gt;module aliases&lt;/a&gt; in OCaml 4.02. What if we tried to redeem them and give them a new youth and utility by adding the possibility to generate functors or recursive packs? &lt;/p&gt;



&lt;p&gt;This blog post covers the &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://github.com/ocaml/RFCs/pull/11&quot; target=&quot;_blank&quot;&gt;functor units and functor packs&lt;/a&gt;, while the next one will be centered around &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://github.com/ocaml/RFCs/pull/20&quot; target=&quot;_blank&quot;&gt;recursive packs&lt;/a&gt;. Both RFCs are currently developed by JaneStreet and OCamlPro. This idea was initially introduced by &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://www.ocamlpro.com/2011/08/10/packing-and-functors/&quot; target=&quot;_blank&quot;&gt;functor packs&lt;/a&gt; (Fabrice Le Fessant) and later generalized by &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://ocaml.org/meetings/ocaml/2014/ocaml2014_8.pdf&quot; target=&quot;_blank&quot;&gt;functorized namespaces&lt;/a&gt; (Pierrick Couderc et al.).&lt;/p&gt;



&lt;h2&gt;Packs for the masses&lt;/h2&gt;



&lt;p&gt;First of all let&amp;#8217;s take a look at what packs are, and how they fixed some issues that arose when the ecosystem started to grow and the number of libraries got quite large.&lt;/p&gt;



&lt;p&gt;One common problem in any programming language is how names are treated and disambiguated. For example, look at this small piece of code:&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;let x = &quot;something&quot;

let x = &quot;something else&quot;&lt;/pre&gt;



&lt;p&gt;We declare two variables &lt;code&gt;x&lt;/code&gt;, but actually the first one is shadowed by the second, and is now unavailable for the rest of the program. It is perfectly valid in OCaml. Let&amp;#8217;s try to do the same thing with modules:&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;module M = struct end

module M = struct end&lt;/pre&gt;



&lt;p&gt;The compiler rejects it with the following error:&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;File &quot;m.ml&quot;, line 3, characters 0-21:
3 | module M = struct end
    ^^^^^^^^^^^^^^^^^^^^^
Error: Multiple definition of the module name M.
       Names must be unique in a given structure or signature.&lt;/pre&gt;



&lt;p&gt;This also applies with programs linking two compilation units of the same name. Imagine you are using two libraries (here &lt;code&gt;lib_a&lt;/code&gt; and &lt;code&gt;lib_b&lt;/code&gt;), that both define a module named &lt;code&gt;Misc&lt;/code&gt;. &lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;ocamlopt -o prog.asm -I lib_a -I lib_b lib_a.cmxa lib_b.cmxa prog.ml 
File &quot;prog.ml&quot;, line 1:
Error: The files lib_a/a.cmi and lib_b/b.cmi make inconsistent assumptions
over interface Misc&lt;/pre&gt;



&lt;p&gt;At link time, the compiler will reject your program since you are trying to link two modules with the same name but different implementations. The compiler is unable to differentiate the two compilation units since they define some identical symbols, as such cannot link the program. Enforcing unique module names in the same namespace (&lt;em&gt;i.e.&lt;/em&gt; a signature) is consistent with the inability to link two modules of the same name in the same program.&lt;/p&gt;



&lt;p&gt;However, &lt;code&gt;Misc&lt;/code&gt; is a common name for a module in any project. How can we avoid that? As a user of the libraries there is nothing you can do, since you cannot rename the modules (you will eventually need to link two files named &lt;code&gt;misc.cmx&lt;/code&gt;). As the developer, you need to ensure that your module names are unique enough to be used along any other libraries. One solution would be to use prefixes for each of your compilation units, for example by naming your files &lt;code&gt;mylib_misc.ml&lt;/code&gt;, with the drawback that you will need to use those long module names inside your library. Another solution is packing your units.&lt;/p&gt;



&lt;p&gt;A pack is simply a generated module that appends all your compilation units into one. For example, suppose you have two files &lt;code&gt;a.ml&lt;/code&gt; and &lt;code&gt;b.ml&lt;/code&gt;, you can generate a pack (&lt;em&gt;i.e.&lt;/em&gt; a module) &lt;code&gt;mylib.cmx&lt;/code&gt; that is equivalent to:&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;module A = struct &amp;lt;content of a.ml&amp;gt; end
module B = struct &amp;lt;content of b.ml&amp;gt; end&lt;content of=&quot;&quot; a.ml=&quot;&quot;&gt;&lt;content of=&quot;&quot; b.ml=&quot;&quot;&gt;&lt;/content&gt;&lt;/content&gt;&lt;/pre&gt;



&lt;p&gt;As such, &lt;code&gt;A&lt;/code&gt; and &lt;code&gt;B&lt;/code&gt; can retain their original module name, and be accessed from the outside as &lt;code&gt;Mylib.A&lt;/code&gt; and &lt;code&gt;Mylib.B&lt;/code&gt;. It uses the namespacing induced by the module system. A developer can simply generate a pack for its library, assuming its library name will be unique enough to be linked with other modules without the risk of name clashing. However it has one big downside: suppose you use a library with many modules but only use one. Without packs the compiler will only link the necessary compilation units from this library, but since the pack is one big compilation unit this means your program embeds the complete library.&lt;/p&gt;



&lt;p&gt;This problem is fixed using module aliases and the compiler option &lt;code&gt;-no-alias-deps&lt;/code&gt; since OCaml 4.02, and the result for the user is equivalent to a pack, making them more or less deprecated.&lt;/p&gt;



&lt;h2&gt;Functorizing packs, or how to parameterize a library&lt;/h2&gt;



&lt;p&gt;Packs being modules representing libraries, a useful feature would be to be able to produce libraries that take modules as parameters, just like functors. Another usage would be to split a huge functor into multiple files. In other words, we want our pack &lt;code&gt;Mylib&lt;/code&gt; to be compiled as:&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;functor (P : sig .. end) -&amp;gt; struct 
  module A = struct &amp;lt;content of a.ml&amp;gt; end
  module B = struct &amp;lt;content of b.ml&amp;gt; end
end&lt;/pre&gt;



&lt;p&gt;while &lt;code&gt;A&lt;/code&gt; and &lt;code&gt;B&lt;/code&gt; would use the parameter &lt;code&gt;P&lt;/code&gt; as a module, and &lt;code&gt;Mylib&lt;/code&gt; instantiated later as&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;module Mylib = Mylib(Some_module_with_sig_compatible_with_P)&lt;/pre&gt;



&lt;p&gt;One can notice that our pack is indeed a functor, and not simply a module that binds a functor. To be able to do that, we also extends classical compilation units to be compiled as functors. Such functors are not expressed in the language, we do not provide a syntax for that, they are a matter of options at compile-time. For example:&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;ocamlopt -c -parameter P m.ml&lt;/pre&gt;



&lt;p&gt;will compile &lt;code&gt;m.ml&lt;/code&gt; as a functor that has a parameter &lt;code&gt;P&lt;/code&gt; whose interface is described in &lt;code&gt;p.cmi&lt;/code&gt; in the compilation path. Similarly, our pack &lt;code&gt;Mylib&lt;/code&gt; can be produced by the following compilation steps:&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;ocamlopt -c -parameter-of Mylib p.mli
ocamlopt -c -for-pack &quot;Mylib(P)&quot; a.ml
ocamlopt -c -for-pack &quot;MyLib(P)&quot; b.ml
ocamlopt -pack -o mylib.cmx -parameter P a.cmx b.cmx&lt;/pre&gt;



&lt;p&gt;In details:&lt;/p&gt;



&lt;ul&gt;&lt;li&gt;The parameter is compiled with the flag &lt;code&gt;-parameter-of Mylib&lt;/code&gt;, as such it won&amp;#8217;t be used as the interface of an implementation.&lt;/li&gt;&lt;li&gt;The two modules packed are compiled with the flag &lt;code&gt;-for-pack &quot;MyLib(P)&quot;&lt;/code&gt;.&lt;br&gt;Expressing the parameter of the pack is mandatory since &lt;code&gt;P&lt;/code&gt; must be known as a functor parameter (we will see why in the next section).&lt;/li&gt;&lt;li&gt;The pack is compiled with &lt;code&gt;-parameter P&lt;/code&gt;, which will indeed produce a functorized compilation unit.&lt;/li&gt;&lt;/ul&gt;



&lt;p&gt;Functors are not limited to a unique parameter, as such they can be compiled with multiple &lt;code&gt;-parameter&lt;/code&gt; options and multiple arguments in &lt;code&gt;-for-pack&lt;/code&gt;. This implementation being on the build system side, it does not need to change the syntax of the language. We expect build tools like dune to provide supports for this feature, making it maybe more easier to use. Moreover, it makes compilation units on par with modules which can have a functor type. One downside however is that we cannot express type equalities between two parameters or with the functor body type as we would do with substitutions in module types.&lt;/p&gt;



&lt;h3&gt;Functor packs under the hood&lt;/h3&gt;



&lt;p&gt;In terms of implementation, packs should be seen as a concatenation of the compilation units then a rebinding of each of them in the newly created one. For example, a pack &lt;code&gt;P&lt;/code&gt; of two units &lt;code&gt;m.cmx&lt;/code&gt; and &lt;code&gt;n.cmx&lt;/code&gt; is actually compiled as something like:&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;module P__M = &amp;lt;code of m.cmx&amp;gt; 
module P__N = &amp;lt;code of n.cmx&amp;gt; 
module M = P__M 
module N = P__N&lt;/pre&gt;



&lt;p&gt;According to this representation, if we tried to naively implement our previous functor pack &lt;code&gt;Mylib(P)&lt;/code&gt; we would end up with a functor looking like this:&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;module Mylib__A = &amp;lt;code of a.cmx, with references to P&amp;gt;
module Mylib__B = &amp;lt;code of b.cmx, with references to P&amp;gt;

functor (P : &amp;lt;signature of p.cmi&amp;gt;) -&amp;gt; struct
  module A = Mylib__A
  module B = Mylib__B
end&lt;/pre&gt;



&lt;p&gt;Unfortunately, this encoding of functor packs is wrong: &lt;code&gt;P&lt;/code&gt; is free in &lt;code&gt;a.cmx&lt;/code&gt; and &lt;code&gt;b.cmx&lt;/code&gt; and its identifier cannot correspond to the one generated for the functor retrospectively. The solution is actually quite simple and relies on a transformation known as &lt;strong&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Lambda_lifting&quot;&gt;closure conversion&lt;/a&gt;&lt;/strong&gt;. In other words we will transform our modules into functors that takes as parameters their free variables, which in our case are the parameters of the functor pack and the dependencies from the same pack. Let&amp;#8217;s do it on a concrete functor equivalent to Mylib:&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;module Mylib' (P : P_SIG) = struct
  module A = struct .. &amp;lt;references to P&amp;gt; end
  module B = struct .. &amp;lt;references to P&amp;gt; &amp;lt;references to A&amp;gt; end
end&lt;/pre&gt;



&lt;p&gt;Our goal here is to move &lt;code&gt;A&lt;/code&gt; and &lt;code&gt;B&lt;/code&gt; outside of the functor, as such out of the scope of &lt;code&gt;P&lt;/code&gt;, which is done by transforming those two modules into functors that takes a parameter &lt;code&gt;P'&lt;/code&gt; with the same signature as &lt;code&gt;P&lt;/code&gt;:&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;module A_funct (P' : P_SIG) = struct .. &amp;lt;references to P as P'&amp;gt; end 
module B_funct (P' : P_SIG) = struct 
  module A' = A_funct(P') 
  .. 
  &amp;lt;references to P as P'&amp;gt; 
  &amp;lt;references to A as A'&amp;gt; 
end 

module Mylib' (P : P_SIG) = struct 
  module A = A_funct(P) 
  module B = B_funct(P) 
end&lt;/pre&gt;



&lt;p&gt;While this code compiles it is not semantically equivalent. &lt;code&gt;A_funct&lt;/code&gt; is instantiated twice,  its side effects are computed twice: the first time when instantiating &lt;code&gt;A&lt;/code&gt; in the functor, and the second when instantiating &lt;code&gt;B&lt;/code&gt;. The solution is simply to go further with closure conversion and make the result of applying &lt;code&gt;A_funct&lt;/code&gt; to &lt;code&gt;P&lt;/code&gt; an argument of &lt;code&gt;B_funct&lt;/code&gt;.&lt;/p&gt;



&lt;pre class=&quot;wp-block-preformatted&quot;&gt;module A_funct (P' : P_SIG) = struct .. &amp;lt;references to P as P'&amp;gt; end
module B_funct (P' : P_SIG)(A': module type of A_funct(P'))= struct
  ..
  &amp;lt;references to P as P'&amp;gt; 
  &amp;lt;references to A as A'&amp;gt;
end

module Mylib' (P : P_SIG) = struct
  module A = A_funct(P)
  module B = B_funct(P)(A)
end&lt;/pre&gt;



&lt;p&gt;This represents exactly how our functor pack &lt;code&gt;Mylib&lt;/code&gt; is encoded. Since we need to compile modules in a specific way if they belong to a functor pack, the compiler has to know in the argument &lt;code&gt;-for-pack&lt;/code&gt; that the pack is a functor, and what are its parameters.&lt;/p&gt;



&lt;h3&gt;Functor packs applied to &lt;code&gt;ocamlopt&lt;/code&gt;&lt;/h3&gt;



&lt;p&gt;What we described is a functional prototype of functor packs, implemented on OCaml 4.10, as described in &lt;a rel=&quot;noreferrer noopener&quot; href=&quot;https://github.com/ocaml/RFCs/pull/11&quot; target=&quot;_blank&quot;&gt;RFC#11&lt;/a&gt;. In practice, we already have one usage that we could benefit of in the future: cross-compilation of native code. At the moment the compiler is configured to target the architecture which it is compiled on. The modules relative to the current architecture are linked symbolically into the backend folder and the backend is compiled as if it only supported one architecture. One downside of this approach is that changes into the interface of the backend that need some modifications in each architecture are not detected at compile time, but only for the current one. You need to reconfigure the OCaml compiler and rebuild it to check if another architecture still compiles. One interesting property is that each architecture backend defines the same set of modules with compatible interfaces. In other words, these modules could simply be parameters of a functor, that is instantiated for a given architecture.&lt;/p&gt;



&lt;p&gt;Following this idea, we implemented a prototype of native compiler whose backend is indeed packed into a functor, and instantiated at the initialization of the compiler. With this approach, we can easily switch the targeted architecture, and moreover we can be sure that each architecture is compiled, leveraging the fact that some necessary refactoring is always done when changes happen in the backend interface. Implementing such a functor is mainly a matter of adapting the build system to produce a functor pack, writing few signatures for the functor and its parameters, and instantiating the backend at the right time.&lt;/p&gt;



&lt;p&gt;This proof of concept shows how functor packs can ease some complicated build system and allows new workflow.&lt;/p&gt;



&lt;h2&gt;Making packs useful again&lt;/h2&gt;



&lt;p&gt;Packs were an old concept mainly outdated by module aliases. They were not practical as they are some sort of monolithic libraries shaped into a unique module containing sub modules. While they perfectly use the module system for its namespacing properties, their usage enforces the compiler to link an entire library even if only one module is actually used. This improvement allows programmers to define big functors, functors that are split among multiple files, resulting in what we can view as a way to implement some form of parameterized libraries.&lt;/p&gt;



&lt;p&gt;In the second part, we will cover another aspect of the rehabilitation of packs: using packs to implement mutually recursive compilation units.&lt;/p&gt;
</content><category term="OCaml, Opam &amp; OCaml Tooling"/><id>https://www.ocamlpro.com/?p=3947</id><title type="text">Rehabilitating Packs using Functors and Recursivity, part 1.</title><updated>2020-09-24T12:23:49-00:00</updated><author><name>OCamlPro</name></author></entry><entry><source><updated>2021-03-04T00:00:00-00:00</updated><link title="Tarides RSS Feed" type="text/html" href="https://tarides.com" rel="related"/><link title="Tarides RSS Feed" type="application/rss+xml" href="https://tarides.com/feed.xml" rel="self"/><generator>GatsbyJS</generator><id>https://tarides.com</id><title type="text">Tarides RSS Feed</title><author><name>Tarides</name></author></source><link href="https://tarides.com/blog/2020-09-24-building-portable-user-interfaces-with-nottui-and-lwd" rel="alternate"/><content xml:base="https://tarides.com/feed.xml" type="html">&lt;p&gt;At Tarides, we build many tools and writing UI is usually a tedious task. In this post we will see how to write functional UIs in OCaml using the &lt;code&gt;Nottui&lt;/code&gt; &amp;#x26; &lt;code&gt;Lwd&lt;/code&gt; libraries.&lt;/p&gt;
&lt;p&gt;These libraries were developed for &lt;a href=&quot;https://github.com/ocurrent/citty&quot;&gt;Citty&lt;/a&gt;, a frontend to the &lt;a href=&quot;https://github.com/ocurrent/ocaml-ci&quot;&gt;Continuous Integration service&lt;/a&gt; of OCaml Labs.&lt;/p&gt;
&lt;div&gt;
  &lt;video controls width=&quot;100%&quot;&gt;
    &lt;source src=&quot;./nottui-citty.mp4&quot; type=&quot;video/mp4&quot; /&gt;
    &lt;source src=&quot;./nottui-citty.webm&quot; type=&quot;video/webm;codecs=vp9&quot; /&gt;
  &lt;/video&gt;
&lt;/div&gt;
&lt;p&gt;In this recording, you can see the lists of repositories, branches and jobs monitored by the CI service, as well as the result of job execution. Most of the logic is asynchronous, with all the contents being received from the network in a non-blocking way.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Nottui&lt;/code&gt; extends &lt;a href=&quot;https://github.com/pqwy/notty&quot;&gt;Notty&lt;/a&gt;, a library for declaring terminal images, to better suit the needs of UIs. &lt;code&gt;Lwd&lt;/code&gt; (Lightweight Document) exposes a simple form of reactive computation (values that evolve over time). It can be thought of as an alternative to the DOM, suitable for building interactive documents.
They are used in tandem: &lt;code&gt;Nottui&lt;/code&gt; for rendering the UI and &lt;code&gt;Lwd&lt;/code&gt; for making it interactive.&lt;/p&gt;
&lt;h2 id=&quot;nottui--notty-with-layout-and-events&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#nottui--notty-with-layout-and-events&quot; aria-label=&quot;nottui  notty with layout and events permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Nottui = Notty with layout and events&lt;/h2&gt;
&lt;p&gt;Notty exposes a nice way to display images in a terminal. A Notty image is matrix of characters with optional styling attributes (tweaking foreground and background colors, using &lt;strong&gt;bold&lt;/strong&gt; glyphs...).&lt;/p&gt;
&lt;p&gt;These images are pure values and can be composed (concatenated, cropped, ...) very efficiently, making them very convenient to manipulate in a functional way.&lt;/p&gt;
&lt;p&gt;However these images are inert: their contents are fixed and their only purpose is to be displayed. Nottui reuses Notty images and exposes essentially the same interface but it adds two features: layout &amp;#x26; event dispatch. UI elements now adapt to the space available and can react to keyboard and mouse actions.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Layout DSL&lt;/strong&gt;. Specifying a layout is done using &quot;stretchable&quot; dimensions, a concept loosely borrowed from TeX. Each UI element has a fixed size (expressed as a number of columns and rows) and a stretchable size (possibly empty). The stretchable part is interpreted as a strength that is used to determine how to share the space available among all UI elements.&lt;/p&gt;
&lt;p&gt;This is a simple system amenable to an efficient implementation while being powerful enough to express common layout patterns.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Event dispatch&lt;/strong&gt;. Reacting to mouse and keyboard events is better done using local behaviors, specific to an element. In Nottui, images are augmented with handlers for common actions. There is also a global notion of focus to determine which element should consume input events.&lt;/p&gt;
&lt;h2 id=&quot;interactivity-with-lwd&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#interactivity-with-lwd&quot; aria-label=&quot;interactivity with lwd permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Interactivity with Lwd&lt;/h2&gt;
&lt;p&gt;Nottui's additions are nice for resizing and attaching behaviors to images, but they are still static objects. In practice, user interfaces are very dynamic: parts can be independently updated to display new information.&lt;/p&gt;
&lt;p&gt;This interactivity layer is brought by Lwd and is developed separately from the core UI library. It is built around a central type, &lt;code&gt;'a Lwd.t&lt;/code&gt;, that represents a value of type &lt;code&gt;'a&lt;/code&gt; that can change over time.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Lwd.t&lt;/code&gt; is an &lt;a href=&quot;https://en.wikipedia.org/wiki/Applicative_functor&quot;&gt;applicative functor&lt;/a&gt; (and even a monad), making it a highly composable abstraction.&lt;/p&gt;
&lt;p&gt;Primitive changes are introduced by &lt;code&gt;Lwd.var&lt;/code&gt;, which are OCaml references with an extra operation &lt;code&gt;val get : 'a Lwd.var -&gt; 'a Lwd.t&lt;/code&gt;. This operation turns a variable into a &lt;em&gt;changing value&lt;/em&gt; that changes whenever the variable is set.&lt;/p&gt;
&lt;p&gt;In practice this leads to a mostly declarative style of programming interactive documents (as opposed to the DOM that is deeply mutable). Most of the code is just function applications without spooky action at a distance! However, it is possible to opt-out of this pure style by introducing an &lt;code&gt;Lwd.var&lt;/code&gt;, on a case-by-case basis.&lt;/p&gt;
&lt;h2 id=&quot;and-much-more&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#and-much-more&quot; aria-label=&quot;and much more permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;And much more...&lt;/h2&gt;
&lt;p&gt;A few extra libraries are provided to target more specific problems.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Lwd_table&lt;/code&gt; and &lt;code&gt;Lwd_seq&lt;/code&gt; are two datastructures to manipulate dynamic collections. &lt;code&gt;Nottui_pretty&lt;/code&gt; is an interactive pretty printing library that supports arbitrary Nottui layouts and widgets. Finally &lt;code&gt;Tyxml_lwd&lt;/code&gt; is a strongly-typed abstraction of the DOM driven by Lwd.&lt;/p&gt;
&lt;p&gt;Version 0.1 has just been released on OPAM.&lt;/p&gt;
&lt;h2 id=&quot;getting-started&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#getting-started&quot; aria-label=&quot;getting started permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Getting started!&lt;/h2&gt;
&lt;p&gt;Here is a small example to start using the library. First, install the Nottui library:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ opam install nottui&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we can play in the top-level. We will start with a simple button that counts the number of clicks:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;$&lt;/span&gt; utop
# &lt;span class=&quot;token directive important&quot;&gt;#require&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;nottui&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
# &lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; &lt;span class=&quot;token module variable&quot;&gt;Nottui&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
# &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; W &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token module variable&quot;&gt;Nottui_widgets&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;(* State for holding the number of clicks *)&lt;/span&gt;
# &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; vcount &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token module variable&quot;&gt;Lwd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;var &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;(* Image of the button parametrized by the number of clicks *)&lt;/span&gt;
# &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; button count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    W&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;button &lt;span class=&quot;token label function&quot;&gt;~attr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token module variable&quot;&gt;Notty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bg green &lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; fg black&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token module variable&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sprintf &lt;span class=&quot;token string&quot;&gt;&quot;Clicked %d times!&quot;&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token module variable&quot;&gt;Lwd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;set vcount &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;(* Run the UI! *)&lt;/span&gt;
# &lt;span class=&quot;token module variable&quot;&gt;Ui_loop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token module variable&quot;&gt;Lwd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;map button &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token module variable&quot;&gt;Lwd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get vcount&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; to quit the example, you can press Ctrl-Q or Esc.&lt;/p&gt;
&lt;p&gt;We will improve the example and turn it into a mini cookie clicker game.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ocaml&quot;&gt;&lt;pre class=&quot;language-ocaml&quot;&gt;&lt;code class=&quot;language-ocaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;(* Achievements to unlock in the cookie clicker *)&lt;/span&gt;
# &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; badges &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;15&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Cursor&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Grandma&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;150&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Farm&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;300&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Mine&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;(* List the achievements unlocked by the player *)&lt;/span&gt;
# &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; unlocked_ui count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;(* Filter the achievements *)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; predicate &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; text&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; count &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; target
      &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token module variable&quot;&gt;Some&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;W&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printf &lt;span class=&quot;token string&quot;&gt;&quot;% 4d: %s&quot;&lt;/span&gt; target text&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token module variable&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;(* Concatenate the UI elements vertically *)&lt;/span&gt;
    &lt;span class=&quot;token module variable&quot;&gt;Ui&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;vcat &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token module variable&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;filter_map predicate badges&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;(* Display the next achievement to reach *)&lt;/span&gt;
# &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; next_ui count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; predicate &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; target &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; ciybt &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token module variable&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;find_opt predicate badges &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token module variable&quot;&gt;Some&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
      W&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printf &lt;span class=&quot;token label function&quot;&gt;~attr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token module variable&quot;&gt;Notty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;st bold&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;% 4d: ???&quot;&lt;/span&gt; target
    &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token module variable&quot;&gt;None&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token module variable&quot;&gt;Ui&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;empty&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;(* Let's make use of the fancy let-operators recently added to OCaml *)&lt;/span&gt;
# &lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; &lt;span class=&quot;token module variable&quot;&gt;Lwd_infix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
# &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ui &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;$&lt;/span&gt; count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token module variable&quot;&gt;Lwd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get vcount &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;token module variable&quot;&gt;Ui&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;vcat &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;button count&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; unlocked_ui count&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; next_ui count&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;(* Launch the game! *)&lt;/span&gt;
# &lt;span class=&quot;token module variable&quot;&gt;Ui_loop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run ui&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div&gt;
  &lt;video controls&gt;
    &lt;source src=&quot;./nottui-cookie-clicker.mp4&quot; type=&quot;video/mp4&quot; /&gt;
    &lt;source src=&quot;./nottui-cookie-clicker.webm&quot; type=&quot;video/webm;codecs=vp9&quot; /&gt;
  &lt;/video&gt;
&lt;/div&gt;
&lt;p&gt;Et voilà! We hope you enjoy experimenting with &lt;code&gt;Nottui&lt;/code&gt; and &lt;code&gt;Lwd&lt;/code&gt;. Check out the &lt;a href=&quot;https://github.com/let-def/lwd/tree/master/lib/nottui&quot;&gt;Nottui page&lt;/a&gt; for more examples, and watch our recent presentation of these libraries at the 2020 ML Workshop here:&lt;/p&gt;
&lt;div style=&quot;position: relative; width: 100%; height: 0; padding-bottom: 56.25%&quot;&gt;
  &lt;iframe
    style=&quot;position: absolute; width: 100%; height: 100%; left: 0; right: 0&quot;
    src=&quot;https://www.youtube-nocookie.com/embed/w7jc35kgBZE&quot; frameborder=&quot;0&quot;
    allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot;
    allowfullscreen&gt;
  &lt;/iframe&gt;
&lt;/div&gt;</content><id>https://tarides.com/blog/2020-09-24-building-portable-user-interfaces-with-nottui-and-lwd.html</id><title type="text">Building portable user interfaces with Nottui and Lwd</title><updated>2020-09-24T00:00:00-00:00</updated><author><name>Tarides</name></author></entry><entry><source><updated>2021-03-04T00:00:00-00:00</updated><link title="Tarides RSS Feed" type="text/html" href="https://tarides.com" rel="related"/><link title="Tarides RSS Feed" type="application/rss+xml" href="https://tarides.com/feed.xml" rel="self"/><generator>GatsbyJS</generator><id>https://tarides.com</id><title type="text">Tarides RSS Feed</title><author><name>Tarides</name></author></source><link href="https://tarides.com/blog/2020-09-17-tarides-is-now-a-sponsor-of-the-ocaml-software-foundation" rel="alternate"/><content xml:base="https://tarides.com/feed.xml" type="html">&lt;p&gt;Tarides is pleased to provide support for the &lt;a href=&quot;https://ocaml-sf.org&quot;&gt;OCaml Software
Foundation&lt;/a&gt;, a non-profit foundation hosted by
the Inria Foundation. The OCaml Software Foundation's mission is to
promote the OCaml programming language and its ecosystem by
supporting the growth of a diverse and international community of
OCaml users.&lt;/p&gt;
&lt;p&gt;Tarides develops secure-by-design solutions in which OCaml's memory and
type-safety guarantees play a major role. Hence, most of the software
development that is done at Tarides is in OCaml: for instance,
&lt;a href=&quot;https://mirage.io&quot;&gt;MirageOS&lt;/a&gt;, a library operating system that
constructs unikernels for secure, high-performance network
applications; and &lt;a href=&quot;https://irmin.org&quot;&gt;Irmin&lt;/a&gt;, a library for building
mergeable, branchable distributed data stores, with built-in
snapshotting and support for a wide variety of storage backends.&lt;/p&gt;
&lt;p&gt;Tarides is also very involved in the OCaml compiler development and
OCaml developer tooling ecosystem: as active maintainers of the &lt;a href=&quot;https://www.youtube.com/watch?v=E8T_4zqWmq8&amp;#x26;list=PLKO_ZowsIOu5fHjRj0ua7_QWE_L789K_f&amp;#x26;ab_channel=ocaml2020&quot;&gt;OCaml
platform&lt;/a&gt;, Tarides is involved with most of the major
OCaml developer tools, including &lt;a href=&quot;https://github.com/ocaml/ocaml&quot;&gt;opam&lt;/a&gt;, &lt;a href=&quot;https://github.com/ocaml/dune&quot;&gt;dune&lt;/a&gt; and &lt;a href=&quot;https://github.com/ocaml/merlin&quot;&gt;merlin&lt;/a&gt;.&lt;/p&gt;</content><id>https://tarides.com/blog/2020-09-17-tarides-is-now-a-sponsor-of-the-ocaml-software-foundation.html</id><title type="text">Tarides is now a sponsor of the OCaml Software Foundation</title><updated>2020-09-17T00:00:00-00:00</updated><author><name>Tarides</name></author></entry><entry><source><updated>2020-12-01T00:00:00-00:00</updated><link title="Jane Street Tech Blog" type="text/html" href="https://blog.janestreet.com" rel="related"/><link title="Jane Street Tech Blog" type="application/rss+xml" href="https://blog.janestreet.com/feed.xml" rel="self"/><id>https://blog.janestreet.com</id><title type="text">Jane Street Tech Blog</title><author><name>Jane Street</name></author></source><link href="https://blog.janestreet.com/memory-allocator-showdown/" rel="alternate"/><content xml:base="https://blog.janestreet.com/feed.xml" type="html">Since version 4.10, OCaml offers a new best-fit memory allocator
alongside its existing default, the next-fit allocator. At Jane
Street, we've seen a big improvement after switching over to the new
allocator.

This post isn't about how the new allocator works. For that, the best
source is these notes from a talk by its
author.  Instead, this post is about just how tricky it is to compare two
allocators in a reasonable way, especially for a garbage-collected
system.
  
</content><id>https://blog.janestreet.com/memory-allocator-showdown/</id><title type="text">Memory allocator showdown</title><updated>2020-09-15T00:00:00-00:00</updated><author><name>Jane Street</name></author></entry><entry><summary xml:base="http://math.andrej.com/feed.xml" type="html">The preprint version of the paper A general definition of dependent type theories has finally appeared on the arXiv! Over three years ago Peter Lumsdaine invited me to work on the topic, which I gladly accepted, and dragged my student Philipp Haselwarter into it. We set out to give an answer to the queation: What is type theory, precisely? At least for me the motivation to work on such a thankless topic came from Vladimir Voevodsky, who would ask the question to type-theoretic audiences. Some took him to be a troll and others a newcomer who just had to learn more type theory. I was among the latter, but eventually the question got through to me – I could point to any number of specific examples of type theories, but not a comprehensive and mathematically precise definition of the general concept. It is too easy to dismiss the question by claiming that type theory is an open-ended concept which therefore cannot be completely captured by any mathematical definition. Of course it is open-ended, but it does not follow at all that we should not even attempt to define it. If geometers were equally fatalistic about the open-ended notion of space we would never have had modern geometry, topology, sheaves – heck, half of 20th century mathematics would not be there! Of course, we are neither the first nor the last to give a definition of type theory, and that is how things should be. We claim no priority or supremacy over other definitions and views of type theory. Our approach could perhaps be described as &quot;concrete&quot; and &quot;proof-theoretic&quot;: We wanted to stay close to traditional syntax. We gave a complete and precise definition. We aimed for a level of generality that allows useful meta-theory of a wide range of type theories. One can argue each of the above points, and we have done so among ourselves many times. Nevertheless, I feel that we have accomplished something worthwhile – but the ultimate judges will be our readers, or lack of them. You are kindly invited to take a look at the paper. Download PDF: arxiv.org/pdf/2009.05539.pdf I should not forget to mention that Peter, with modest help from Philipp and me, formalized almost the entire paper in Coq! See the repository general-type-theories at GitHub.</summary><source><updated>2021-02-24T17:51:19-00:00</updated><subtitle type="text">A blog about mathematics for computers</subtitle><link type="text/html" href="http://math.andrej.com/" rel="alternate"/><link type="application/atom+xml" href="http://math.andrej.com/feed.xml" rel="self"/><generator uri="https://jekyllrb.com/" version="4.2.0">Jekyll</generator><id>http://math.andrej.com/feed.xml</id><title xml:base="http://math.andrej.com/feed.xml" type="html">Mathematics and Computation</title><author><name>Andrej Bauer</name></author></source><published>2020-09-13T22:00:00-00:00</published><link title="A general definition of dependent type theories" type="text/html" href="http://math.andrej.com/2020/09/14/a-general-definition-of-dependent-type-theories/" rel="alternate"/><content xml:base="http://math.andrej.com/feed.xml" type="html">&lt;p&gt;The preprint version of the paper &lt;a href=&quot;https://arxiv.org/abs/2009.05539&quot;&gt;A general definition of dependent type
theories&lt;/a&gt; has finally appeared on the arXiv! Over three
years ago &lt;a href=&quot;http://peterlefanulumsdaine.com&quot;&gt;Peter Lumsdaine&lt;/a&gt; invited me to work on the
topic, which I gladly accepted, and dragged my student &lt;a href=&quot;http://haselwarter.org/~philipp/&quot;&gt;Philipp
Haselwarter&lt;/a&gt; into it. We set out to give &lt;em&gt;an&lt;/em&gt; answer to
the queation:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;What is type theory, precisely?&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;At least for me the motivation to work on such a thankless topic came from Vladimir
Voevodsky, who would ask the question to type-theoretic audiences. Some took him to be a
troll and others a newcomer who just had to learn more type theory. I was among the
latter, but eventually the question got through to me – I could point to any number of
&lt;em&gt;specific&lt;/em&gt; examples of type theories, but not a comprehensive and mathematically precise
definition of the &lt;em&gt;general&lt;/em&gt; concept.&lt;/p&gt;

&lt;p&gt;It is too easy to dismiss the question by claiming that type theory is an open-ended concept
which therefore cannot be completely captured by any mathematical definition. Of
course it is open-ended, but it does not follow at all that we should not even
attempt to define it. If geometers were equally fatalistic about the open-ended notion of
space we would never have had modern geometry, topology, sheaves – heck, half of 20th
century mathematics would not be there!&lt;/p&gt;

&lt;p&gt;Of course, we are neither the first nor the last to give a definition of type theory, and
that is how things should be. We claim no priority or supremacy over other definitions and
views of type theory. Our approach could perhaps be described as &quot;concrete&quot; and
&quot;proof-theoretic&quot;:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;We wanted to &lt;em&gt;stay close to traditional syntax&lt;/em&gt;.&lt;/li&gt;
  &lt;li&gt;We gave a &lt;em&gt;complete&lt;/em&gt; and &lt;em&gt;precise&lt;/em&gt; definition.&lt;/li&gt;
  &lt;li&gt;We aimed for a level of generality that allows useful meta-theory of a wide range of type theories.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;One can argue each of the above points, and we have done so among ourselves many times.
Nevertheless, I feel that we have accomplished something worthwhile – but the ultimate
judges will be our readers, or lack of them. You are kindly invited to take a look at the
paper.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Download PDF:&lt;/strong&gt; &lt;a href=&quot;https://arxiv.org/pdf/2009.05539.pdf&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;arxiv.org/pdf/2009.05539.pdf&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I should not forget to mention that Peter, with modest help from Philipp and me,
formalized almost the entire paper in Coq! See the repository
&lt;a href=&quot;https://github.com/peterlefanulumsdaine/general-type-theories&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;general-type-theories&lt;/code&gt;&lt;/a&gt; at
GitHub.&lt;/p&gt;</content><category term="Type theory"/><category term="Publications"/><id>http://math.andrej.com/2020/09/14/a-general-definition-of-dependent-type-theories</id><title xml:base="http://math.andrej.com/feed.xml" type="html">A general definition of dependent type theories</title><updated>2020-09-13T22:00:00-00:00</updated><author><name>Andrej Bauer</name></author></entry></feed>